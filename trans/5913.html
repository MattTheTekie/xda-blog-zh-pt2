<html>
<head>
<title>Dynamic Android will let developers test AOSP on any Android Q device</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>动态Android将允许开发者在任何Android Q设备上测试AOSP</h1>
<blockquote>原文：<a href="https://www.xda-developers.com/android-q-dynamic-android-aosp-gsi/#0001-01-01">https://www.xda-developers.com/android-q-dynamic-android-aosp-gsi/#0001-01-01</a></blockquote><div><div class="content-block-regular">
<p/><p>多亏了Project Treble(T1 ),智能手机制造商提供Android Pie软件更新的速度比他们提供Android Oreo更新的速度更快，至少对于旗舰智能手机来说是这样。不过，谷歌不想看到只有原始设备制造商从Project Treble中获益。该公司此前<a href="https://www.xda-developers.com/google-test-android-q-project-treble-gsi/">曾表示有兴趣</a>为开发者发布Android Q的通用系统映像(GSI)，这样他们就不必依赖仿真器，使用<a href="https://www.xda-developers.com/genymotion-cloud-google-cloud-platform/">云服务</a>，或者等待自己设备上的更新来测试最新API级别的应用程序。理论上，发布GSI应该允许任何拥有Project Treble兼容设备(最初是Android 8.0 Oreo和更高版本，但现在被认为只有使用Android 9 Pie推出的设备)的开发者测试最新的Android版本。开发人员只需在其现有软件安装的基础上刷新系统映像，无需定制恢复、引导或供应商映像。</p>

  
<p>然而，当前的GSI安装过程存在几个问题。首先，你需要一个解锁的引导加载程序，这在华为或Honor设备(无需向T2支付费用)、HMD Global的诺基亚设备(不包括T4的诺基亚8)或美国运营商品牌的设备上是不可能的。接下来，<a href="https://www.xda-developers.com/flash-generic-system-image-project-treble-device/">过程</a>对于任何不熟悉通过快速启动来闪烁图像的人来说将会很难。最后，现在刷新GSI将需要您完全擦除内部存储，这意味着您可能需要一个备用设备来测试。现在，闪烁GSI只是原始设备制造商用来在他们的设备上测试项目三重兼容性的东西，除此之外，它只对顽固的定制ROM爱好者有吸引力。谷歌新的“动态安卓”项目可能会改变这一点。</p>

 
<h2 id="dynamic-android-easily-test-aosp-gsis-on-any-android-q-device">动态Android——在任何Android Q设备上轻松测试AOSP GSI</h2>
<p>在过去的几个月里，谷歌一直在研究一种无需解锁引导程序就能安全启动GSI的方法。简而言之，谷歌正在开发一款拥有特殊权限的应用，允许它下载GSI，为其保留存储空间，并将GSI标记为可启动。这个项目有几个组成部分，所以让我们逐一讨论。</p>

<h3 id="dynamic-android-and-android-on-tap">动态Android和Android On Tap</h3>
<p>Android Q增加了两项新服务:动态Android和Android On Tap服务。动态Android处理GSI的安装，而Android On Tap通过回调和广播通知系统应用程序。例如，如果设备受到PIN、密码或模式的保护，Android On Tap会提醒KeyguardManager要求用户确认安装请求。当用户启动GSI时，AOT也会提醒用户。</p>

<p>根据对“DynamicAndroidManager”的描述，这项服务“提供了一种临时使用新Android图像的机制。”安装后，设备可以使用新创建的/data重新启动到新安装的映像中。在GSI中重新引导会使用户返回到原始系统映像，但是新安装的映像及其数据只是被禁用，而不会被删除。但是，如果用户选择这样做，可以完全删除GSI及其数据。</p>



<p>来源:[ <a href="https://android-review.googlesource.com/c/platform/frameworks/base/+/861575"> 1 </a>，[ <a href="https://android-review.googlesource.com/c/platform/frameworks/base/+/862409"> 2 </a>，[ <a href="https://android-review.googlesource.com/c/platform/frameworks/base/+/868930"> 3 </a>，[ <a href="https://android-review.googlesource.com/c/platform/system/gsid/+/876972"> 4 </a> ]</p>

<h3 id="gsid">GSID</h3>
<p>GSI守护程序在/data分区中分配空间来存储GSI映像及其数据，并使映像可引导。GSI的元数据存储在/metadata中，而GSI本身及其数据存储在/data/gsi中。默认情况下，GSID为新安装的GSI分配8GB用户数据。一般来说，GSID在开始安装之前会寻找至少40%的可用空间。最后，出于显而易见的原因，该守护程序会阻止用户在GSI中安装GSI。</p>

<p>来源:[ <a href="https://android-review.googlesource.com/c/platform/system/gsid/+/880716"> 1 </a>，[ <a href="https://android-review.googlesource.com/c/platform/system/gsid/+/876155"> 2 </a>，[ <a href="https://android-review.googlesource.com/c/platform/system/gsid/+/863812"> 3 </a>，[ <a href="https://android-review.googlesource.com/c/platform/system/gsid/+/864937"> 4 </a> ]</p>

<h3 id="security">安全性</h3>
<p>新安装的EXT4系统镜像(system_gsi挂载到/system)启用了Android验证启动(AVB)。谷歌也为新服务实施了SELinux政策。最后，安装GSI需要应用程序具有新的MANAGE_DYNAMIC_ANDROID权限。这是一个签名级别的权限，这意味着应用程序必须由OEM签名。</p>

<p>来源:[ <a href="https://android-review.googlesource.com/c/platform/system/core/+/889973"> 1 </a>，[ <a href="https://android-review.googlesource.com/c/platform/system/sepolicy/+/864995"> 2 </a></p>

<h3 id="adb-and-fastboot-commands">ADB和Fastboot命令</h3>
<p>GSIs也可以通过新的ADB命令安装。新的ADB gsi_tool shell命令将允许用户禁用、重新启用、安装和保留用户数据、安装和创建用户数据、安装和擦除用户数据或检查安装状态。</p>

<pre> <code class="hljs sql">gsi_tool - <span class="hljs-built_in">command</span>-line tool <span class="hljs-keyword">for</span> installing GSI images.<br/><br/>Usage:<br/>  gsi_tool <span class="hljs-tag">&lt;<span class="hljs-name">disable|install|wipe|status</span>&gt;</span> [options]<br/><br/>  <span class="hljs-built_in">disable</span> Disable the currently installed GSI.<br/>  <span class="hljs-built_in">enable</span> Enable a previously disabled GSI.<br/>  <span class="hljs-keyword">install</span> <span class="hljs-keyword">Install</span> a <span class="hljs-keyword">new</span> GSI. Specify the image <span class="hljs-keyword">size</span> <span class="hljs-keyword">with</span><br/>               <br/>               <br/>               <br/>  wipe Completely remove a GSI and its associated data<br/>  status <span class="hljs-keyword">Show</span> <span class="hljs-keyword">status</span></code> </pre>
<p>将添加两个新的fastboot命令来管理GSI，尽管fastboot安装不受支持，因为fastboot不能挂载userdata。</p>

<pre> <code class="hljs bash">fastboot gsi wipe<br/>fastboot gsi <span class="hljs-built_in">disable</span></code> </pre>
<p>来源:[ <a href="https://android-review.googlesource.com/c/platform/system/gsid/+/871412"> 1 </a>，[ <a href="https://android-review.googlesource.com/c/platform/system/core/+/889793"> 2 </a></p>
<p class="ad-odd"> </p>


<h2 id="who-will-this-benefit">这对谁有利？</h2>
<p>我想说，应用程序开发人员将能够利用动态Android和Android On Tap，但我不完全确定。虽然谷歌对此表示了兴趣，但不能保证非谷歌原始设备制造商发布的每个Android Q版本都会有这个功能。为了在设备上利用这一点，该软件需要一个GSI picker应用程序，该应用程序由与ROM相同的证书签名。由于SELinux政策的原因，我也不确定在没有ADB root的情况下从ADB安装GSI是否可行。 <strong>更新:</strong>一项新的<a href="https://android-review.googlesource.com/c/platform/system/gsid/+/894013">承诺</a>确认亚行根将被要求使用GSI工具。如果这不是为了让应用程序开发人员在一个干净的Android版本上测试他们的应用程序，那么它可能只会让那些希望在他们的设备上测试兼容性测试套件(CTS)和供应商测试套件(VTS)的OEM工程师受益。</p>

<p><em>特别感谢XDA认可开发者<a href="https://forum.xda-developers.com/member.php?u=5778309"> luca020400 </a>对本文的协助。</em></p>

 </div>


</div>    
</body>
</html>