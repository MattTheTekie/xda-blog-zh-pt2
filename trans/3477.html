<html>
<head>
<title>The Sorry State of Android Fragmentation: An Example to Understand Developers' Plight</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Android碎片化的可悲状态:理解开发者困境的一个例子</h1>
<blockquote>原文：<a href="https://www.xda-developers.com/the-sorry-state-of-android-fragmentation/#0001-01-01">https://www.xda-developers.com/the-sorry-state-of-android-fragmentation/#0001-01-01</a></blockquote><div><div class="content-block-regular">
<p/><p>自从移动操作系统Android发布以来，碎片化就一直是一个有争议的问题。</p>

  
<p>除了成为网络火拼中的一根大棒，碎片化带来的多样性现在在很大程度上被视为安卓设备消费者的一个积极因素。毕竟，我们被给予了如此多的自由来选择我们想要的那种设备和那种软件，以至于普通消费者很难关心碎片化。可视化令人难以置信的各种Android设备产生了一个美丽的Android多样化表现的马赛克。</p>
<div class="body-img landscape"><div class="responsive-img image-expandable img-article-item" data-img-url="https://static1.xdaimages.com/wordpress/wp-content/uploads/2016/07/fragmentation-2.png" data-modal-id="single-image-modal" data-modal-container-id="single-image-modal-container" data-img-caption="&quot;An Example of Android Device Fragmentation based on App Installations of OpenSignal's app. Source: &lt;a href=\&quot;https:\/\/opensignal.com\/reports\/2015\/08\/android-fragmentation\/\&quot;&gt;OpenSignal&lt;\/a&gt;&quot;">
 
<figure> <picture>  <source media="(min-width: 1024px)" sizes="1500px" data-srcset="https://static1.xdaimages.com/wordpress/wp-content/uploads/2016/07/fragmentation-2.png?q=50&amp;fit=crop&amp;w=1500&amp;dpr=1.5"/> <source media="(min-width: 768px)" sizes="943px" data-srcset="https://static1.xdaimages.com/wordpress/wp-content/uploads/2016/07/fragmentation-2.png?q=50&amp;fit=crop&amp;w=943&amp;dpr=1.5"/> <source media="(min-width: 481px)" sizes="767px" data-srcset="https://static1.xdaimages.com/wordpress/wp-content/uploads/2016/07/fragmentation-2.png?q=50&amp;fit=crop&amp;w=767&amp;dpr=1.5"/> <source media="(min-width: 0px)" sizes="480px" data-srcset="https://static1.xdaimages.com/wordpress/wp-content/uploads/2016/07/fragmentation-2.png?q=50&amp;fit=crop&amp;w=480&amp;dpr=1.5"/> <img class="lazyload" alt="An Example of Android Device Fragmentation based on App Installations of OpenSignal's app. Source: OpenSignal" data-img-url="https://static1.xdaimages.com/wordpress/wp-content/uploads/2016/07/fragmentation-2.png" src="../Images/d55772590c83a2e9b8bd5bce12d7b7d0.png" data-original-src="https://static1.xdaimages.com/wordpress/wp-content/uploads/2016/07/fragmentation-2.png"/> </picture> <figcaption class="body-img-caption">An Example of Android Device Fragmentation based on App Installations of OpenSignal's app. Source: <a href="https://opensignal.com/reports/2015/08/android-fragmentation/">OpenSignal</a></figcaption> </figure> </div>


 </div>


<p>但是硬件和软件的分裂并不会让软件开发者快乐。事实上，恰恰相反。在这么多不同的硬件和软件配置上开发一个应用程序在调试时可能会被证明是一件非常麻烦的事情。在开发应用程序时，原始设备制造商可以做出需要考虑的重大或细微的改变，但对于单个开发人员来说，确实没有简单的方法来确保他们的应用程序能够通用。虽然普通消费者早就忘记了碎片化的争论，但这个问题仍然困扰着Android应用程序开发人员，除了接受它并在出现错误时处理它们之外，似乎没有什么可以做的。</p>

<hr/>

<p><strong>令人遗憾的分裂状态</strong></p>

<p>有一家OEM厂商尤其因为在开发应用程序时引起的麻烦而受到了很多人的憎恨——三星。开发人员多年来一直在咆哮三星，有些人甚至写了一些严厉的文章，如“<a href="http://verybadalloc.com/android/2015/12/19/special-place-for-samsung-in-android-hell/">Android Hell</a>中有一个三星的特殊位置”，描述了一个源于<a href="https://code.google.com/p/android/issues/detail?id=78377">三星设备和支持appcompat库</a>的特别令人沮丧的错误。我想特别提请注意Ambri先生咆哮中的一段话，这段话很好地概括了为什么开发人员仍然关心碎片化:</p>

<blockquote>
<p>如果你是安卓开发者，你对三星设备的仇恨大概是无边无际的。对于一个普通用户来说，三星是愚蠢的触摸工具和过度膨胀的T2的代名词，你鄙视三星是因为你别无选择。因为三星<a href="http://www.cnet.com/news/samsung-continues-to-rule-over-apple-in-smartphone-market/">巨大的市场份额</a>，你根本无法选择不支持三星设备。而这才是最伤人的；事实是这个选择被剥夺了！</p>
 </blockquote>
<p>这也不是对Android存在的旧时代的咆哮——这篇文章发表于去年12月中旬。我将坦率地说，我不确定这个问题是否已经正式修复，但是，Ambri先生已经在他的帖子中为任何通过谷歌搜索这个漏洞偶然发现他的咆哮的人提供了修复。你所要做的就是用下面的单行代码使用<a href="http://proguard.sourceforge.net/"> ProGuard </a>:</p>

<pre> <code class="hljs php"/> </pre>
<p>还不算太糟，是吗？然而，问题是这个修复是从堆栈溢出中取出的。别误会，Stack Overflow是个很棒的网站。但它并不是发现应用程序补丁的理想来源。在Stack Overflow上找到一些东西通常需要在多次试错的谷歌搜索后深入链接。有时你甚至会发现另一个用户提到了你遇到的同一个bug，但是看不到修复的迹象。或者更令人沮丧的是，当你发现一个帖子时，发帖者声称已经找到了一个修复方法，但他们很久以前就放弃了他们的帖子，没有告诉其他人如何修复这个问题。</p>
<div class="body-img landscape"><div class="responsive-img image-expandable img-article-item" data-img-url="https://static1.xdaimages.com/wordpresshttp://imgs.xkcd.com/comics/wisdom_of_the_ancients.png" data-modal-id="single-image-modal" data-modal-container-id="single-image-modal-container" data-img-caption="&quot;Source: XKCD&quot;">
 
<figure> <picture>  <source media="(min-width: 1024px)" sizes="1500px" data-srcset="http://imgs.xkcd.com/comics/wisdom_of_the_ancients.png?q=50&amp;fit=crop&amp;w=1500&amp;dpr=1.5"/> <source media="(min-width: 768px)" sizes="943px" data-srcset="http://imgs.xkcd.com/comics/wisdom_of_the_ancients.png?q=50&amp;fit=crop&amp;w=943&amp;dpr=1.5"/> <source media="(min-width: 481px)" sizes="767px" data-srcset="http://imgs.xkcd.com/comics/wisdom_of_the_ancients.png?q=50&amp;fit=crop&amp;w=767&amp;dpr=1.5"/> <source media="(min-width: 0px)" sizes="480px" data-srcset="http://imgs.xkcd.com/comics/wisdom_of_the_ancients.png?q=50&amp;fit=crop&amp;w=480&amp;dpr=1.5"/> <img class="lazyload" alt="" data-img-url="http://imgs.xkcd.com/comics/wisdom_of_the_ancients.png" src="../Images/433168b44aa018cdb7132efee083f82b.png" data-original-src="http://imgs.xkcd.com/comics/wisdom_of_the_ancients.png"/> </picture> <figcaption class="body-img-caption">Source: XKCD</figcaption> </figure> </div>


 </div>


<p> </p>

<hr/>

<p><strong>一个微妙碎片问题的例子</strong></p>

<p>我自己并不是一名开发人员，但是经过多年在Tasker中的修补，我对Android的功能已经足够熟悉，我已经开始对我所面临的问题编写自己的解决方案。当我想不出什么的时候，我会像其他人一样去谷歌一下。当我在写我的上一篇关于<a href="http://www.xda-developers.com/heres-how-to-access-hidden-settings-on-your-phone/">挖掘你的手机设置应用程序的隐藏活动</a>的文章时，我遇到了一个我无法解释的相当奇怪的错误。华为设备特有的一个bug。</p>





<p>每当我试图在设置应用程序中启动某些活动(如包含应用程序使用统计数据的“测试”菜单)，我总是会遇到权限错误。特别是，我用来启动活动的应用程序缺少权限<strong>Huawei . Android . permission . HW _ SIGNATURE _ OR _ SYSTEM。</strong>我测试的其他设备都不需要任何独特的权限来启动这些设置活动，只有运行华为版本Android (EMUI)的手机才需要。对<em> com.android.settings </em>的分析显示，设置应用中的某些活动确实处于需要<a href="https://developer.android.com/guide/topics/manifest/permission-element.html">签名或系统许可</a>的保护级别之下。</p>

<p>对我来说不幸的是，这意味着只有安装在/system下的应用程序或使用与Settings应用程序相同的签名签名的应用程序才能使用我尝试的方法打开这些活动。当我谷歌搜索这个错误的答案时，我(你猜对了)遇到了一个<a href="https://stackoverflow.com/questions/28321686/permission-denial-with-action-pick-activity">堆栈溢出线程</a>。发布他的问题的开发人员遇到了和我一样的问题(尽管他实际上正在开发一个应用程序)。当他试图运行以下代码时，他的问题出现了:</p>

<pre> <code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>Intent<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span> mainIntent <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>=<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>new<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>Intent<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>(<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>Intent<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>.<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>ACTION_MAIN<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>,<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>null<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>);<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>mainIntent<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>.<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>addCategory<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>(<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>Intent<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>.<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>CATEGORY_LAUNCHER<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>);<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>Intent<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span> pickIntent <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>=<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>new<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>Intent<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>(<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>Intent<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>.<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>ACTION_PICK_ACTIVITY<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>);<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>pickIntent<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>.<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>putExtra<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>(<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>Intent<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>.<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>EXTRA_TITLE<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>,<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>"Pick App to Play in"<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>);<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>pickIntent<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>.<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>putExtra<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>(<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>Intent<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>.<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>EXTRA_INTENT<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>,<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span> mainIntent<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>);<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>this<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>.<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>startActivityForResult<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>(<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>pickIntent<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>,<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span> REQUEST_PICK_APPLICATION<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> &gt;</span>);<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></code> </pre>
<p>从意图中的字符串和开发者的网页判断，他可能试图允许用户选择第三方应用程序来播放一些媒体。由资深开发者<a href="https://stackoverflow.com/users/115145/commonsware"> CommonsWare </a>提供的修复非常简单:使用<a href="https://developer.android.com/training/sharing/send.html">意图。CreateChooser </a>而不是<a href="https://developer.android.com/reference/android/content/Intent.html#ACTION_PICK_ACTIVITY"> ACTION_PICK_ACTIVITY </a>。然而，<em>为什么</em>我们需要实现这个修复？<em>为什么</em>华为首先需要这种许可？<em>为什么</em>我们需要通过使用非常具体的谷歌搜索在StackOverflow上找到答案？</p>

<hr/>

<p><strong>选择的悖论</strong></p>

<p>为了找到答案，<a href="https://code.google.com/p/android/issues/detail?id=133419"> CommonsWare在Android bug tracker上提交了一份bug报告</a>,要求谷歌调查这个问题。特别是，开发人员要求谷歌禁止未记录的权限要求限制第三方应用程序访问ACTION_PICK_ACTIVITY。通过在<a href="https://source.android.com/compatibility/cts/"> CTS </a>中写入这些要求，华为将被迫遵守这些变化。</p>

<p>不过说实话，这个bug本身真的没什么大不了的。尽管我尝试过的其他应用程序(如Tasker)都无法绕过这个权限要求，在设置应用程序中启动某些活动，但我对结果并不失望。但当我想起安布利先生的咆哮时，我意识到像这样的小变化肯定很难处理，尤其是<strong>因为尽管它们可能很小，但它们无疑会</strong> <strong>累积起来</strong>，有时足以引起头痛。设置应用程序的一个微小变化可能会导致对开发人员的不当负面评价。一个很小的变化没有很好的记录，需要我在互联网上搜索堆栈溢出线程。<strong>其他设备上还有多少其他的小bug？</strong></p>

<p>事实证明，移动领域的竞争加剧对消费者来说是好事，但在看到这么多不同产品线之间的这些微妙变化如何影响开发者后，我开始欣赏开发者对碎片化的看法。这不是选择本身的问题，而是社区没有做足够的工作来分类这些问题。正如阿姆布里先生在他的文章中建议的那样，也许Android开发者需要他们自己版本的caniuse.com或sdkcritic.com，将所有不为人知的错误收集到一个数据库中。唯一的其他选择是让原始设备制造商适当地记录这些变化，或者从一开始就停止生产，但是<em>祝你好运。</em></p>

<p><em>特征图像演职员表:<a href="https://opensignal.com/reports/2015/08/android-fragmentation/">open signal</a>T3】</em></p>

 </div>


</div>    
</body>
</html>