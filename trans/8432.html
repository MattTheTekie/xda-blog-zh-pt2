<html>
<head>
<title>DSU Loader in Android 11 helps developers test apps on stock Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Android 11中的DSU加载器帮助开发者在现有的Android上测试应用</h1>
<blockquote>原文：<a href="https://www.xda-developers.com/android-11-dsu-loader-gsi-locked-bootloader-developers-test-apps-stock-android/#0001-01-01">https://www.xda-developers.com/android-11-dsu-loader-gsi-locked-bootloader-developers-test-apps-stock-android/#0001-01-01</a></blockquote><div><div class="content-block-regular">
<p/><p>良好的应用生态系统是操作系统成功的最重要支柱之一。谷歌和苹果都认识到在他们的平台上拥有优秀应用的价值，因此两家公司都试图平衡用户和应用开发者的需求。用户不断推动操作系统的变化，尽管大多数人普遍喜欢新功能，但这些变化对应用程序开发人员来说并不总是有趣的，因为它们可以改变许多核心功能和行为。对于不断努力保持应用程序相关性的开发人员来说，处理这些变化增加了他们不断增长的工作列表。即使这些变化不会直接影响他们的应用程序，开发人员仍然需要确保他们的应用程序能够在新的操作系统更新上工作。谷歌多年来做了许多改变，让Android应用程序开发人员更容易完成这一过程，现在，Android 11中一个名为DSU加载器的新功能将使应用程序开发人员更容易在新的Android版本上测试他们的应用程序。</p>

 
<h2 id="it-starts-with-project-treble">从高音项目开始</h2>
<p>Android 8.0中引入的Project Treble是对Android操作系统的重大<a href="https://www.xda-developers.com/googles-project-treble-modularize-android-so-oems-can-update-devices-faster/">重新架构。Project Treble的目标是将Android操作系统分成两大块:框架和供应商实现(“供应商”在这里是指设备中任何专有硬件组件的制造商，通常指芯片)。Android OS框架是操作系统本身，包括所有系统应用程序、UI及其组件，以及跨Android设备共享的API。供应商实现包含供应商HALs(硬件抽象层)以及Linux内核和Linux内核模块。</a></p>

<p>由于原始设备制造商从许多不同的供应商那里发运带有许多不同硬件组件的智能手机，他们不得不做大量的工作，仅仅是让硬件在一个单一的Android操作系统版本上运行。然后，随着每个新的Android操作系统更新，他们必须做更多的工作，以确保他们的硬件与新版本兼容。但随着Project Treble标准化Android OS框架和特定Android版本的HALs之间的ABI(应用程序二进制接口)，Android OEMs可以开始测试他们设备的更新，而无需等待芯片制造商和其他组件制造商更新他们这边的代码。这一变化明显加快了Android更新的处理速度。</p>

<p>这是Project Treble为Android更新所做工作的要点，但对应用程序开发人员来说，更重要的是Treble支持使用通用系统映像(GSI)进行兼容性测试。</p>
<p class="ad-odd"> </p>


<h2 id="the-emergence-of-gsis">GSIs的出现</h2>
<p>为了让原始设备制造商测试他们是否正确实施了Project Treble，谷歌要求原始设备制造商应该能够在设备上引导来自AOSP的干净的Android版本。这种干净的Android版本被称为通用系统映像，或GSI。如果GSI启动并且大多数基本硬件功能正常，那么OEM知道他们的设备满足Project Treble的要求。因此，GSIs的最初目的是测试三重兼容性，但正如我们在XDA开发者社区看到的那样，它们可以用于其他目的。<a href="https://www.xda-developers.com/how-project-treble-revolutionizes-custom-roms-android-oreo/">我们看到了GSIs </a>如何让搭载大量Android UXs的设备在新版本发布后的几天内享受最新版本的Android功能。但谷歌设想了GSI背后的另一个目的:让应用程序开发者能够在他们已经拥有的物理设备上，在新的安卓版本上测试他们的应用程序。</p>

<p>在Android 10中，谷歌为开发者发布了自己的GSI版本。谷歌坚持认为，应用程序开发人员应该使用GSI在他们自己的硬件上引导一个干净的Android版本，这样更容易测试他们的应用程序在普通Android上的行为。因此，这种方法增加了在不改变OEM行为的情况下在现有Android上测试应用兼容性的现有选项，其他选项包括使用Pixel智能手机，在Android Studio中使用官方Android仿真器，或将应用构建部署到云上的设备实例。</p>

<p>尽管GSIs带来了诸多便利，但它们的安装仍然是一个繁琐的过程。应用程序开发人员可能不习惯在Android设备上手动刷新系统映像，因为这通常只有业余爱好者或Android操作系统开发人员才会熟悉。安装GSI需要通过快速启动刷新系统映像，这需要禁用Android验证启动并解锁启动加载程序。反过来，引导加载程序解锁需要完整的用户数据擦除。众所周知，没有一个完全单一的过程或指南来解锁所有Android设备的引导程序，所以没有一致性可言。例如，三星设备没有快速启动功能，而小米设备需要你跳过几道关卡才能解锁启动程序。这是一个方便的混乱，有可能被解开成更简单的东西。</p>

<p>这就是动态系统更新的用武之地。</p>
<p class="ad-even"> </p>


<h2 id="dynamic-system-updates-simply-installing-gsis">动态系统更新只需安装GSIs</h2>
<p>谷歌意识到目前安装GSIs的方法并不是一个完美的解决方案，所以他们开始研究一个更好的解决方案。在Android 10中，<a href="https://www.xda-developers.com/android-q-dynamic-system-updates-project-treble/">谷歌开始测试动态系统更新</a>，即DSU。DSU是一种临时安装GSI的新方法，不需要使用fastboot命令来刷新系统映像，覆盖原来的安装。有了DSU，你可以启动进入GSI，测试你的应用程序，然后方便地重新启动到你的原始安装，保持不变。</p>

<p>DSU可以安装一个GSI而不接触原来的安装的原因是它创建了新的系统和数据分区镜像，这些镜像临时存储在<em> /data/gsi </em>中。然后在引导过程中挂载这些映像，而不是原始的系统和数据分区。因为手机需要额外的存储空间来存储这些新的临时图像，所以你的手机必须有“逻辑分区”，这是可动态调整大小的分区。逻辑分区是Android的一个新的用户空间分区系统，对于使用Android 10的设备是强制性的。如果你的设备安装了Android 10，那么它应该支持通过DSU安装GSI。</p>

<p>在Android 10中，通过DSU 安装一个GSI<a href="https://developer.android.com/topic/dsu">所需要做的就是更改一个系统属性，然后通过发送一个带有GSI路径的意向作为意向额外项来启动<em>DynamicSystemUpdatesInstallationService</em>。</a></p>

 



<p>虽然这个过程可能看起来不熟悉，但与使用fastboot命令和处理一切麻烦(包括删除原始安装)相比，它要简单得多，干扰也少得多。你确实需要一些亚洲开发银行的知识和利用DSU的意图，但这对大多数应用程序开发人员来说应该不是问题。尽管如此，没有理由让这个过程变得更简单。另外，通过DSU安装GSI仍然需要你解锁引导程序，在这个过程中清除所有用户数据。为此，谷歌实施了一些改变，以改善GSI安装的两个方面。在Android 11中，他们不再需要使用命令行来安装GSI。另外，他们还使得在不解锁引导程序的情况下安装GSI成为可能。</p>
<p class="ad-odd"> </p>


<h2 id="dsu-loader-in-android-11">Android 11中的DSU加载器</h2>
<p>DSU加载器是Android 11开发者选项中的一个新工具，它允许你从谷歌<span>下载<strong>和</strong>安装</span>最新的GSI，而不需要输入任何快速启动或ADB命令。只需点击“设置”中的“DSU加载器”选项，就会出现一个对话框，其中列出了直接来自谷歌的支持的GSI。这些受支持的GSI将基于您当前的操作系统和架构，因此您只能安装比您的操作系统版本更新且与您的SoC架构匹配的GSI。只需选择你想要安装的GSI，它就会从谷歌的服务器上下载并自动安装在后台。</p>
<div class="body-img portrait"><div class="responsive-img image-expandable img-article-item-portrait" data-img-url="https://static1.xdaimages.com/wordpress/wp-content/uploads/2020/03/Android_11_DSU_Loader-512x1024.jpg" data-modal-id="single-image-modal" data-modal-container-id="single-image-modal-container" data-img-caption="&quot;DSU Loader on Android 11&quot;">
 
<figure> <picture>  <source media="(min-width: 1024px)" sizes="750px" data-srcset="https://static1.xdaimages.com/wordpress/wp-content/uploads/2020/03/Android_11_DSU_Loader-512x1024.jpg?q=50&amp;fit=crop&amp;dpr=1.5"/> <source media="(min-width: 768px)" sizes="750px" data-srcset="https://static1.xdaimages.com/wordpress/wp-content/uploads/2020/03/Android_11_DSU_Loader-512x1024.jpg?q=50&amp;fit=crop&amp;dpr=1.5"/> <source media="(min-width: 481px)" sizes="600px" data-srcset="https://static1.xdaimages.com/wordpress/wp-content/uploads/2020/03/Android_11_DSU_Loader-512x1024.jpg?q=50&amp;fit=crop&amp;dpr=1.5"/> <source media="(min-width: 0px)" sizes="360px" data-srcset="https://static1.xdaimages.com/wordpress/wp-content/uploads/2020/03/Android_11_DSU_Loader-512x1024.jpg?q=50&amp;fit=crop&amp;dpr=1.5"/> <img class="lazyload" alt="" data-img-url="https://static1.xdaimages.com/wordpress/wp-content/uploads/2020/03/Android_11_DSU_Loader-512x1024.jpg" src="../Images/192526ef3ef3f77996cbf98107f0caeb.png" data-original-src="https://static1.xdaimages.com/wordpress/wp-content/uploads/2020/03/Android_11_DSU_Loader-512x1024.jpg"/> </picture> <figcaption class="body-img-caption">DSU Loader on Android 11</figcaption> </figure> </div>


 </div>


<p>有了DSU加载器，开发人员永远不必接触命令行来安装GSI。至少，这是梦想，因为还有一个问题需要解决。</p>
<p class="ad-even"> </p>


<h2 id="the-way-forward">前进的道路</h2>
<p>目前，要通过DSU加载器安装GSI，你需要一个解锁的引导加载器。虽然这可能会挫败整个磨难的目的，但它不应该是这样的，我们被告知它会得到修复。谷歌计划让用户能够通过DSU启动谷歌签名的GSI，而无需解锁引导程序。事实上，谷歌要求所有Android 10发布设备都包含谷歌签署的Android 10、Android 11和Android 12 GSIs的Android验证启动公钥。在设备的内存中包含AVB公钥将确保AVB不会拒绝你试图启动的GSI。这就是为什么当前的方法包括解锁引导加载程序——通过将一个空的vbmeta映像刷新到vbmeta分区，您可以禁用AVB，这样它就不会拒绝您将要刷新的GSI。然而，禁用AVB是一个主要的安全风险，因为这意味着任何修改过的系统/引导/产品/供应商分区都可以加载到设备上，这就是为什么谷歌希望取消这一要求。</p>
<div class="body-img landscape"><div class="responsive-img image-expandable img-article-item" data-img-url="https://static1.xdaimages.com/wordpress/wp-content/uploads/2020/03/Android_10_GSI_Launch_Requirements-1024x168.jpg" data-modal-id="single-image-modal" data-modal-container-id="single-image-modal-container" data-img-caption="&quot;Android 10 GSI Launch Requirements&quot;">
 
<figure> <picture>  <source media="(min-width: 1024px)" sizes="1500px" data-srcset="https://static1.xdaimages.com/wordpress/wp-content/uploads/2020/03/Android_10_GSI_Launch_Requirements-1024x168.jpg?q=50&amp;fit=crop&amp;w=1500&amp;dpr=1.5"/> <source media="(min-width: 768px)" sizes="943px" data-srcset="https://static1.xdaimages.com/wordpress/wp-content/uploads/2020/03/Android_10_GSI_Launch_Requirements-1024x168.jpg?q=50&amp;fit=crop&amp;w=943&amp;dpr=1.5"/> <source media="(min-width: 481px)" sizes="767px" data-srcset="https://static1.xdaimages.com/wordpress/wp-content/uploads/2020/03/Android_10_GSI_Launch_Requirements-1024x168.jpg?q=50&amp;fit=crop&amp;w=767&amp;dpr=1.5"/> <source media="(min-width: 0px)" sizes="480px" data-srcset="https://static1.xdaimages.com/wordpress/wp-content/uploads/2020/03/Android_10_GSI_Launch_Requirements-1024x168.jpg?q=50&amp;fit=crop&amp;w=480&amp;dpr=1.5"/> <img class="lazyload" alt="" data-img-url="https://static1.xdaimages.com/wordpress/wp-content/uploads/2020/03/Android_10_GSI_Launch_Requirements-1024x168.jpg" src="../Images/b1cc9ff33d3d5784c3639884fd2f636b.png" data-original-src="https://static1.xdaimages.com/wordpress/wp-content/uploads/2020/03/Android_10_GSI_Launch_Requirements-1024x168.jpg"/> </picture> <figcaption class="body-img-caption">Android 10 GSI Launch Requirements</figcaption> </figure> </div>


 </div>


<p>那么，你什么时候能指望通过DSU引导GSI而无需解锁引导程序或使用任何命令行工具呢？希望很快，因为谷歌向我们提到，他们有一些问题要解决，最初的Android 11开发者预览版才能正常工作。展望未来，人们可以通过DSU安装未来的开发者预览版GSIs，而无需解锁引导加载程序。或许当Android 12开发者预览版发布时，你甚至可以完全通过使用Android 11开发者选项中的DSU加载器来启动它。对于应用开发者来说，这意味着你将有另一种方法在运行新版本Android的物理硬件上测试你的应用。</p>

 </div>


</div>    
</body>
</html>