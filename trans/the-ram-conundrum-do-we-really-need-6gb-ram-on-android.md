# RAM 难题:我们真正需要多少 RAM？

> 原文：<https://www.xda-developers.com/the-ram-conundrum-do-we-really-need-6gb-ram-on-android/>

最近，我们被告知首批运行 Android 的智能手机之一，配备 6GB 内存。

该死的 GB！这在移动设备中是很大的内存。

启动数字游戏的是 [Vivo Xplay5 Elite](http://www.xda-developers.com/xda-external-link/vivo-confirms-the-xplay-5-comes-with-the-snapdragon-820-and-6gb-of-ram/) 。作为一家公司，Vivo 在中国以外可能并不太知名，但值得称道的是，该公司过去曾生产过一些非常薄的智能手机。凭借 Xplay5 Elite，他们试图在一款旨在跻身王者之列的设备中融入大量规格。

Vivo Xplay 5 Elite 在机身的金属框架上采用了双曲面 5.43 英寸 QHD Super AMOLED 显示屏。内部有最新的高通骁龙 820 SoC，主频为 2.15 Ghz，Adreno 530 GPU，6GB 的 LPDDR4 RAM 和 128GB 的不可扩展存储。相机方面，后置 16MP 索尼 IMX298 传感器，f/2.0，前置 8MP 摄像头。考虑到这些规格和设备的金属构造，即使对中国消费者来说，它的价格也会相当高也就不足为奇了。这款车标价 4288 CNY(660 美元)，当然是一款中国旗舰车，而不是价格适中的中档车。

Vivo Xplay5 Elite 并不是目前唯一一款拥有 6GB 内存的智能手机。一家鲜为人知的新成立的中国 OEM 厂商 Vernee 旨在通过推出一款中端设备 Vernee Apollo，为消费者带来更大的海量 RAM 可访问性。

Vernee Apollo 将搭载联发科的高端 SoC Helio X20。将有前面提到的 6GB 内存、128GB 内部存储、21MP 索尼 IMX230 后置摄像头和 5.5 英寸 2K 显示屏。算上所有这些，阿波罗的价格是 399.99 美元。发给我们的新闻信息没有提到中国的价格或目标市场，所以这款手机仍然有点神秘。

> 这两款手机都要求我们问一个问题，我们现在真的需要这么多内存吗？

要回答这个问题，我们必须了解 Android 是如何处理内存管理和 RAM 的。在之前的一篇文章中，Mishaal 在解释 Android 内存管理的复杂性方面做了出色的工作，这篇文章在六个月后仍然保持其相关性。

Android 处理内存管理的方式是这样的:不是在活动结束后立即杀死每个进程(就像当你按下 home 键退出应用程序时)，而是将进程保存在内存中，直到系统需要杀死它来释放更多内存。系统是如何决定保留什么进程和杀死什么进程的？LMK(低内存黑仔)驱动程序。ActivityManager 服务为每个进程分配一个范围为-17 到 15 的 oom_adj 值，该服务根据进程的重要性动态调整 oom_adj 值。较高的 oom_adj 值意味着进程更有可能被终止以释放内存，而较低的值意味着进程不太可能被终止。

Android 将每个进程分为五类(前台、可见、服务、后台和空),从最重要到最不重要。属于每个类别的进程在不同的剩余空闲内存级别(称为 LMK 最小空闲值)被终止。例如，如果您的设备的 LMK minfree 值设置为“2560，4090，6144，7168，8192”(列为 4k 页，可以从/sys/module/lowmemorykiller/parameters/minfree 中读取)，那么当您的可用内存低于 32MB 时，您的设备将终止定义为“空”的进程，当可用内存低于 28MB 时，终止定义为“后台”的进程，当可用内存低于 10MB 时，终止前台应用(**但愿不会如此！**)如今，这些 minfree 值在大多数设备上并不典型，因为制造商喜欢根据他们觉得最适合他们设备的方式来调整这些值。但是你应该从这个简短的解释中得到的是，你拥有的空闲内存越多，你看到关键进程被终止的可能性就越小。

正如 Mishaal 提到的，实际值因 OEM 而异，因此在类似规格的不同手机上进行多任务处理时，您可能会有不同的体验。组合中的另一个变量是设备上膨胀软件的数量。像 TouchWiz 这样经过大量修改的 Android UXs 往往会在基于股票 AOSP 的 Android 上添加许多功能，因此，需要向系统分配更多的资源，才能在 OEM 希望的水平上运行。这使得第三方应用的缓存空间变小，从而加剧了内存不足的问题。

## **多半是**软的

"*具有 2GB 内存的设备与具有 3GB 内存的设备之间的主要区别在于，具有 3GB 内存的设备应该能够在后台缓存更多进程，而不会触发 LMK 驱动程序将其关闭。*

因此，从理论上讲，硬件级可用的 RAM 越多，操作系统级缓存的进程就越多，OEM 可以共享的内存池也就越大。但通常情况下，即使在 2GB 内存的设备上，即使在系统和应用程序锁定了他们需要的内存之后，你也会看到更多的空闲内存。这是来自 Mishaal 的帖子的同一个图库，比较了各种设备的空闲内存:

正如你所看到的，具有最轻 UI 的设备，如 Nexus 5 和 Nexus 6，在设备上具有最大比例的可用内存。即使是其中最重的，拥有 4GB 内存和 TouchWiz 的三星 Galaxy Note 5，也有大约 1.7GB 的内存可用于应用缓存。即使有这么大的空闲内存池，Note 5 也存在多任务问题，该设备将求助于积极的内存处理。这是因为原始设备制造商选择了 LMK 价值观:在硬件层面注入更多的内存没有任何帮助！Note 5 改善多任务处理的修复实际上包括调整这些 LMK 值，使其比三星的股票设置更有利于多任务处理，这对一款专注于生产力的设备来说是一种讽刺。因此，仅仅有更多的内存不会自动使设备更加多任务友好。

再次回到图库，显示的一部分空闲 RAM 已经用于应用程序进程缓存，但这一部分实际上仍处于闲置状态，什么也没做。这里是我的 OnePlus One 的一些截图，显示了显示的空闲内存，然后分为缓存内存和空闲内存:

即使在我退出一个活动游戏并选择显示缓存进程的大约 1 秒钟的时间里，系统也努力减少了实际使用的 RAM。发生这种情况是因为这个游戏，在这种情况下，NFS 没有限制，有一个优先级的变化，从前台进程移动到后台进程。这样做是为了保持操作系统始终流畅，因为活跃使用的 RAM 从 2.5GB 变为 1.9GB，而 NFS 无限游戏进程被缓存。随着游戏优先级的改变，如果操作系统实际上需要更多的空闲内存，它现在是可以被杀死的。这里不需要用户交互。

这个例子的目的是为了强调 Android 的内存管理是如何发展的，如何更有效地对系统及其所有进程进行优先级排序。在任何时候，保持缓存的应用程序都是有限的:理想情况下，操作系统不会在缓存过程中使用全部空闲内存。一部分空闲 RAM 处于空闲状态。这是特意设计的，用于某个进程可能需要快速增加 RAM 使用量的情况。

应用程序进程也有一个 RAM 分配上限，这也是由 OEM 为单个手机定义的。根据 Android 框架工程师 Dianne Hackborn 的一篇旧的讨论文章(T1 ),在垃圾收集开始之前，java 对象驻留的 Java 堆(T3)是有限制的，但是即使这样，也可以通过巧妙使用 NDK 来扩展。简而言之，这意味着任何想要在该设备上运行的应用程序都有一个最大的内存上限。对于较旧的设备，该堆被设置为 24MB，但是在最近的设备上，由于设备中 RAM 的增加以及硬件需求的增加，该堆的大小已经增加。Android 的[兼容性定义文档](http://source.android.com/compatibility/downloads.html)针对 [Android 6.0](http://source.android.com/compatibility/downloads.html) 提到(第 3.7 节)OEM 应该设置这些堆的最小值。相比之下，我在 CM12.1 上的 OnePlus One 拥有 192MB 的正常 Dalvik 虚拟机堆限制，并允许多达 512MB 的应用程序在其应用程序清单中指定 android:largeHeap=true。理论上，我的设备上一个应用程序最多只能使用 512MB 内存。除此之外，垃圾收集将被启动，以保持其他必要的系统进程自由流动。

现在，将应用程序的堆大小限制与根据优先级分配给它们的 LMK 值结合起来，以及操作系统坚持保持一定量的空闲 RAM 空闲，您可以想象 Android 的多任务处理是如何工作的。这是一个复杂的机制，涉及硬件、软件和应用程序本身之间的许多变量；理论上，即使是最基本的设备也可以运行，同时仍然允许最好的旗舰充分利用它们的潜力。实际上，这不是一个完美的世界，所以这两种情况都不会发生。这意味着不能保证一个 4GB 内存的设备与另一个 4GB 内存的设备工作得一样好。这也不意味着超过某个阈值的额外 1gb 内存会直接增加多任务处理和内存处理能力。

### 实用与未来

所以，回到最初的问题，**在 2016 年初，你的设备真的需要 6GB 内存吗？**对我来说，答案是否定的。

我拥有的大多数设备都有 3GB 的 LPDDR3 RAM，其中一个有 4GB 的 RAM。在多任务处理方面，性能没有明显的差异。这是我最近的 OnePlus X 评测中的一个多任务演示，这是一个具有 3GB 内存和接近库存的 Android ROM 的设备:

该设备在 12 个应用程序之间切换没有问题(如果你算上活动的屏幕录制器，就是 13 个)，而不必关闭这些应用程序。没有重新加载和重新绘制，这种体验在日常使用中保持了惊人的一致性，没有任何重新启动或手动取消应用程序。一个普通消费者在实际使用过程中根本不需要在这么多 app 之间主动切换！

但是如果用户希望在这么多游戏之间切换呢？同意，上面提到的因素将发挥作用，最多只允许在几个游戏之间切换。在这种情况下，拥有更多的物理内存会让设备在内存中被动地保存更多的游戏。但是与这个优势相反的是，很多游戏在多任务处理时经常会强制重新加载！他们的目的是避免作弊机制在游戏运行时操纵游戏数据，因此重新加载/重新同步/刷新会强制完整性检查再次发挥作用。他们的意图是不同的，但这使得很多游戏不适合多任务处理。

还有一些其他的因素，会阻止你从那些辉煌的公羊中获益。如果您确实发现一项任务/几项任务组合起来需要您设备的所有 6GB lpddr 4 RAM，那么您在移动 SoC 的形式上会遇到更大的瓶颈。诚然，Snapdragon 820 和 Helio X20 可能是各自公司的旗舰处理器，但它们仍然是移动 SoC。因此，它们有其他限制，如发热、散热、热节流和电池寿命，这使它们成为长时间使用如此多 RAM 的密集型任务的糟糕选择。在这种情况下，你最好使用一个不能拿在手里的系统；它对产生的热量和消耗的能量有更自由的限制。

最终，不管你有多少空闲内存，应用程序还是会被踢出去。这就是内存管理的工作方式。加大 RAM 仍然有好处，比如堆大小的进一步增加将有助于在更高分辨率的显示器上为位图资产提供动力，允许我们在设备上超越 QHD 分辨率。堆大小的增加是整个市场的趋势，这将导致应用程序渴望做更多的事情。除非 RAM 被锁定为不可接触的，否则它总会有这样或那样的用途。但考虑到旗舰机的屏幕似乎徘徊在 1080p 和 1440p 之间，我们可能会认为 4GB 是未来一两年的合理标准。

最后，我们来回答这个问题:我们现在真的需要这么多内存吗？不，我们没有。对于价格是他们需要保持低价的因素之一的设备，3GB 或 4GB 的 RAM 就足够了。对于那些不太在乎价格的用户有需求的旗舰机来说，这不会损害未来的证明。作为客户，请注意，您暂时不会使用所有的 RAM。

你对 6GB 内存的手机有什么想法？请在下面的评论中告诉我们你的想法！