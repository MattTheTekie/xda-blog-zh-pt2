<html>
<head>
<title>SultanXDA Explains Unified ROM Approach on the OnePlus 3/3T</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>SultanXDA解释了OnePlus 3/3T上的统一ROM方法</h1>
<blockquote>原文：<a href="https://www.xda-developers.com/sultanxda-explains-unified-rom-approach-on-the-oneplus-3-and-oneplus-3t/#0001-01-01">https://www.xda-developers.com/sultanxda-explains-unified-rom-approach-on-the-oneplus-3-and-oneplus-3t/#0001-01-01</a></blockquote><div><div class="content-block-regular">
<p/><p>当我们报道XDA知名开发商<a href="http://forum.xda-developers.com/member.php?u=4800121"> Sultanxda </a>发布了他的<a href="https://www.xda-developers.com/sultanxdas-unofficial-cyanogenmod-13-lands-on-the-oneplus-3t-through-unified-builds/">定制CyanogenMod 13 ROM和OnePlus 3T </a>内核时，许多人惊讶地看到为OnePlus 3T发布的“相同”ROM版本也出现在了OnePlus 3上(反之亦然！).</p>

  
<p>Sultanxda采用统一的方法为<a href="http://forum.xda-developers.com/oneplus-3"> OnePlus 3 </a>和<a href="http://forum.xda-developers.com/oneplus-3t"> OnePlus 3T </a>分发rom，因为它们的硬件和低级软件非常相似。这意味着ROM提供了两种设备之间的交叉兼容性，可以将相同的ROM压缩文件分发给两个设备。交叉兼容的zip允许用户(以及开发者)不必担心意外地刷新错误的zip并得到一个砖砌的设备。这并不是说OnePlus 3/3T很容易砌砖——它只是让所有相关方都不那么头疼。</p>

<p>为了鼓励采用他的方法，我们联系了XDA公认的开发者Sultanxda，让他对整个过程做了更多的解释。以下是从对话中获得的重点内容:</p>

<h3 id="what-is-different-on-the-oneplus-3-3t-that-allows-for-unified-roms">允许统一rom的OnePlus 3/3T有何不同？</h3>
<p/><p>统一ROM之所以可能，是因为一加统一了BSP(专有库)[板支持包]。尽管统一内核很容易，但统一ROM对于[ROM]开发者来说通常是不可能的，因为BSP中的不一致性只有OEM才能解决。<strong>在我这边，我所要做的就是统一内核，分离一些GPU固件镜像。Snapdragon 820和821之间的GPU固件映像不同，因此它们不能交叉兼容。</strong>我修改了内核，让它<a href="https://github.com/sultanxda/android_kernel_oneplus_msm8996/commit/1982414e09b5d34a8fc6d9aa0646d30cf6eec958">为每个设备加载正确的GPU固件</a>来解决这个问题。然后我<a href="https://github.com/sultanxda/proprietary_vendor_oneplus/commit/c65ab93923769e7c65fcea798ffff0ddb5ec213b">在这个提交中将相应的固件映像</a>添加到ROM中。其余特定于设备的固件映像(如调制解调器映像)位于每个设备上的固件分区中，因此<strong>GPU问题</strong>  <em> <strong>是我面临的唯一与固件相关的问题</strong>。</em></p>

<h3 id="how-do-the-rom-and-kernel-figure-out-which-device-it-is">ROM和内核如何判断它是哪个设备？</h3>
<p>多亏了引导装载程序，内核知道它运行在哪个设备上。引导加载程序选择与其主板ID匹配的设备树配置(打包到内核映像中),并将此配置传递到内核。这使内核能够灵活地为OnePlus 3和OnePlus 3T加载适当的配置。您可以通过超链接找到<a href="https://github.com/sultanxda/android_kernel_oneplus_msm8996/blob/9857213361a3ade42786d03ea6347136a6ebd60f/arch/arm/boot/dts/qcom/msm8996-v3.0-pmi8996-mtp_15801.dts#L23"> OnePlus 3 </a>和<a href="https://github.com/sultanxda/android_kernel_oneplus_msm8996/blob/9857213361a3ade42786d03ea6347136a6ebd60f/arch/arm/boot/dts/qcom/msm8996pro-pmi8996-mtp_15811.dts#L23"> OnePlus 3T </a>的板卡ID。</p>

<h3 id="do-you-only-need-a-modified-kernel-to-support-unified-builds">你只需要一个修改过的内核来支持统一构建吗？</h3>
<p/><p><em> <strong>不，ROM也必须统一。</strong>一加从OP3的公开Betas版开始统一BSP，并在OP3T OxygenOS正式版中保持统一。<strong>这意味着rom必须使用OP3开放测试版或OP3T官方OxygenOS版本的专有库才能实现统一。</strong>还有我上面描述的GPU固件镜像要求，OP3T的触摸屏固件也需要包含在ROM中(这是在我上面链接的GPU固件提交中添加的)。</em></p>

<p/><p>此外，对于统一内核有一个警告:开发人员必须要么使用我的内核(已经统一)，要么他们必须在OP3T的OxygenOS内核中添加OP3支持。由于骁龙821的不完全支持，对OP3T的支持不能简单地添加到OP3的内核中，因此统一可能需要有意愿的OP3开发者做大量的工作。当我收到OP3T时，我的内核已经完全支持骁龙821(因为我的内核是基于CAF的骁龙821分支)，所以统一过程对我来说相当容易。</p>

<p/><p>我相信很多开发人员更愿意使用OP3T的OxygenOS内核，而不是我的内核，这需要在它上面添加对OP3的支持。我并没有考虑为OxygenOS ROMs开发一个统一的内核，所以可能需要做更多的工作来实现它。</p>

<h3 id="can-other-developers-take-a-look-at-the-code-and-see-how-this-is-done">其他开发人员可以看看代码，看看这是如何做到的吗？</h3>
<p>是的。Sultanxda提到他所有的作品都可以在他的<a href="https://github.com/sultanxda"> GitHub账户</a>上公开获得，所以任何有必要知识的人都可以看到ROM的统一是如何进行的。当然，这个过程有点复杂，需要一定水平的专业知识，但是<strong>这是一个“一劳永逸”的过程</strong>，好处是维护更少，重复工作更少，而且人们不会混淆两个设备的文件，因为只有一个zip文件可以用于两个设备。一旦ROM或内核被统一并被确认在OnePlus 3和OnePlus 3T上完全可用，就只需要很少的额外工作。</p>

<hr/>

<p>我们希望我们带来了新的信息，这将有助于更多的开发者选择设备的统一版本。<a href="https://www.xda-developers.com/cyanogenmod-14-1-joins-oneplus-3ts-rom-roster-as-development-picks-up/">OnePlus 3T上的开发正在增长</a>，统一版本是这两款设备未来的发展方向。</p>

 </div>


</div>    
</body>
</html>