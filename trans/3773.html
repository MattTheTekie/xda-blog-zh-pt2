<html>
<head>
<title>Google May Finally Enable Custom Themes Built on Sony's RRO Framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>谷歌可能最终启用基于索尼RRO框架的定制主题</h1>
<blockquote>原文：<a href="https://www.xda-developers.com/google-preparing-enable-custom-themes-built-on-sony-rro-framework/#0001-01-01">https://www.xda-developers.com/google-preparing-enable-custom-themes-built-on-sony-rro-framework/#0001-01-01</a></blockquote><div><div class="content-block-regular">
<p/><p>如果你还不知道，谷歌在昨天的I/O活动中发布了第二个Android O开发者预览版(Android O DP2)。我们已经<a href="https://www.xda-developers.com/heres-everything-new-in-android-o-developer-preview-2/">深入研究了到目前为止我们发现的所有新东西</a>，但是有一件关于DP2的事情困扰着我。每个<a href="https://www.xda-developers.com/android-o-beta-program-is-live/">收到测试版更新或者手动刷新</a>新图片的人都很快在快速设置中遇到了<a href="https://www.xda-developers.com/heres-everything-new-in-android-o-developer-preview-2/#QuickSettings">完全不同的用户界面</a>。谷歌究竟为什么决定改变主题？经过更多的测试和挖掘，我得出了一个结论。不管出于什么原因，谷歌已经决定将其<a href="https://www.xda-developers.com/android-o-adds-inverted-light-theme-to-display-options/">“倒置”主题</a>设为默认主题；也许当该公司正在测试一个基于索尼运行时资源覆盖的定制主题方案时，他们无法在Android O Beta发布前及时获得默认的像素主题。</p>

 




<p/><p><em>Android O开发者预览版2中的默认系统主题</em></p>

<p/><p>鉴于谷歌在Android 6.0棉花糖中实现了对RRO的支持，Android O的主题化框架基于索尼的RRO，这对一些人来说似乎是显而易见的，尽管这需要你有一个根设备。然而，由于Android O的源代码还没有发布，暗示Android O中的这个系统主题实际上是RRO纯属猜测。这就是为什么我们<a href="https://www.xda-developers.com/android-o-adds-inverted-light-theme-to-display-options/">最初对这个神秘设定的报道</a>，以及<a href="http://www.androidpolice.com/2017/03/21/android-o-feature-spotlight-looks-like-android-may-getting-native-support-themes/">其他网站做的报道</a>，都没有把这个联系起来。但是有几个证据将这一功能与主题化框架联系起来，我们认为这应该最终表明<strong> Android O的设备主题是基于RRO </strong>的。有了RRO的支持，这可能<strong>最终会为我们一直在等待的</strong>非RRO用户提供主题化解决方案。</p>

<hr/>


<h2 id="what-is-runtime-resource-overlay-rro">什么是运行时资源覆盖(RRO)？</h2>
<p>RRO是索尼开发者创建的主题框架，为索尼的Xperia主题提供动力。RRO的美妙之处在于，它允许您替换应用程序资源，而不必修改应用程序的源代码。这是通过使用覆盖层实现的，覆盖层包含自己的资源字符串，用于在应用程序加载时替换覆盖的应用程序的资源。</p>

 
<p class="w-rich w-youtube" id="it0WEuVUp7o">  </p>


<p>对于那些看到“RRO”并想到“层”的人来说，你已经很接近了。Layers是索尼RRO的一个略微修改的版本，但在基础级别上，它的工作方式非常相似。RRO/Layers将主题apk“安装”到/system/vendor/overlay。在启动时，包管理器读取这些apk，验证它们，然后使用<em> <a href="https://github.com/android/platform_frameworks_base/blob/master/cmds/idmap/idmap.cpp"> idmap </a> </em>将其链接到系统资源表中。你可以阅读由<a href="https://plus.google.com/+SykoPompos/posts/VeQgiWgiktt"> SykoPompos </a>(现已废弃)<a href="https://play.google.com/store/apps/details?id=com.lovejoy777.rroandlayersmanager&amp;hl=en">图层管理器</a>应用程序的开发者撰写的更全面的常见问题。</p>



<p/><p><em>弃用的图层管理器应用截图</em></p>

<hr/>

<p/><p><strong>推荐阅读:</strong> <a href="https://www.xda-developers.com/a-brief-history-of-theming-from-oem-themes-to-rro-layers/">主题化简史:从OEM主题到RRO层</a></p>

<hr/>

<p>当然，Android定制ROM社区中很少有人还在使用基于RRO的主题引擎。大多数已经转移到另一个主题引擎，如<a href="https://www.xda-developers.com/layers-manager-is-being-deprecated-in-favor-of-substratum/"> Substratum </a>，这是一个基于叠加管理器服务(OMS)的层的进化。(CyanogenMod主题引擎(CMTE)是另一个流行的主题框架，尽管<a href="https://www.xda-developers.com/exclusive-dead-cyanogenmod-theme-engine-cmte-not-coming-back-lineageos-replacement/">它的未来仍然悬而未决</a>。)然而，即使你没有使用OMS提交的定制ROM，<a href="https://play.google.com/store/apps/details?id=projekt.substratum&amp;hl=en">底层主题引擎应用</a>仍然支持使用“底层遗产”主题的能力，这些主题只是RRO/Layers主题。也正因为如此，用户开始搞清楚Android O的设备主题和RRO是一回事。</p>

<hr/>
<p class="ad-odd"> </p>


<h2 id="google-finally-introduces-theming-through-rro">Google最终通过RRO引入了主题化</h2>
<p>在一篇<em> AndroidPolice </em>文章的<a href="https://disqus.com/home/discussion/androidpolice/android_o_feature_spotlight_quick_settings_are_now_grayscale_get_some_small_cosmetic_tweaks/#comment-3311099015">评论部分，</a> XDA知名开发者<a href="https://forum.xda-developers.com/member.php?u=5222551"> Maxr1998 </a>发布了一张截图，声称Substratum Legacy主题出现在谷歌的设备主题选择器中。</p>





<p>左边可以看到Android O开发者预览版1上Maxr1998安装的叠加apk列表。在右边，你可以看到Android O开发者预览版2中的两个主题选择。<a href="https://www.xda-developers.com/android-o-adds-inverted-light-theme-to-display-options/">之前在Android O DP1 </a>中，两个选项是“像素”和“反转”,其中“像素”设置为默认，而“反转”类似于O DP2中默认的灰度外观。</p>

<p>但是仔细看看O DP2中默认主题的名字。叫做“android.auto_generated_rro。”一个非常奇怪的名字，但名字中包含“RRO”让我第一次相信这确实是索尼的RRO。</p>

<p>然后我想，如果这真的是RRO，我还能在哪里找到证据呢？这些想法引导我检查/system/vendor/overlay，正如所料，其中确实有两个APK文件:framework-RES _ _ auto _ generated _ rro . apk和PixelThemeOverlay.apk</p>





<p>这两者都与显示设置中的主题名称相匹配。奇怪的是，当你在显示设置中选择像素主题时，它不起作用。我不是开发RRO主题的专家，所以我不能说为什么Pixel主题不起作用，尽管通过对这两个应用程序进行APK分解，可以清楚地看到这些确实是覆盖应用程序。</p>

<p><strong> PixelThemeOverlay.apk APK拆卸</strong></p>

<p>[标签][标签标题="AndroidManifest.xml"]</p>

<pre> <code class="hljs java"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8" standalone="no"?&gt;</span><br/>&lt;manifest xmlns:andro <span class="hljs-keyword">package</span>=<span class="hljs-string">"com.google.android.theme.pixel"</span> platformBuildVersionCode=<span class="hljs-string">"25"</span> platformBuildVersionName=<span class="hljs-string">"O"</span>&gt;<br/><span class="hljs-tag">&lt;<span class="hljs-name">overlay</span> <span class="hljs-attr">android:priority</span>=<span class="hljs-string">"1"</span> <span class="hljs-attr">android:targetPackage</span>=<span class="hljs-string">"android"</span>/&gt;</span><br/><span class="hljs-tag">&lt;<span class="hljs-name">application</span> <span class="hljs-attr">android:hasCode</span>=<span class="hljs-string">"false"</span> <span class="hljs-attr">android:label</span>=<span class="hljs-string">"@string/pixel_overlay_pixel"</span>/&gt;</span><br/><span class="hljs-tag">&lt;/<span class="hljs-name">manifest</span>&gt;</span></code> </pre>
<p>[/tab][tab title ="strings.xml"]</p>

<pre> <code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br/><span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span><br/><span class="hljs-tag">&lt;<span class="hljs-name">string</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"pixel_overlay_pixel"</span>&gt;</span>Pixel<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span><br/><span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span></code> </pre>
<p>[/tab][tab title ="colors.xml"]</p>

<pre> <code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br/><span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span><br/><span class="hljs-tag">&lt;<span class="hljs-name">color</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"user_icon_1"</span>&gt;</span>#ff5e97f6<span class="hljs-tag">&lt;/<span class="hljs-name">color</span>&gt;</span><br/><span class="hljs-tag">&lt;<span class="hljs-name">color</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"user_icon_2"</span>&gt;</span>#ff5c6bc0<span class="hljs-tag">&lt;/<span class="hljs-name">color</span>&gt;</span><br/><span class="hljs-tag">&lt;<span class="hljs-name">color</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"user_icon_3"</span>&gt;</span>#ff26a69a<span class="hljs-tag">&lt;/<span class="hljs-name">color</span>&gt;</span><br/><span class="hljs-tag">&lt;<span class="hljs-name">color</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"user_icon_4"</span>&gt;</span>#ffec407a<span class="hljs-tag">&lt;/<span class="hljs-name">color</span>&gt;</span><br/><span class="hljs-tag">&lt;<span class="hljs-name">color</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"user_icon_5"</span>&gt;</span>#ff33ac71<span class="hljs-tag">&lt;/<span class="hljs-name">color</span>&gt;</span><br/><span class="hljs-tag">&lt;<span class="hljs-name">color</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"user_icon_6"</span>&gt;</span>#ff8bc34a<span class="hljs-tag">&lt;/<span class="hljs-name">color</span>&gt;</span><br/><span class="hljs-tag">&lt;<span class="hljs-name">color</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"user_icon_7"</span>&gt;</span>#ffff9800<span class="hljs-tag">&lt;/<span class="hljs-name">color</span>&gt;</span><br/><span class="hljs-tag">&lt;<span class="hljs-name">color</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"user_icon_8"</span>&gt;</span>#ffff7043<span class="hljs-tag">&lt;/<span class="hljs-name">color</span>&gt;</span><br/><span class="hljs-tag">&lt;<span class="hljs-name">color</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"system_error"</span>&gt;</span>#ffea4335<span class="hljs-tag">&lt;/<span class="hljs-name">color</span>&gt;</span><br/><span class="hljs-tag">&lt;<span class="hljs-name">color</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"primary_device_default_dark"</span>&gt;</span>#ff2d2d2d<span class="hljs-tag">&lt;/<span class="hljs-name">color</span>&gt;</span><br/><span class="hljs-tag">&lt;<span class="hljs-name">color</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"primary_device_default_settings"</span>&gt;</span>#ff2d2d2d<span class="hljs-tag">&lt;/<span class="hljs-name">color</span>&gt;</span><br/><span class="hljs-tag">&lt;<span class="hljs-name">color</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"primary_dark_device_default_dark"</span>&gt;</span>#ff242424<span class="hljs-tag">&lt;/<span class="hljs-name">color</span>&gt;</span><br/><span class="hljs-tag">&lt;<span class="hljs-name">color</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"primary_dark_device_default_settings"</span>&gt;</span>#ff242424<span class="hljs-tag">&lt;/<span class="hljs-name">color</span>&gt;</span><br/><span class="hljs-tag">&lt;<span class="hljs-name">color</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"secondary_device_default_settings"</span>&gt;</span>#ff3a3a3a<span class="hljs-tag">&lt;/<span class="hljs-name">color</span>&gt;</span><br/><span class="hljs-tag">&lt;<span class="hljs-name">color</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"tertiary_device_default_settings"</span>&gt;</span>#ff616161<span class="hljs-tag">&lt;/<span class="hljs-name">color</span>&gt;</span><br/><span class="hljs-tag">&lt;<span class="hljs-name">color</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"quaternary_device_default_settings"</span>&gt;</span>#ff9e9e9e<span class="hljs-tag">&lt;/<span class="hljs-name">color</span>&gt;</span><br/><span class="hljs-tag">&lt;<span class="hljs-name">color</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"accent_device_default_700"</span>&gt;</span>#ff3367d6<span class="hljs-tag">&lt;/<span class="hljs-name">color</span>&gt;</span><br/><span class="hljs-tag">&lt;<span class="hljs-name">color</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"accent_device_default_light"</span>&gt;</span>#ff4285f4<span class="hljs-tag">&lt;/<span class="hljs-name">color</span>&gt;</span><br/><span class="hljs-tag">&lt;<span class="hljs-name">color</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"accent_device_default_dark"</span>&gt;</span>#ff5e97f6<span class="hljs-tag">&lt;/<span class="hljs-name">color</span>&gt;</span><br/><span class="hljs-tag">&lt;<span class="hljs-name">color</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"accent_device_default_50"</span>&gt;</span>#ffe8f0fe<span class="hljs-tag">&lt;/<span class="hljs-name">color</span>&gt;</span><br/><span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span></code> </pre>
<p>[/tab]</p>

<p>[/tabs]</p>

<p>如果你浏览索尼提供的RRO文档，很明显这应该是一个RRO主题。在androidManifest文件中，覆盖行指示该覆盖以framework-res.apk文件(“Android”)为目标，它的优先级为“1”，这是它可以被赋予的最高优先级。</p>

<p>另一方面，在framework-RES _ _ auto _ generated _ rro . apk文件中有一个看起来与AndroidManifest.xml文件相似的文件，但是还有许多其他与主题无关的字符串。但这很容易解释，因为这个RRO主题基本上是Google Pixel的framework-res.apk的精简版本，我认为这是真的，因为\res\values\bools.xml有一行<code>&lt;bool name="config_useRoundIcon"&gt;true&lt;/bool&gt;</code>，我从我们论坛上的一个帖子中知道，用户<a href="https://forum.xda-developers.com/android/apps-games/guide-enable-pixel-launcher-round-icon-t3536267">需要设置</a>，以便<a href="https://www.xda-developers.com/psa-android-7-1-circular-icon-support-is-determined-by-the-oem/">在系统范围内启用圆形图标支持</a>。</p>

<hr/>
<p class="ad-even"> </p>


<h2 id="conclusion">结论</h2>
<p>我的测试人员还不能在O DP2中实现root访问，以尝试运行底层遗留/RRO主题，但根据我自己和Maxr1998的发现，可以有把握地说<strong> Google可能最终准备将RRO主题化带给大众</strong>。</p>

<p>当然，不能保证这个特性不会在以后的Android O版本中被删除。有可能谷歌认为RRO没有按照他们想要的方式工作，并放弃了这个功能。然而，鉴于RRO在索尼和我们自己的开发社区中的广泛历史，我们中的许多人已经熟悉索尼运行时资源覆盖的伟大之处。由于已经有大量兼容RRO的主题可用，如果谷歌决定允许我们安装自定义主题，他们将打开闸门，让用户享受已经广泛存在的主题市场。</p>

<hr/>

<p><em>专题图片演职员表:<a href="https://www.youtube.com/watch?v=it0WEuVUp7o">SonyDevWorld</a>T3】</em></p>

 </div>


</div>    
</body>
</html>