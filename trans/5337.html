<html>
<head>
<title>How to Locally Capture a System Trace on Android Pie</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何在Android Pie上本地捕获系统跟踪</h1>
<blockquote>原文：<a href="https://www.xda-developers.com/capture-system-trace-android-pie/#0001-01-01">https://www.xda-developers.com/capture-system-trace-android-pie/#0001-01-01</a></blockquote><div><div class="content-block-regular">
<p/><p>跟踪是一个非常有价值的工具，它使开发人员能够理解各种变化对系统的影响，并且可以提供线索来确定问题的根本原因。</p>

  
<p>systrace 就是这样一个强大的跟踪工具，它从运行在Android设备上的进程中收集时间信息。<em> systrace </em>被谷歌的<a href="https://www.youtube.com/watch?v=Qfo5fdoXrTU"> Android性能团队</a>广泛用于优化谷歌Pixel手机的性能。例如，我已经使用了<em> systrace </em>来检查内核调度器的变化对CPU上的任务放置的影响，并识别janks的可能原因。<em> systrace </em>可以捕获各种各样的数据，包括CPU调度、CPU频率、磁盘I/O、图形、活页夹活动等等。这些信息被整合成一份报告，可以在谷歌浏览器中进行分析。</p>



<p>在Android Pie出现之前，用<em> systrace </em>捕获踪迹的唯一方法是将一个Android设备连接到一台计算机上，然后从那里运行systrace——通常是从一个终端。然而，并不是每个人都能经常接触电脑，或者拥有运行systrace的知识和信心。</p>

<p>随着Android Pie的发布，这种不便通过引入<a href="https://android.googlesource.com/platform/packages/apps/Traceur/"> Traceur包得到了解决，这是一种直接在Android手机上捕获原始跟踪数据</a>的工具。Traceur在设置应用程序的开发者选项中作为“系统跟踪”选项提供，Traceur在设备上捕获的原始跟踪数据可以在稍后由<em> systrace </em>转换为HTML报告进行分析。</p>

<p>新的“系统跟踪”选项允许用户轻松捕获并与开发人员共享跟踪，而无需实际知道如何在计算机上运行<em> systrace </em>。开发人员受益于无需计算机就能捕获轨迹并在以后方便时进行分析的能力。“系统跟踪”收集的完整的原始跟踪数据在大小上也明显小于由<em> systrace </em>生成的HTML报告，因此这使得原始跟踪数据更适合于存储和与他人共享。</p>

 
<h2 id="guide-collecting-system-and-analyzing-system-traces">指南:收集系统和分析系统跟踪</h2>
<p>首先，确保你有一台运行Android Pie的设备和一台安装了Python 2的计算机。以下说明是在运行最新OxygenOS Android Pie测试版的OnePlus 6上执行的。</p>

<ol> <li><a href="https://developer.android.com/studio/debug/dev-options">在设置应用中启用开发者选项，然后进入开发者选项“调试”部分的“系统跟踪”选项</a>。<a href="https://static1.xdaimages.com/wordpress/wp-content/uploads/2018/09/System-Tracing-on-Android-Pie9.png">T3】</a></li> <li>打开系统跟踪时，您将看到一个启用系统跟踪的开关，以及定制跟踪类别和跟踪缓冲区大小的能力。对于本演示，使用默认类别，这对于大多数情况来说已经足够了。“显示快速设置磁贴”开关允许通过快速设置启动/停止跟踪。我已经为本指南启用了此功能。<a href="https://static1.xdaimages.com/wordpress/wp-content/uploads/2018/09/System-Tracing-on-Android-Pie8.png"> </a></li> <li>要开始捕捉轨迹，请点击最近添加的“记录轨迹”快速设置磁贴。</li> <li>当您完成跟踪一个测试用例时，您可以从通知阴影中停止跟踪。</li> <li>太好了！您成功捕获了一条原始痕迹。通知将提示您共享原始跟踪文件。你应该能够把它保存到你的设备上，上传到网上存储器，用电子邮件发给别人，等等。或者，您可以使用ADB直接将跟踪从您的设备中提取到您的计算机中(<code>adb pull /data/local/traces/</code>)。继续将跟踪文件保存到您的计算机上。</li> <li>原始跟踪文件具有虚构的<a href="https://android.googlesource.com/platform/packages/apps/Traceur/+/32fac6ad6592389fb887830af49d41b8e40a6a7f">。ctrace格式</a>。它不能以其原始的形式被解释。我们可以使用<em> systrace </em>从我们的原始跟踪文件中生成一个更有用、更容易理解的交互式HTML报告。</li> <li>我们将使用来自<a href="https://github.com/catapult-project/catapult/">弹射项目报告</a>的<em>系统</em>的最新版本。在终端应用程序中，克隆repo(确保安装了git):<pre> <code class="hljs php">git <span class="hljs-keyword">clone</span> https:</code> </pre></li> <li>要使用<em> systrace </em>从我们的原始跟踪文件生成HTML报告，请输入以下命令:<pre> <code class="hljs xml">python2 catapult/systrace/bin/systrace --<span class="hljs-keyword">from</span>-file=<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">path</span> <span class="hljs-attr">to</span> <span class="hljs-attr">raw</span> <span class="hljs-attr">trace</span> <span class="hljs-attr">file</span>&gt;</span></span></code> </pre>将生成一个与原始跟踪文件同名的HTML文件。<em>注意:撰写本文时，systrace仅支持Python 2。</em></li> <li>要查看HTML报告，请启动Google Chrome浏览器并访问“Chrome://tracing”URL。不要直接在谷歌浏览器中打开HTML报告，因为它会显示为空白。</li> <li>点击“加载”,从弹出的对话框中打开HTML报告文件。瞧啊。你的追踪报告现在可供检查。</li> </ol>



<h3 id="what-s-next">下一步是什么？</h3>
<p>既然您已经能够捕获跟踪并生成一个<em> systrace </em>报告，那么理解如何读取和解释报告中显示的数据就很重要了。首先，我推荐阅读“<a href="https://source.android.com/devices/tech/debug/systrace">了解<em> Systrace </em> </a>”，并观看“<a href="https://www.youtube.com/watch?v=Qfo5fdoXrTU"> Android性能:概述(Google I/O '17) </a>”和“<a href="https://www.youtube.com/watch?v=4oAlB-3tkqc"><em>Systrace</em>for Games</a>”，以了解<em> systrace </em>的实际操作。</p>

<p><em>这是一篇客座博文，作者是乔希·乔(Josh Choo)，也被称为XDA知名开发者<a href="https://forum.xda-developers.com/member.php?u=6745491">乔舒斯</a>。这篇文章在格式上稍加编辑。</em></p>

 </div>


</div>    
</body>
</html>