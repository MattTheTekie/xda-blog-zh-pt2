<html>
<head>
<title>Android Oreo's rollback protection required on phones launching with Android Pie</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用Android Pie的手机需要Android Oreo的回滚保护</h1>
<blockquote>原文：<a href="https://www.xda-developers.com/android-pie-rollback-protection/#0001-01-01">https://www.xda-developers.com/android-pie-rollback-protection/#0001-01-01</a></blockquote><div><div class="content-block-regular">
<p/><p>Android Pie (Android 9) <a href="https://www.xda-developers.com/android-pie-google-pixel-google-pixel-2/">今天刚刚上线</a>谷歌Pixel，谷歌Pixel 2，<a href="https://www.xda-developers.com/essential-phone-android-pie-android-9/">甚至</a>基本手机。我们正在尽可能多地从采访中了解该版本(谷歌Pixel 3 <a href="https://www.xda-developers.com/google-pixel-3-will-only-offer-gesture-navigation-and-not-standard-buttons/">将只有手势导航</a>！)、<a href="https://www.xda-developers.com/android-pie-source-code-aosp/"> AOSP代码降</a>，最后是兼容性定义文档(CDD)。我们今天早些时候发布了一个关于“重量级”应用的<a href="https://www.xda-developers.com/android-pie-ram-heavy-games-exit/">新功能，但现在我们发现谷歌已经改变了他们对Android Oreo中引入的一个功能的措辞:</a><a href="https://www.xda-developers.com/android-oreo-rollback-protection/">回滚保护</a>。该功能是通过<a href="https://android.googlesource.com/platform/external/avb/"> Android验证启动2.0 </a>(也简称为验证启动)实现的，然而，OEM并不需要在奥利奥版本中实现AVB 2.0。现在，谷歌强制要求所有使用Android Pie的设备支持验证启动，并扩展回退保护。</p>

 
<h2 id="rollback-protection-in-android-oreo">Android Oreo中的回滚保护</h2>
<p>该功能的要点是，如果它检测到你的手机被降级到一个更早的，现在未经批准的软件版本，该版本因安全漏洞而被认为是不安全的，它将阻止你的手机启动。一个稍微技术性一点的解释是，VBMeta数据结构保存了引导分区的hash和系统和供应商分区的hashtree元数据，它使用回滚索引来拒绝具有较旧回滚索引的映像。</p>
<div class="body-img landscape"><div class="responsive-img image-expandable img-article-item" data-img-url="https://static1.xdaimages.com/wordpress/wp-content/uploads/2018/08/Android-Verified-Boot-Rollback-Protection-1024x212.png" data-modal-id="single-image-modal" data-modal-container-id="single-image-modal-container" data-img-caption="&quot;Rollback Protection in Android Verified Boot. Source: &lt;a href=\&quot;https:\/\/android.googlesource.com\/platform\/external\/avb\/#Rollback-Protection\&quot;&gt;Google&lt;\/a&gt;.&quot;">
 
<figure> <picture>  <source media="(min-width: 1024px)" sizes="1500px" data-srcset="https://static1.xdaimages.com/wordpress/wp-content/uploads/2018/08/Android-Verified-Boot-Rollback-Protection-1024x212.png?q=50&amp;fit=crop&amp;w=1500&amp;dpr=1.5"/> <source media="(min-width: 768px)" sizes="943px" data-srcset="https://static1.xdaimages.com/wordpress/wp-content/uploads/2018/08/Android-Verified-Boot-Rollback-Protection-1024x212.png?q=50&amp;fit=crop&amp;w=943&amp;dpr=1.5"/> <source media="(min-width: 481px)" sizes="767px" data-srcset="https://static1.xdaimages.com/wordpress/wp-content/uploads/2018/08/Android-Verified-Boot-Rollback-Protection-1024x212.png?q=50&amp;fit=crop&amp;w=767&amp;dpr=1.5"/> <source media="(min-width: 0px)" sizes="480px" data-srcset="https://static1.xdaimages.com/wordpress/wp-content/uploads/2018/08/Android-Verified-Boot-Rollback-Protection-1024x212.png?q=50&amp;fit=crop&amp;w=480&amp;dpr=1.5"/> <img class="lazyload" alt="Android Oreo rollback protection in Android Pie" data-img-url="https://static1.xdaimages.com/wordpress/wp-content/uploads/2018/08/Android-Verified-Boot-Rollback-Protection-1024x212.png" src="../Images/3bcc385cde835ef485f6cd7d472c8ff9.png" data-original-src="https://static1.xdaimages.com/wordpress/wp-content/uploads/2018/08/Android-Verified-Boot-Rollback-Protection-1024x212.png"/> </picture> <figcaption class="body-img-caption">Rollback Protection in Android Verified Boot. Source: <a href="https://android.googlesource.com/platform/external/avb/#Rollback-Protection">Google</a>.</figcaption> </figure> </div>


 </div>


<p>这一功能在谷歌Pixel 2、Razer Phone和OnePlus 6等设备上存在，但在三星Galaxy S9等许多其他设备上不存在(尽管三星确实在Knox 中提供了自己形式的<a href="https://developer.samsung.com/tech-insights/knox/platform-security">回滚保护)。)现在，谷歌正在让任何安装了Android Pie的设备都必须具备这一功能。</a></p>
<p class="ad-odd"> </p>


<h2 id="verified-boot-in-android-pie">在Android Pie中验证启动</h2>
<p>根据兼容性定义文档中“设备完整性”部分的更新措辞，使用Android 9启动的设备必须支持验证启动。</p>

<section class="emaki-custom-block emaki-custom-note"><div class="emaki-custom note" id="custom_block_7"><h3 id="9-10-device-integrity">9.10.设备完整性</h3><p>以下要求确保了设备完整性状态的透明度。设备实现:</p><ul> <li>[C-0-1]必须通过系统API方法persistentdatablockmanager . getflashlockstate()正确报告其引导加载程序状态是否允许刷新系统映像。FLASH_LOCK_UNKNOWN状态是为从Android早期版本升级的设备实现保留的，在早期版本中不存在这种新的系统API方法。</li> <li>[C-0-2]必须支持设备完整性的验证启动。</li> </ul><p>如果设备实施已经在早期版本的Android上启动，但不支持验证启动，并且不能通过系统软件更新添加对此功能的支持，则可以免除此要求。</p><p>...</p><ul> <li>[C-1-10]必须为Android使用的分区(如引导、系统分区)实施回滚保护，并使用防篡改存储来存储用于确定最低允许操作系统版本的元数据。</li> <li>应对任何具有永久固件的组件(如调制解调器、摄像头)实施回滚保护，并应使用防篡改存储来存储用于确定最低允许版本的元数据。</li> </ul> </div></section>
<p>正如您在最后两组要点中看到的，有一点需要注意。Android使用的分区(引导、系统、厂商等)需要回滚保护。)但不适用于具有永久固件(调制解调器、摄像头等)的分区。).前一组分区是大多数安全漏洞被发现和修补的地方，所以很高兴看到保护这些分区是强制性的。然而，也有针对具有持久固件的分区的漏洞，所以我们不确定为什么Google不强制对它们进行回滚保护。</p>

<p>XDA资深成员<a href="https://forum.xda-developers.com/member.php?u=5848265"> npjohnson </a>是LineageOS团队的成员，他推测，在具有持久固件的分区上要求回滚保护将需要辅助引导加载程序(SBL)和可扩展引导加载程序(XBL)的捆绑，因为这些分区是在引导过程中较早安装的。对于较小的原始设备制造商来说，实现定制的xbl来匹配定制的调制解调器和其他持久分区将是昂贵的，所以也许谷歌没有将这作为一项要求，以使设备制造商更容易满足CDD的最新要求。</p>
<p class="ad-even"> </p>


<h2 id="how-to-check-if-your-phone-supports-avb-2-0">如何检查你的手机是否支持AVB 2.0</h2>
<p>有两个亚行外壳命令，你可以用来检查你的手机是否支持AVB 2.0。</p>

<pre> <code class="hljs java">adb shell<br/>dumpsys <span class="hljs-keyword">package</span> | grep <span class="hljs-string">"verified_boot"</span></code> </pre>
<p>运筹学</p>

<pre> <code class="hljs javascript">adb shell<br/>getprop | grep <span class="hljs-string">"avb"</span></code> </pre>
<p>如果第一个命令的输出是“android.software.verified_boot ”,则支持AVB 2.0。如果第二个命令的输出显示“[ro.boot.avb_version]”和“[ro.boot.vbmeta.avb_version]”，并列出每个命令的版本号，那么它是受支持的。</p>
<p class="ad-odd"> </p>


<h2 id="verified-boot-and-custom-development">验证启动和定制开发</h2>
<p>Android验证启动并不会真正影响大多数定制ROM用户，尽管它确实增加了额外的安全层，在某些情况下你必须解决这个问题。例如，<a href="https://www.xda-developers.com/flash-generic-system-image-project-treble-device/">刷新通用系统映像</a>需要禁用AVB。在OnePlus 6上修改某些分区，比如vendor，也需要禁用AVB，<a href="https://twitter.com/MishaalRahman/status/1024752271228383232">，我最近才知道</a>。根据<a href="https://forum.xda-developers.com/member.php?u=5848265"> npjohnson </a>的说法，正确实施的AVB 2.0使得定制的引导镜像可以与锁定的引导装载程序一起工作。我们将看到搭载Android Pie的设备上包含AVB 2.0会如何影响景观，但我们希望它不会导致类似小米红米Note 5 Pro社区最近出现的<a href="https://www.xda-developers.com/miui-10-global-beta-8-7-5-anti-rollback-downgrade-brick-redmi-note-5-pro/">砖块恐慌</a>的情况。强制性的AVB 2.0只是谷歌<a href="https://www.xda-developers.com/android-p-privacy-updates/">提高Android平台安全性</a>的另一种方式，但在我们看来，最大的变化是<a href="https://www.xda-developers.com/google-require-oem-regular-security-patches/">OEM协议的重新工作，以强制常规安全补丁</a>。</p>

 </div>


</div>    
</body>
</html>