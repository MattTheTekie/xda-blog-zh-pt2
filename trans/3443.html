<html>
<head>
<title>Multi-Window in Android N: What Devs Need to Know to Make the Best of It</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Android N中的多窗口:开发者需要知道什么来充分利用它</h1>
<blockquote>原文：<a href="https://www.xda-developers.com/everything-devs-need-to-know-about-multiwindow-in-android-n-code-examples/#0001-01-01">https://www.xda-developers.com/everything-devs-need-to-know-about-multiwindow-in-android-n-code-examples/#0001-01-01</a></blockquote><div><header class="article_heading">


<h1 class="heading_title">Android N中的多窗口:开发者需要知道什么来充分利用它</h1>

<p class="heading_sharing">  </p>


<p class="heading_excerpt">我们概述了Android N中即将到来的多窗口支持对开发者意味着什么，以及如何充分利用它！</p>



  </header>

<section id="article-body" class="article-body" itemprop="articleBody">

<div class="content-block-regular">
<p/><p>多窗口支持是我们在Android N中期待的一个很好的特性，也是我们很久以来就想在所有设备上实现的一个特性。然而，为了让它成为一种愉快的体验，开发者可能需要在他们的应用程序中做一些改变来正确地支持它。</p>

  
<p>Google I/O会议之一是让开发者了解新的API和多窗口支持带来的系统行为变化。</p>

<p>会议由Wale Ogunwale主持，他是Android ActivityManager和WindowManager框架组件的技术主管，他和他的团队负责Android上的多窗口。</p>

<p>你可以在YouTube 上观看<a href="https://youtu.be/yEEy_48hoXI" target="_blank">多窗口模式会话，但我们也在这里提供会话的概述。</a></p>
<div>
<h1>介绍</h1><p>n引入了三种不同的多窗口模式:</p><ul> <li>分屏模式:这是默认可用的模式。顾名思义，它允许你同时打开两个应用程序。</li> <li>自由模式:制造商可以在更大的设备上启用该模式，除了分屏模式之外，用户还可以自由调整活动的大小。</li> <li><a href="https://developer.android.com/preview/features/picture-in-picture.html" target="_blank">画中画模式</a>:针对Android电视设备，该模式旨在让视频播放器在固定窗口中运行，同时用户与其他应用程序进行交互。</li></ul>
<p>一文不值</p><a href="http://www.xda-developers.com/praise-and-criticism-of-ns-multi-window-freeform-from-a-multi-window-fan/" target="_blank">we've covered multi-window on N before and offered some criticism of the current system</a><p>。考虑到这一点，我们希望自由形式模式更接近画中画模式，因为这将在所有设备上有有用的应用。</p><div>
<h1>添加多窗口支持</h1><p>在您的应用程序中启用多窗口支持很简单:如果您已经面向N，您不需要做任何事情</p><code>android:resizeableActivity</code><p>清单中的活动属性添加到</p><code>false</code><p>。只有在真正合理的情况下才应该这样做，因为即使用户(或另一个应用程序)试图以多窗口模式启动，它也总是以全屏模式启动，从而使你的应用程序以一种不好的方式突出。值得注意的是，根活动的属性适用于其任务堆栈中的所有活动。</p><strong>In other words, if you have an activity that can be started by other apps, make sure it supports multi-window mode</strong><p>因为你不能保证其他应用程序会在新任务中启动你的活动</p><a href="https://developer.android.com/reference/android/content/Intent.html#FLAG_ACTIVITY_NEW_TASK" target="_blank"><code>Intent#FLAG_ACTIVITY_NEW_TASK</code></a><p>。画中画模式支持必须通过</p><code>android:supportsPictureInPicture</code><p>属性。请注意，如果出现以下情况，此属性将被忽略</p><code>android:resizeableActivity</code><p>是</p><code>false</code><p>。布局属性可用于设置自由形式窗口的默认尺寸和位置，或者指定自由形式和分屏模式的最小宽度或高度:</p><ul> <li><code>android:defaultWidth</code> / <code>android:defaultHeight</code>:活动的默认维度(自由形式模式)。</li> <li><code>android:gravity</code>:活动的初始位置(自由形式模式)。</li> <li><code>android:minimalWidth</code> / <code>android:minimalHeight</code>:活动的最小维度(自由形式和分屏模式)</li></ul><p>您可以在中找到代码示例</p><a href="https://github.com/googlesamples/android-MultiWindowPlayground/" target="_blank">Google's Multi-Window Playground sample app</a><p>在GitHub上:</p><a href="https://github.com/googlesamples/android-MultiWindowPlayground/blob/master/Application/src/main/AndroidManifest.xml#L44" target="_blank">AndroidManifest.xml</a><p> .</p><div>
<h1>系统行为变化</h1><p>随着多窗口支持的引入，您可能需要仔细检查应用程序中的一些内容，以确保它们正确运行。</p><div>
<h3>了解活动生命周期</h3><p>这</p><a href="https://developer.android.com/training/basics/activity-lifecycle/index.html" target="_blank">activity lifecycle</a><p>在多窗口模式下不变:</p><img class="aligncenter size-full wp-image-146263" src="../Images/27b01a66b2b309ec8192d8f1a016416a.png" alt="Android Activity Basic Lifecycle" data-original-src="http://static1.xdaimages.com/wordpress/wp-content/uploads/2016/05/android-activity-basic-lifecycle.png"/><p>也就是说，活动状态之间的一些细微差异可能会导致您在n之前通常不会注意到的意外行为。了解这一点很重要</p><a href="https://developer.android.com/reference/android/app/Activity.html#onResume()" target="_blank"><code>Activity#onResume()</code></a><p>和</p><a href="https://developer.android.com/reference/android/app/Activity.html#onPause()" target="_blank"><code>Activity#onPause()</code></a><p>当您的应用程序获得或失去焦点时调用，但不一定在它开始或停止可见时调用。(请记住，在任何给定时间，只能有一个应用程序获得焦点。)对于经常更新内容的应用程序(如视频播放)，请确保在中处理开始和停止内容更新</p><a href="https://developer.android.com/reference/android/app/Activity.html#onStart()" target="_blank"><code>Activity#onStart()</code></a><p>和</p><a href="https://developer.android.com/reference/android/app/Activity.html#onStop()" target="_blank"><code>Activity#onStop()</code></a><p>相反。例如，对于视频应用程序来说，</p><strong>will mean that playback will only occur if the app is focused</strong><p>，这违背了多窗口模式的目的。</p><a href="http://www.xda-developers.com/multiwindow-on-android-n-now-lets-you-watch-videos-uninterrupted/" target="_blank">The official YouTube app had a similar problem when the Android N Developer Preview first launched</a><p> .</p><div>
<h3>处理运行时更改</h3><p>当应用程序进入多窗口模式时，一些设备配置会发生变化。您可以允许您的活动重新开始(在这种情况下</p><a href="https://developer.android.com/guide/topics/resources/runtime-changes.html#HandlingTheChange" target="_blank">retaining Fragments</a><p>如果您的活动必须在启动时执行密集操作，这可能是个好主意)，或者选择</p><a href="https://developer.android.com/guide/topics/resources/runtime-changes.html#RetainingAnObject" target="_blank">handle the configuration changes explicitly</a><p>相反。当进入多窗口模式或在多窗口模式中时，四种设备配置可能会改变:</p><code>screenSize</code><p> ,  </p><code>smallestScreenSize</code><p> ,  </p><code>screenLayout</code><p>和</p><code>orientation</code><p>。请参考</p><a href="https://developer.android.com/guide/topics/manifest/activity-element.html#config" target="_blank">Android Developers documentation</a><p>有关每个属性的更多信息，但请注意</p><code>orientation</code><p>在这种情况下，不再指设备的方向。相反，它仅仅表明你的活动的宽度是否大于高度(横向)或(纵向)。可以从清单中声明您的活动将处理这些更改:</p><pre><span>&lt;activity</span> <span>android:name=</span><span>".MyActivity"</span> <span>android:configChanges=</span><span>"screenSize|smallestScreenSize|screenLayout|orientation"</span> <span>/&gt;</span></pre><p>请记住，这意味着您实际上需要在</p><a href="https://developer.android.com/reference/android/app/Activity.html#onConfigurationChanged(android.content.res.Configuration)" target="_blank"><code>Activity#onConfigurationChanged()</code></a><p>，通过手动更新视图或重新加载一些资源。</p><div>
<h3>多窗口模式下禁用的功能</h3><p>在多窗口模式下，您的活动不会影响某些系统功能:</p><ul> <li>状态栏和导航栏的更改，如变暗/隐藏系统栏或使用沉浸式模式，将不会产生任何效果。这很有意义，因为你的活动只占据了屏幕的一部分。</li> <li>在多窗口模式下,<code>android:screenOrientation</code> activity属性也不起作用:因为您的activity将是可调整大小的，所以它不再有固定的方向。</li></ul>
<div>
<h1>新增API</h1><p>为多窗口事件添加了新的回调，以及查询当前状态的方法。</p><ul> <li><code>Activity#onMultiWindowModeChanged(boolean inMultiWindow)</code>:当活动状态从全屏变为多窗口时调用，反之亦然。</li> <li><code>Activity#onPictureInPictureModeChanged(boolean inPictureOnPicture)</code>:当活动状态从画中画模式变为画中画模式时调用。</li> <li><code>Activity#isInMultiWindowMode()</code> / <code>Activity#isInPictureInPictureMode()</code>:返回活动是否处于多窗口/画中画模式。</li> <li>对于自由形式的窗口，这个方法可以用来使标题(用来拖动窗口的条)覆盖内容，而不是向下推。</li></ul><p>PS。除了</p><code>Activity#overlayWithDecorCaption()</code><p>，这些方法也由</p><code>Fragment</code><p>班级。</p><div>
<h3>在多窗口模式下启动活动</h3>
<ul> <li><code>Activity#enterPictureInPictureMode()</code>可用于将活动置于画中画模式。请注意，PiP模式下的活动不会收到关于输入事件的通知——如果您想处理这样的事件，请使用<a href="https://developer.android.com/reference/android/media/session/MediaSession.html#setMediaButtonReceiver(android.app.PendingIntent)" target="_blank"> <code>MediaSession#setMediaButtonReceiver()</code> </a>。如果你对Android N 上的<a href="https://developer.android.com/preview/features/picture-in-picture.html" target="_blank">画中画感兴趣，也一定要去看看Android开发者网站。</a></li></ul>

<ul> <li>如果设备处于分屏模式，您可以使用<code>Intent#FLAG_ACTIVITY_LAUNCH_ADJACENT</code>标志告诉系统在您的活动旁边启动另一个活动。如果不是在分屏模式下，该标志不起作用。</li> <li>如果设备处于自由模式，可以使用<code>ActivityOptions#setLaunchBounds()</code>来指定新活动在屏幕上的尺寸和位置。</li></ul>
<p>有关代码示例，请查看多窗口游乐场示例应用程序:</p><a href="https://github.com/googlesamples/android-MultiWindowPlayground/blob/master/Application/src/main/java/com/android/multiwindowplayground/MainActivity.java#L70" target="_blank">adjacent activity example</a><p> ,  </p><a href="https://github.com/googlesamples/android-MultiWindowPlayground/blob/master/Application/src/main/java/com/android/multiwindowplayground/MainActivity.java#L85" target="_blank">launch bounds example</a><p> .</p><div>
<h3>拖放</h3><p>虽然拖放支持在Honeycomb之后就出现了，但以前只可能出现在同一活动中。就是现在</p><a href="https://plus.google.com/+zacharyKewDenniss/posts/PoVZnUcPftD" target="_blank">supported in multi-window</a><p>也是。实现这一点似乎是</p><a href="https://developer.android.com/guide/topics/ui/drag-drop.html" target="_blank">mostly the same as before</a><p>，增加了一些跨活动拖放功能:</p><ul> <li><dl> <dt> <code>View#startDragAndDrop()</code> </dt> <dd> <ul> <li>新别名为<code>View#startDrag()</code>。</li> <li>启用跨活动拖拽，传递新标志<code>View#DRAG_FLAG_GLOBAL</code>。</li> <li>如果您需要向接收者活动授予URI权限，请根据需要传递新标志<code>View#DRAG_FLAG_GLOBAL_URI_READ</code>或<code>View#DRAG_FLAG_GLOBAL_URI_WRITE</code>。</li> </ul> </dd> </dl></li> <li><dl> <dt> <code>View#updateDragShadow()</code> </dt> <dd> <ul> <li>替换当前正在进行的拖动操作的拖动阴影。只能由发起拖动操作的应用程序调用。</li> </ul> </dd> </dl></li> <li><dl> <dt> <code>View#cancelDragAndDrop()</code> </dt> <dd> <ul> <li>取消当前正在进行的拖动操作。只能由发起拖动操作的应用程序调用。</li> </ul> </dd> </dl></li></ul>
<div>
<h1>其他值得注意的补充</h1>
<ul> <li>分别使用<code>PackageManager#FEATURE_FREEFORM_WINDOW_MANAGEMENT</code>和<code>PackageManager#FEATURE_FREEFORM_PICTURE_IN_PICTURE</code>，通过<a href="https://developer.android.com/reference/android/content/pm/PackageManager.html#hasSystemFeature(java.lang.String)" target="_blank"> <code>PackageManager#hasSystemFeature()</code> </a>可以检查设备是否支持自由形式或画中画模式。</li></ul>


<div>
<h1>UX最佳实践:</h1><p>Wale提供了一些最佳实践来确保您的用户获得最佳体验:</p><ul> <li>处理模式优雅地改变:<ul> <li><strong>无论方向如何，保持用户界面的一致性</strong>。不要让元素改变位置来实现平滑过渡。</li> <li>扩展上述内容，<strong>不要在非常不同的手机/平板电脑布局之间切换</strong>。相反，调整平板电脑的布局以适应较小的尺寸，从而保持一致性。</li></ul></li> <li><strong>通过<a href="https://www.google.com/design/spec/layout/responsive-ui.html#responsive-ui-patterns" target="_blank">遵循材料设计模式</a>，确保您的活动适应小尺寸</strong>。</li> <li>在分屏模式下，当有必要获得更愉快的体验时，使用<code>FLAG_ACTIVITY_LAUNCH_ADJACENT</code>。</li> <li><strong>仅在调整后声明尺寸不兼容</strong>。正如我们上面讨论的，否则它会让你的应用程序以一种不好的方式脱颖而出。</li></ul>
<div>
<h1>有用的资源</h1><p>Wale在会议结束时提供了一些额外的有用资源:</p>
</div>

</div>

</div>

</div>

</div>

</div>

</div>

</div>

</div>

</div>

</div>

</div>

</div>


<p id="article-waypoint"/>
</section>


        </div>    
</body>
</html>