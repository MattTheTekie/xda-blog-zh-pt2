<html>
<head>
<title>How to install the Android Q Beta GSI on your device so you can test your apps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何在你的设备上安装安卓Q测试版GSI以便测试你的应用</h1>
<blockquote>原文：<a href="https://www.xda-developers.com/install-android-q-beta-gsi-project-treble/#0001-01-01">https://www.xda-developers.com/install-android-q-beta-gsi-project-treble/#0001-01-01</a></blockquote><div><div class="content-block-regular">
<p/><p>随着我们离最终的Android Q版本越来越近，开发人员更新应用程序的时间也在缩短。虽然Android 9 Pie (API等级28)还没有到达绝大多数设备，但是Google Play的API等级要求，你应该<a href="https://www.xda-developers.com/play-store-updated-requirements-api-level-64-bit/">已经很了解</a>了，会迫使你在2020年把API等级29作为目标。如果你还没有更新你的应用程序来瞄准Android 9 Pie，<a href="https://www.xda-developers.com/google-play-protect-warning-users-install-apps-targeting-older-android-versions/">那么</a>如果你计划推出一个新的应用程序，你可以在8月前更新，如果你计划更新现有的应用程序，你可以在11月前更新。对于那些想要开始开发下一个Android版本的人来说，你已经可以在<a href="https://www.xda-developers.com/android-q-beta-2-notification-bubbles/"> Android Studio模拟器</a>上测试你的应用程序，或者如果你拥有<a href="https://www.xda-developers.com/android-q-beta-2-everything-new/">任何一部谷歌Pixel智能手机</a>，也可以在物理硬件上测试你的应用程序。然而今年，谷歌为开发者提供了另一种方式来测试他们的应用程序与最新的安卓版本的对比:将一个<a href="https://www.xda-developers.com/android-q-gsi-project-treble/">安卓Q测试版GSI </a>闪现到一个兼容Project Treble的设备上。</p>

  
<p>Project Treble是一项重大举措，旨在提高智能手机制造商推出软件和安全更新的速度。简而言之，Treble要求设备制造商将使硬件工作的软件与操作系统背后的软件分开。这使得设备制造商可以在现有设备上引导新的Android版本，以便他们可以开始在新的Android源代码版本上移植现有代码库的艰巨任务。作为CTS的补充，VTS或供应商测试套件是一套测试，设备制造商使用这套测试来验证他们的设备是否符合Project Treble的要求。设备制造商要测试的最重要的检查之一是兼容Treble的智能手机启动所谓的GSI或通用系统映像的能力。GSI是AOSP的未修改版本，旨在让设备制造商看看他们是否正确实现了Treble。然而，除了原始设备制造商，谷歌<a href="https://www.xda-developers.com/google-test-android-q-project-treble-gsi/">相信【GSIs可以被开发者用于Android应用兼容性测试。</a></p>

<p>例如，如果你没有谷歌Pixel，在最符合谷歌文档的条件下测试你的应用程序行为的唯一方法是你要么购买一个自己的Pixel设备，启动Android Studio仿真器，要么查看云测试服务。这些都有其优缺点，但如果你有一个现有的高音兼容设备，不想花任何钱或处理模拟器的限制，为什么不把GSI放在上面呢？如果你的应用可以在GSI上运行，那么它应该可以在几乎所有运行该安卓版本的设备上运行。</p>

<p>这就是谷歌决定发布Android Q GSIs背后的思维过程，或者至少我们是这么认为的。Android Q的源代码要到8月份才能发布，所以谷歌官方的GSI二进制文件是目前在真实的非像素硬件上测试Android Q的唯一方法。以下是你可以开始的方法。</p>

 
<h2 id="requirements">要求</h2>
<p>在你考虑安装Android Q beta之前，你应该检查一下你的设备是否兼容Project Treble，是否可以接受来自引导程序的闪烁系统映像。</p>

<section class="emaki-custom-block emaki-custom-note"><div class="emaki-custom note" id="custom_block_6"><p><b>要求:</b></p><p/><ul> <li>你的设备<b>必须</b>有一个<b>可解锁的引导程序</b>。在美国销售的骁龙三星智能手机、华为品牌的设备、Honor品牌的设备以及HMD Global的诺基亚品牌的设备(除了<a href="https://www.xda-developers.com/nokia-8-bootloader-unlock/">诺基亚8 </a>)在这里不符合条件。</li> <li>你的电脑上安装了最新的ADB和Fastboot二进制文件，你可以在这里找到<a href="https://www.xda-developers.com/install-adb-windows-macos-linux/"/>。快速启动的过时版本可能会导致不正确的闪存。</li> <li>您的设备<b>必须</b>满足<strong>以下标准之一</strong>才能被视为项目三重兼容:<ul> <li>与Android 9 Pie一起推出的设备。如果是这种情况，您可以在本节结束后跳过确认高音兼容性。</li> <li>该设备推出了Android 8.0 Oreo或Android 8.1 Oreo，但更新到Android 9 Pie，具有VNDK隔离和系统根。我们将在下一节详细介绍如何找到它。</li> </ul> </li> </ul> </div></section>
<p>在我们进一步讨论之前，值得一提的是，刷新GSI将需要您对userdata分区执行完全擦除。这意味着您将丢失设备内部和外部(/数据/媒体)存储上的所有照片、视频、音乐、文档或任何其他内容。因此，强烈建议在进一步操作之前进行设备外备份。</p>

<p>接下来，请记住，这些GSI尚未通过CTS，因此如果您的应用程序使用SafetyNet认证API来检查CTS配置文件匹配的设备完整性，那么这将不起作用。此外，这些构建不是为了日常使用，所以如果一个或多个基本硬件功能不能在Android Q中已经记录的错误上工作，不要感到惊讶。谷歌已经列出了GSI的几个已知问题，你可以在这里找到<a href="https://developer.android.com/preview/gsi-release-notes#known_issues"/>。你发现的任何新漏洞都应该在这里<a href="https://issuetracker.google.com/issues/new?component=190602&amp;template=1244680">存档</a>。</p>

<h3 id="confirming-treble-compatibility">确认高音兼容性</h3>
<p>运行以下命令:</p>

<pre> <code class="hljs css"><span class="hljs-selector-tag">adb</span> <span class="hljs-selector-tag">shell</span> <span class="hljs-selector-tag">getprop</span> <span class="hljs-selector-tag">ro</span><span class="hljs-selector-class">.treble</span><span class="hljs-selector-class">.enabled</span></code> </pre>
<p>如果响应为<strong>假</strong>，则您的设备与Project Treble不兼容，您不应继续。如果回答是<strong>真</strong>，那么你就可以继续前进了。</p>

<p>接下来，通过运行以下命令检查跨版本支持:</p>

<pre> <code class="hljs javascript">adb shell<br/>cat /system/etc/ld.config<span class="hljs-number">.28</span>.txt | grep -A <span class="hljs-number">20</span> <span class="hljs-string">"\[vendor\]"</span></code> </pre>
<p>在输出中，查找部分<strong>【vendor】</strong>，然后在该部分中查找<strong>namespace . default . isolated</strong>。如果该属性的值为<strong> true </strong>，那么你的设备应该支持在Android 9 Pie供应商映像上引导Android Q GSI。如果该值为<b>假</b>，那么您的设备只能将GSI用于同一设备上的操作系统版本。</p>
<div class="body-img landscape"><div class="responsive-img image-expandable img-article-item" data-img-url="https://static1.xdaimages.com/wordpress/wp-content/uploads/2019/04/Treble-VNDK-Isolation.png" data-modal-id="single-image-modal" data-modal-container-id="single-image-modal-container" data-img-caption="&quot;Sample output from a OnePlus 6T.&quot;">
 
<figure> <picture>  <source media="(min-width: 1024px)" sizes="1500px" data-srcset="https://static1.xdaimages.com/wordpress/wp-content/uploads/2019/04/Treble-VNDK-Isolation.png?q=50&amp;fit=crop&amp;w=1500&amp;dpr=1.5"/> <source media="(min-width: 768px)" sizes="943px" data-srcset="https://static1.xdaimages.com/wordpress/wp-content/uploads/2019/04/Treble-VNDK-Isolation.png?q=50&amp;fit=crop&amp;w=943&amp;dpr=1.5"/> <source media="(min-width: 481px)" sizes="767px" data-srcset="https://static1.xdaimages.com/wordpress/wp-content/uploads/2019/04/Treble-VNDK-Isolation.png?q=50&amp;fit=crop&amp;w=767&amp;dpr=1.5"/> <source media="(min-width: 0px)" sizes="480px" data-srcset="https://static1.xdaimages.com/wordpress/wp-content/uploads/2019/04/Treble-VNDK-Isolation.png?q=50&amp;fit=crop&amp;w=480&amp;dpr=1.5"/> <img class="lazyload" alt="" data-img-url="https://static1.xdaimages.com/wordpress/wp-content/uploads/2019/04/Treble-VNDK-Isolation.png" src="../Images/8fdfc10cfc676b2d4cab59572fcd735e.png" data-original-src="https://static1.xdaimages.com/wordpress/wp-content/uploads/2019/04/Treble-VNDK-Isolation.png"/> </picture> <figcaption class="body-img-caption">Sample output from a OnePlus 6T.</figcaption> </figure> </div>


 </div>


<p>最后，您需要确认您的设备是否是system-as-root，其中ramdisk与系统映像合并。对于升级到Android 9 Pie的设备来说，System-as-root不是强制性的，但对于支持纯系统OTA来说是必要的，比如在通过GSI刷新新操作系统版本的情况下。运行以下命令，验证输出是否与“system-as-root”匹配:</p>

<pre> <code class="hljs php">adb shell<br/>cat /proc/mounts | grep -q /dev/root &amp;&amp; <span class="hljs-keyword">echo</span> <span class="hljs-string">"system-as-root"</span> || <span class="hljs-keyword">echo</span> <span class="hljs-string">"non-system-as-root"</span></code> </pre>
<p>现在你知道你的设备是三重兼容的，你需要弄清楚下载哪个版本的GSI二进制文件，因为不同的架构有不同的镜像。要查看设备的架构，请运行以下命令:</p>

<pre> <code class="hljs css"><span class="hljs-selector-tag">adb</span> <span class="hljs-selector-tag">shell</span> <span class="hljs-selector-tag">getprop</span> <span class="hljs-selector-tag">ro</span><span class="hljs-selector-class">.product</span><span class="hljs-selector-class">.cpu</span><span class="hljs-selector-class">.abi</span></code> </pre>
<p>记下这里的输出，因为下载GSI时会用到它。</p>
<p class="ad-odd"> </p>


<h2 id="downloading-the-gsi">下载GSI</h2>
<p>Android Q beta GSI正式版的下载链接可以从谷歌<a href="https://developer.android.com/preview/gsi-release-notes#downloads">这里</a>获得。您应该根据您在上一步中找到的设备架构下载合适的版本。如果你下载带有GMS或谷歌移动服务的版本，下载量会相当大，我们强烈建议你可以在带有Google Play服务的版本上测试你的应用。</p>

<p>文件下载完成后，您可以将其解压缩。其中包含两个文件，<strong> system.img </strong>和<strong> vbmeta.img </strong>。</p>
<p class="ad-even"> </p>


<h2 id="flashing-the-gsi">闪烁着GSI</h2>
<ol> <li>使用按钮组合或发出命令:<pre> <code class="hljs ">adb reboot bootloader</code> </pre>重新启动设备的引导程序</li> <li>接下来，我们需要禁用Android验证启动(AVB)。您可以通过输入以下命令来做到这一点:<pre> <code class="hljs css"><span class="hljs-selector-tag">fastboot</span> <span class="hljs-selector-tag">flash</span> <span class="hljs-selector-tag">vbmeta</span> <span class="hljs-selector-tag">vbmeta</span><span class="hljs-selector-class">.img</span></code> </pre></li> <li>接下来，我们来擦写系统分区:<pre> <code class="hljs ">fastboot erase system</code> </pre></li> <li>我们终于可以用:<pre> <code class="hljs css"><span class="hljs-selector-tag">fastboot</span> <span class="hljs-selector-tag">flash</span> <span class="hljs-selector-tag">system</span> <span class="hljs-selector-tag">system</span><span class="hljs-selector-class">.img</span></code> </pre>来闪现安卓Q GSI了</li> <li>完成后，用:<pre> <code class="hljs ">fastboot -w</code> </pre>清除用户数据分区</li> <li>使用电源按钮或输入:<pre> <code class="hljs ">fastboot reboot</code> </pre>重新启动您的设备</li> </ol>

<p>希望它能在几分钟后启动。这些步骤在Pixel 3 XL上进行了验证，但应该普遍适用。我们可以验证Android Q beta 2 GSI不能在一加6T上启动，但可以在小米Mi 9上启动。它可能在索尼Xperia XZ3上工作，但我们被告知它不能在Moto G7上启动。您的里程可能会有所不同，因为谷歌的要求只确认相同的操作系统版本GSI兼容性。</p>

 </div>


</div>    
</body>
</html>