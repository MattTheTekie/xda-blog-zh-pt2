<html>
<head>
<title>A Look Into Instagram's Compression Quality</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Instagram压缩质量初探</h1>
<blockquote>原文：<a href="https://www.xda-developers.com/a-look-into-instagrams-compression-quality/#0001-01-01">https://www.xda-developers.com/a-look-into-instagrams-compression-quality/#0001-01-01</a></blockquote><div><div class="content-block-regular">
<p>Android的Instagram应用程序已经成为当今世界上最受欢迎的社交媒体平台之一。所有平台的月用户超过3亿，Google Playstore上的个人下载量超过1亿，你会认为脸书的快照共享应用程序在设计和功能上都有很高的质量。不幸的是，对于很大一部分用户群来说，也就是Android instagrammers用户，Instagram在唯一应该做的事情上做得不够好，那就是分享漂亮的图片。</p>

  
<p>虽然iOS用户可以高保真地分享他们的创作和时刻，但Android用户多年来一直报告他们的照片质量极度下降。抱怨这种头痛的最古老的帖子之一于2012年9月在XDA 上被发现，该帖子一直运行到现在，为读者提供了非正统的方法来尝试和绕过Instagram荒谬的销毁照片。你可能会认为，经过两年多的抱怨，软件和硬件的技术进步，以及经济和市场的增长，Instagram应该已经解决了这些问题。这是他们应该负责的事情吗？或者问题的潜在原因比看起来更深层？</p>

 
<h2 id="a-direct-look"><b>直视</b></h2>




<p>这是我自己拍的一张照片。原拍重<b> 4.34MB </b>，在<b> 9.6MP </b>拍摄。为了不考虑“Instacrop”缩减采样(可以理解，这会破坏这样一个高分辨率文件的细节，因为后来会将其缩减为Instagram的原生640x640像素输出)，我将其裁剪为Instagram上传的1:1纵横比的JPG，以查看后处理算法及其压缩对该文件的直接影响。</p>

<p>我只是抓取了方形的JPG作物，并将其发布在我的Instagram上，没有添加任何滤镜、效果或调整任何值。您可能会认为图像看起来与最初看到的非常相似，但结果并不令人满意。边框和颜色渐变周围的压缩伪像甚至对未经训练的眼睛来说也是惊人的明显。原始1:1裁剪文件的大小为<b> 1.6MB </b>，新的调整大小和压缩后的图像为<b> 125KB </b>。这意味着压缩将原始文件的大小减少了几乎一倍【T4 13-】这在某些情况下不一定是坏的。</p>

<p>有趣的是，Instagram提供了一个默认关闭的“高质量图像处理”，但当打开时，结果似乎并没有真正改善，压缩文件位于<strong> 129KB </strong>。在这里，我为您提供了相同的作物，你可以看到目前的压缩仍然相当强烈，图像的保真度仍然具有粗糙和像素化的损失。</p>




<p class="ad-odd"> </p>


<h2 id="compression"><b>压缩</b></h2>
<p>计算机算法提供了各种方法来缩小图像的大小，用不同的技术来优化</p>



<p>稍后需要对数据进行解释，并以适当的方式显示适当的图片。许多图像文件类型都与它们支持或不支持的压缩技术紧密相关，这就是为什么我们通常会看到某些类型的图片比其他类型的质量更好。<i> PNG </i>(便携式网络图形)文件通常用于在不损失保真度和图片质量的情况下共享媒体，代价是文件比经过有损压缩的图像更大。<i> GIF </i>是一种非常古老的图像格式，也是无损压缩的。</p>

<p>许多程序员在学术研究中学习减少或优化文件大小的技术，而不管他们将在哪个领域发展。诸如<a href="http://www.zlib.net/feldspar.html" target="_blank">紧缩</a>(用于<i> PNG </i>)或<i>莱姆佩尔-齐夫-韦尔奇</i>算法(通常用于<i> GIF </i>)之类的名字如今在许多计算机科学课堂上运行，在许多程序员的耳边响起，随着越来越有效的压缩技术的进一步发展和记录，你会期望亿万富翁平台纳入合理有效的算法，以输出非常好的图像，同时使技术不会对他们的服务器和用户的硬件造成太大的负担。</p>

<p>但事实并非如此。数以百万计的Instagrammers和我每天拍摄并上传的照片，与这些科技世界超级大国的工程实力的叙述直接矛盾，这些超级大国应该将收入的很大一部分投入到他们的软件中，以提供最佳的用户体验。但是这里还有一个问题没有回答:<b>为什么是Android而不是iOS？</b></p>
<p class="ad-even"> </p>


<h2 id="vsco-and-android-memory"><b> VSCO和安卓内存</b></h2>
<p>虽然Reddit等热门互联网论坛试图找出他们每天愤怒的原因，但这种不公正似乎没有逻辑基础，除了可能的解释，即Android硬件在计算能力方面本质上较差，或者考虑到大量低端Android设备，必须采取这些措施来确保整个平台的一致用户体验——无论你为手机支付了多少钱。几个月过去了，每次Instagram更新后的报告都在报告同一个问题，以至于这个问题成了论坛用户的一个笑话，紧接着应用程序的每次迭代。</p>

<p>用户还注意到流行的相机和图片编辑应用程序VSCO凸轮类似的情况。吹捧“Android摄影的新标准”，一些人很快注意到该应用程序没有达到这些要求。注意到的质量损失和人工制品的类型与Instagram相似，因此一些人很快认为有一条线将这些点连接起来。到目前为止，我们只是猜测这个问题的原因是什么。一些人将问题直接归咎于Android内置的位图下采样算法。然而，似乎已经浮出水面的最令人信服的原因是一个简单的事实，即Instagram，可能还有VSCO，对下采样算法的实现很差，特别是<a href="https://clouard.users.greyc.fr/Pantheon/experiments/rescaling/index-en.html#nearest" target="_blank">最近邻重采样</a>。但是没有来自开发者的官方消息，这个推测不能被完全证实。</p>

<p>就在那时，我们通过<a href="https://vsco.zendesk.com/hc/en-us/articles/200323170-VSCO-Cam-Are-my-images-in-full-resolution-" target="_blank"> VSCO的技术支持</a>了解到，他们失去分辨率和保真度的原因不是糟糕的软件实现，而是Android设备中的内存限制:</p>

<blockquote>
<p>“大多数Android设备的内存都非常有限，尽管有些设备有几千兆字节的内存，<b>但应用程序不允许使用所有可用的内存，因此我们必须利用Android给我们的内存。”</b></p>
<p>"导入<b>时，根据您使用的设备和可用内存，大图像可能会缩小50%。</b></p>
 </blockquote>
<p>他们还声称，他们的图像处理技术对内存和SoC都非常费力，这一点，加上Android内存的限制，就是为什么我们看到了iOS上没有的质量瓶颈。</p>

<p>根据<a href="https://developer.android.com/training/articles/memory.html#RestrictingMemory" target="_blank"> Android的开发者培训文章</a>，为每个应用的<b>堆大小设置了一个硬限制，以维持一个功能性的多任务环境。这取决于设备有多少RAM可用，如果应用程序接近堆容量，它就有耗尽RAM的风险。</b></p>

<p>所以乍一看，VSCO的故事似乎很有说服力，但这并不能解释那些持怀疑态度的人无法摆脱的一些事情。</p>
<p class="ad-odd"> </p>


<h2 id="limitation"><b>限制</b></h2>
<p>粗略地看一下，我们可以问这个问题:如果一部通常拥有1GB至2GB内存和最新便携式处理器的智能手机不能处理全分辨率图像，为什么32MB内存的DSLR相机能够做到这一点？</p>

<p>我们联系了一位资深的知名开发人员，就这个问题收集了更有力的意见。<a href="http://omnirom.org/" target="_blank"> OmniROM </a>开发者<a href="http://forum.xda-developers.com/member.php?u=2162789" target="_blank"> XpLoDWilD </a>评论道:</p>

<blockquote>
<p>“这里的限制是图像计算或处理的方式。GPU在这方面速度更快，最快的方法是将图像作为纹理‘上传’到GPU并进行处理——它的问题是你受到GPU最大纹理大小的限制，通常为4096x4096。”</p>
 </blockquote>
<p>一般来说，800万像素的图片是3264x2448，小到足以适应4000x3000的最高1200万像素的限制。较新的旗舰产品和拍照手机传感器可以达到1300万像素以上，并且图片尺寸大于GPU的最大纹理尺寸，这将不可避免地需要在限制范围内缩小图像，并丢失整体细节。</p>

<p>“问题不在于应用程序正在上传缩小版本的图片，而是应用程序正在处理缩小版本的图片，并上传处理后的文件。”他补充道。很可能是为了进一步减少处理时间，他们还将分辨率设置得更低。</p>

<p>XpLoDWilD建议，处理时间和GPU约束之间的微妙平衡应该是，不要向用户显示他们正在处理的图像的完整处理预览，而是让编辑过程的视觉帮助成为可以适合屏幕的缩小缩略图(小于2048x2048)。这个缩略图通常可以被可靠地快速处理，同时仍然给用户一个图片看起来如何的良好估计。当用户确认他在值调整和过滤器选择上所做的选择时，全分辨率图片将在背景中被转换——通过在缩略图分辨率大小的网格中分割图像，然后分别处理每个块。最后一步需要在CPU上合成最终的图像，将每个区域重新组合成一个大的全分辨率位图。</p>

<p>这是以原始分辨率处理图像的一种方式。这是Instagram似乎不会做的事情，因为你看到的预览，一直到你处理图片的那一刻，都没有准备上传的图片那样糟糕的质量和伪像。预览图像似乎没有经历残酷的压缩，所以压缩发生在处理最终图像的时刻——这输出了低质量的图像。</p>

<p>Android平台在处理高分辨率图像方面确实没有问题，更不用说上传了。在硬件方面，最新的iPhones有2048到4096的纹理大小限制。因此，这可能不是硬件限制，也不是平台限制——因为它可以并且已经被其他开发人员解决了。</p>
<p class="ad-even"> </p>


<h2 id="but-there-was-a-cap-to-the-heap-size-though">但是堆的大小是有上限的！</h2>
<p>是的，但不完全是。Java堆有一个合理的限制，因为高密度图像需要额外的内存。经过一些研究，我发现了谷歌小组讨论Android NDK或<i>原生开发工具包</i>的辩论片段，它允许开发人员通过<em> Java原生接口</em>将C/C++编写的代码引入应用程序，从而重用这些代码，使应用程序的执行速度更快，因为它直接在处理器上而不是虚拟机上解释。</p>

<p>在对话中，谷歌工程师兼Android框架开发者<a href="https://plus.google.com/105051985738280261832/posts" target="_blank"> Dianne Hackborn </a>澄清了一些关于Android内存限制的误解。她注意到，<i>“鉴于这是NDK列表，这个限制实际上并没有强加于你，因为它只是在Java堆上。本机堆中的分配没有限制... "</i>。至于RAM的使用，她评论道:<i>“如果有足够的RAM，数据将被保存在RAM中。不然的话...嗯，你还是跑吧”。</i></p>

<p>她还说，不仅对本机堆没有限制，对GPU堆也没有限制。由于NDK的存在，看起来Android整体上并没有“强加”多少内存、通用处理或GPU的限制。</p>

<p/><p>但即使这样，Java堆也应该足够容纳一张图片<img class=" size-medium wp-image-104291 alignright" src="../Images/5681afe67ffde8f8cc025d906d65b74e.png" alt="MONITOR" data-original-src="https://static0.xdaimages.com/wordpress/wp-content/uploads/2015/01/MONITOR.png"/>。一张1300万像素的未压缩位图(ARGB 8888)大约需要<b> 50MB </b>。默认的最大堆大小范围为<b>256 MB或</b>T5】512 MB，具体取决于Android设备及其运行的Android版本。Instagram在空闲时大约需要62MB，从我的系统监控图来看，在检索和处理1300万像素的图像时，内存使用的增加似乎可以忽略不计，当然也远远没有接近所谓的“由Android强加的”限制，不管怎样都可以解决这个问题，也可以通过使用某些算法来避免或减轻这个问题。</p>
<p class="ad-odd"> </p>


<h2 id="conclusion"><b>结论</b></h2>
<p>就像前面提到的，我们可能永远不会知道这些应用程序背后的全部故事。但是，通过仔细观察，制造商或其辩护者的回应所做出的辩解似乎并不那么可信。这里的问题似乎是由平庸的软件实现引起的，而不是Android的硬件或软件似乎可以提供的任何限制。</p>

<p>存在围绕压缩工作的应用程序的事实，加上关于Android内部工作的文档的存在和内容，当前Android硬件的潜力和专家的意见，所有这些似乎都指向Android用户面临的不公正要么是故意的，要么至少是公认可以解决的。</p>

<p><strong>我认为现在是时候让安卓用户不仅得到真相，也得到他们应得的待遇。虽然在硬件方面，安卓设备总体上(T2)的平均水平和中位数可能低于iPhones，但没有理由降低标准，破坏每个人的用户体验。随着每个开发人员给平台提供二手的剩余产品，用户越来越多地将他们的沮丧集中在开发人员身上，而不是系统——就像它应该的那样。</strong></p>

<p><em>特色图片</em>归功于<a href="http://thepixelpulse.com/2012/04/review-instagram-for-android-is-great/" target="_blank"> PixelPulse </a></p>

 </div>


</div>    
</body>
</html>