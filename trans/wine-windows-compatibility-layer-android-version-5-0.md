# Wine，Windows 兼容层，在 Android 上达到 5.0 版本

> 原文：<https://www.xda-developers.com/wine-windows-compatibility-layer-android-version-5-0/>

# Wine，Windows 兼容层，在 Android 上达到 5.0 版本

Wine 是一个 Windows 兼容层，允许用户在其他操作系统上运行 Windows 应用。Wine for Android 现在已经到了 5.0 版——来看看吧！

在 Android 存在的这些年里，Android 应用生态系统一直在稳步发展，这是由大多数人稳步采用移动设备作为主要的计算机交互方式推动的。许多用户都倾向于只使用手机的生活方式，这是因为手机上的应用和应用生态系统已经设法满足了他们的特殊需求。但是，如果您发现自己需要一个桌面应用程序，却无法访问桌面，您会怎么做？这就是 Wine 的由来，它是一个 Windows 兼容层，允许用户在不同的操作系统上运行成熟的 Windows 应用程序。Wine for Android 现在已经达到了 5.0 版本，整理了团队一年的开发成果。

Wine 是一个免费的开源 Windows 兼容层，旨在允许为 Windows 开发的计算机程序在其他操作系统上运行。 [Wine for Android 给 Android 带来了 Wine](https://www.xda-developers.com/run-windows-apps-on-android-wine/)，很明显。Wine 不是仿真器(实际上是名称的递归 backronym)，所以它只能运行特定架构版本的应用程序——ARM 版本的 Wine for Android 只会运行 ARM 应用程序，而不会运行 x86。

Wine 5.0 稳定版的亮点包括多显示器支持和 Vulkan 1.1 支持。更新的完整变更日志如下:

### Wine 5.0 变更日志:

*   PE 模块:
    *   当 MinGW 编译器可用时，大多数模块是以 PE 格式(可移植可执行文件，Windows 二进制格式)而不是 ELF 格式构建的。这有助于各种拷贝保护方案检查系统模块的磁盘内容和内存内容是否相同。
    *   实际的 PE 二进制文件被复制到 Wine 前缀中，而不是复制到假的 DLL 文件中。这使得前缀看起来更像一个真正的 Windows 安装，代价是一些额外的磁盘空间。
    *   已经转换成 PE 的模块可以使用标准的宽字符 C 函数，以及像 L“ABC”这样的宽字符常量。这使得代码更容易阅读。
    *   并非所有模块都已转换为 PE；这是一个正在进行的过程，将在 Wine 5.x 开发系列中继续进行。
    *   Wine C 运行时得到更新，支持链接到 MinGW 编译的二进制文件；默认情况下，在生成 dll 时使用它而不是 MinGW 运行时。
*   图形:
    *   正确支持多种显示适配器和显示器，包括动态配置更改。
    *   Vulkan 驱动程序支持 Vulkan 规范的最高版本 1.1.126。
    *   WindowsCodecs 库能够转换更多的位图格式，包括调色板索引格式。
*   Direct3D:
    *   全屏 Direct3D 应用程序禁止屏幕保护程序。
    *   当相应的窗口最小化时，DXGI swapchain 会通知应用程序。这通常允许应用程序在最小化的同时减少 CPU 使用，并且在某些情况下需要允许应用程序窗口再次恢复。
    *   使用标准的 Alt+Enter 组合在全屏和窗口模式之间切换是为 DXGI 应用程序实现的。
    *   Direct3D 12 应用程序实现了以下功能:
        *   在全屏和窗口之间切换。
        *   更改显示模式。
        *   缩小的礼物。
        *   交换间隔。这些功能在早期版本的 Direct3D API 中已经实现。
    *   改进了对各种边缘情况的处理。除其他外:
        *   alpha 和模板测试的参考值超出范围。
        *   使用 3D 采样器对 2D 资源进行采样，反之亦然。
        *   使用贴图纹理和缓冲区绘图。
        *   使用了无效的 DirectDraw 裁剪器对象。
        *   在无效窗口(如桌面窗口)上创建 Direct3D 设备。
        *   最小 Z 大于或等于最大 Z 的视口
        *   同时通过着色器资源视图和渲染目标或深度模板视图绑定的资源。
        *   有和没有 alpha 组件的格式之间的 Blits。由于表现良好的应用程序不依赖于这些边缘情况，它们通常只影响一个或两个应用程序。然而，他们的数量相当多。
    *   对于 Direct3D 8 和 9 纹理上传，脏纹理区域被更准确地跟踪。
    *   上传 S3TC 压缩的 3D 纹理需要更少的地址空间。由于 3D 纹理可能很大，并且地址空间耗尽是 32 位应用程序的一个问题，因此 S3TC 压缩的 3D 纹理是按片上传的，而不是单次上传。
    *   实现了 id3d 11 多线程接口。
    *   对旧的 DirectDraw 应用程序进行了各种光照计算修复和改进。
    *   实现了对跨交换链的 blits 的有限支持。
    *   实现了更多的着色器反射 API。
    *   wined3d CPU blitter 可以处理压缩的源资源。在以前的版本中已经实现了对压缩目标资源的支持。
    *   Direct3D 显卡数据库识别更多的显卡。
    *   新的 HKEY _ 当前 _ 用户\软件\葡萄酒\Direct3D 注册表项:
        *   " shader_backend" (REG_SZ)要使用的着色器后端。可能的值为“glsl”(默认)代表 GLSL，“arb”代表 ARB 顶点/片段程序，“none”代表禁用着色器支持。
        *   “strict _ shader _ math”(REG _ DWORD)启用(0x1)或禁用(0x0，默认值)Direct3D 着色器的更严格转换，可能会以性能为代价。这目前只与默认的 GLSL 着色器后端结合专有的 NVIDIA 驱动程序有所不同。
    *   已弃用的 HKEY _ 当前 _ 用户\软件\葡萄酒\Direct3D 注册表项:
        *   “UseGLSL”这已被上面的“shader_backend”设置所取代。
*   D3DX:
    *   实现了使用 S3TC-compression 压缩纹理的支持。
    *   在不可映射的表面上的各种操作，例如纹理填充，可以更正确地实现。以前，它们的实现依赖于底层的 Direct3D 实现，不强制映射限制。
    *   对效果框架进行了各种改进和修复。
*   内核:
    *   Kernel32 中的大部分功能都转移到了 KernelBase 中，以遵循最新 Windows 版本的架构。
    *   当在搜索路径中找到错误的 32/64 位库时，将忽略这些库，以便能够在路径中找到正确的库时加载正确的库。
    *   对于希望从内核端操作对象的设备驱动程序来说，内核对象更适合模拟。
    *   实现了内核级同步对象，如自旋锁、快速互斥、移除锁和资源变量。
    *   系统电池状态被正确地报告给应用程序。
*   用户界面:
    *   最小化的窗口使用它们的标题栏显示，而不是旧的 Windows 3.1 样式的图标。
    *   实现了新的按钮样式拆分按钮和命令链接。
    *   编辑控件也可以为 CJK 字体正确设置边距。
*   桌面集成:
    *   为“下载”和“模板”文件夹创建了到相应 Unix 目录的符号链接。
*   输入设备:
    *   即插即用设备驱动程序可以在启动时安装和加载。
    *   游戏控制器得到了更好的支持，包括对帽子开关、滚轮、油门和刹车控制的正确支持。
    *   早于 2.2 的 Linux 版本的旧游戏杆 API 不再受支持。
*   。网络:
    *   Mono 引擎已更新至 4.9.4 版，包括 Windows 演示基础(WPF)框架的部分内容。
    *   Gecko 和 Mono 附加组件支持共享安装，其中文件直接从/usr/share/wine 下的全局位置使用，而不是复制到每个新前缀中。
*   互联网和网络:
    *   Gecko 引擎被更新以支持最新的工具链。
    *   实现了许多新的 HTML APIs。
    *   MSHTML 支持一些 SVG 元素。
    *   VBScript 支持错误对象和异常传播。
    *   实现了许多 VBScript 内置函数。
    *   JScript EcmaScript 兼容模式已扩展为支持更多功能。
    *   JScript 和 VBScript 脚本对象公开类型信息接口。
    *   HTTP 代理配置可以通过 DHCP 检索。
    *   支持 Passport HTTP 重定向。
    *   HTTP 服务和相应的客户端库(HTTPAPI)已经部分实现。
*   密码术:
    *   使用 GnuTLS 时支持 ECC(椭圆曲线)密钥。
    *   实现了从 PFX blob 导入密钥和证书。
    *   支持 PBKDF2 密钥派生算法。
*   文本和字体:
    *   DirectWrite 支持 OpenType 定位功能，默认情况下为拉丁文脚本启用，包括字距调整。
    *   通过在使用前验证各种数据表，字体数据访问变得更加安全。
    *   DirectWrite 接口更新到最近的 SDK，实现了一些最新的 API 添加。
*   音频/视频:
    *   为了更好的兼容性，XAudio2 库被重新实现为使用外部 FAudio 库。
    *   媒体基础库得到充实，包括:
        *   支持内置和用户异步工作队列。
        *   能够提交定期回调、等待、预定和常规工作项目，并支持项目优先级。
        *   支持媒体事件队列。
        *   处理媒体类型对象、流和表示描述符、对象属性、字节流对象、样本和缓冲区的各种核心 API。
        *   初始源解析器实现。
        *   源阅读器 API 的初始实现。
        *   样本抓取器对象的实现。
        *   构建拓扑对象的核心支持。
        *   内置演示时钟实现，开始实现媒体会话功能。
    *   视频捕获过滤器已移植为使用 v4l2，而不是已弃用的 v4l1 API，允许使用一些不支持 v4l1 的摄像机。
    *   删除了对 YUV 到 RGB 转换以及使用 mmap()从 v4l2 设备读取的支持；我们现在依靠 libv4l2 来做这两件事。
    *   内置的 AVI，MPEG-1 和波形解码器已经被删除；我们现在依靠 GStreamer 或 Mac QuickTime 工具包来解码这样的媒体文件。
    *   实现了更多的 VMR7 配置 API。
    *   声音驱动程序支持每个声道的音量调节。
*   国际化:
    *   Unicode 字符表基于 Unicode 标准的 12.1.0 版。
    *   实现了 Unicode 规范化。
    *   地理区域 id 是根据当前的区域设置在注册表中自动设置的。如有必要，可以在 HKEY 当前用户控制面板国际地理下进行修改。
    *   支持僧伽罗语和阿斯图里亚斯语言环境。
    *   支持代码页 28601(拉丁语/泰语)。
*   RPC/COM:
    *   typelib 封送拆收器支持复杂的结构和数组。
    *   有一个 Windows 脚本运行时库的初始实现。
    *   这是 Microsoft ActiveX 数据对象(ADO)库的一个初始实现。
*   安装人员:
    *   支持 Microsoft Installer (MSI)修补程序文件。
    *   WUSA 工具(Windows Update 独立安装程序)支持安装。MSU 更新文件。
*   ARM 平台:
    *   使用 libunwind 库为 ARM64 实现了异常展开。
    *   arm64 支持 ole ssubtles 代理。
*   开发工具/ Winelib:
    *   Visual Studio 远程调试器可用于调试在 Wine 下运行的应用程序。
    *   调试引擎库(DBGENG)已部分实现。
    *   为 Windows 目标构建的二进制文件不再依赖于 libwine 库，这使它们能够在 Windows 上运行，而无需任何额外的依赖。libwine 库已经不再是为 Windows 构建的了。
    *   资源编译器和 IDL 编译器支持'- sysroot '选项，以允许在交叉编译环境中定位头文件。
    *   Winegcc 支持选项'- target '，'- wine-objdir '，'- winebuild '和'-fuse-ld '，这使得它更容易用作交叉编译器，或与自定义工具链一起使用。
    *   wine/unicode.h 头文件对应用程序不再可用，因为这些函数最终将被移除，并被标准的 C 运行时宽字符函数所取代。
*   建设基础设施:
    *   如果 MinGW 可用，测试二进制文件以 PE 格式构建，因此相同的测试二进制文件可以在 Wine 和 Windows 上运行。不再需要或支持“交叉测试”make 目标。
    *   规范文件支持“快速调用”调用约定。它为 Windows 构建使用了正确的名称 mangling。
    *   规范文件中支持“-import”入口点标志，以标记需要为其导入路径生成热补丁代码前缀的函数。
    *   Winebuild 支持一个'- builtin '选项，为 PE 二进制文件添加一个特殊的签名，将它们标记为 Wine 内置文件。
*   内置应用程序:
    *   CHCP 工具已经实现。它允许设置控制台代码页。
    *   MSIDB 工具已实现。它允许操作 MSI 数据库。
*   性能改进:
    *   各种时间函数使用更高性能的系统时钟，以减少许多游戏渲染循环的开销。
    *   如果在被搜索的目录上启用了 ext4 文件系统大小写折叠支持，那么文件查找就可以利用这种支持。
    *   无数据风格的列表框(LBS_NODATA)对于大量的条目有更好的性能。
    *   瘦读/写锁、键控事件和条件变量在 Linux 上使用 futexes 来避免 wineserver 往返。
*   新的外部依赖项:
    *   MinGW-w64 交叉编译器用于构建 PE 格式的模块。
    *   FAudio 库用于实现 XAudio2。
    *   Inotify 库用于 BSD 平台上的文件更改通知。
    *   展开库用于 ARM64 上的异常处理。
    *   使用 Video4Linux 版本 2 库，而不是版本 1。

* * *

**来源:[酒师部](https://www.winehq.org/news/2020012101)**

**故事 Via: [安卓警察](https://www.androidpolice.com/2020/01/21/windows-compatibility-layer-wine-hits-v5-0-on-android/)**