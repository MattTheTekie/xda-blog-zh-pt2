<html>
<head>
<title>Android O's Autofill Framework will Finally Resolve a Long-Standing Lag Issue with Password Managers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Android O的自动填充框架将最终解决密码管理器的长期滞后问题</h1>
<blockquote>原文：<a href="https://www.xda-developers.com/android-os-autofill-framework-will-finally-resolve-a-long-standing-lag-issue-with-password-managers/#0001-01-01">https://www.xda-developers.com/android-os-autofill-framework-will-finally-resolve-a-long-standing-lag-issue-with-password-managers/#0001-01-01</a></blockquote><div><div class="content-block-regular">
<p/><p>谷歌发布第一个Android O开发者预览版已经一个月了(时间过得真快！)，就像任何新版本的Android一样——有很多东西需要挖掘。我们已经<a href="https://www.xda-developers.com/tag/android-o/">发表了大量关于Android O的文章</a>，但是有一个功能我觉得还没有得到应有的关注:T4的自动填充框架。</p>

 
<h3 id="autofill-in-android-o">Android O中的自动填充</h3>
<p>如今，密码管理器随处可见(尽管我们更喜欢开源的KeePass，但只有在Android O上，谷歌才真正正式支持密码管理器。使用Android O，第三方应用程序可以填充自动填充服务，该服务通过新的自动填充框架与应用程序进行通信。使用标准<a href="https://developer.android.com/reference/android/view/View.html">视图</a>元素的应用程序将与开箱即用的自动填充框架一起工作，尽管开发者可以采取额外的步骤来<a href="https://developer.android.com/preview/features/autofill.html#optimizing_your_app_for_autofill">优化自动填充</a>，以确保应用程序的任何自定义视图都可以自动填充。</p>

<p>当自动填充视图成为焦点时，自动填充框架将调用自动填充请求。自动填充服务通过发回某些自动填充数据集(如用户名、密码、地址、信用卡号等)来响应。)用户然后可以选择它。自动填充服务由用户在设置-&gt;应用与通知-&gt;默认应用-&gt;自动填充应用中指定。</p>
<div class="body-img landscape"><div class="responsive-img image-expandable img-article-item" data-img-url="https://static1.xdaimages.com/wordpress/wp-content/uploads/2017/04/autofill-1-300x157.png" data-modal-id="single-image-modal" data-modal-container-id="single-image-modal-container" data-img-caption="&quot;Autofill App in Android O. Credits: &lt;a href=\&quot;https:\/\/blog.lastpass.com\/2017\/04\/what-lastpass-users-can-expect-in-android-o.html\/\&quot;&gt;Lastpass&lt;\/a&gt;.&quot;">
 
<figure> <picture>  <source media="(min-width: 1024px)" sizes="1500px" data-srcset="https://static1.xdaimages.com/wordpress/wp-content/uploads/2017/04/autofill-1-300x157.png?q=50&amp;fit=crop&amp;w=1500&amp;dpr=1.5"/> <source media="(min-width: 768px)" sizes="943px" data-srcset="https://static1.xdaimages.com/wordpress/wp-content/uploads/2017/04/autofill-1-300x157.png?q=50&amp;fit=crop&amp;w=943&amp;dpr=1.5"/> <source media="(min-width: 481px)" sizes="767px" data-srcset="https://static1.xdaimages.com/wordpress/wp-content/uploads/2017/04/autofill-1-300x157.png?q=50&amp;fit=crop&amp;w=767&amp;dpr=1.5"/> <source media="(min-width: 0px)" sizes="480px" data-srcset="https://static1.xdaimages.com/wordpress/wp-content/uploads/2017/04/autofill-1-300x157.png?q=50&amp;fit=crop&amp;w=480&amp;dpr=1.5"/> <img class="lazyload" alt="" data-img-url="https://static1.xdaimages.com/wordpress/wp-content/uploads/2017/04/autofill-1-300x157.png" src="../Images/defb4d8501a88dda48e614c015a3fc28.png" data-original-src="https://static1.xdaimages.com/wordpress/wp-content/uploads/2017/04/autofill-1-300x157.png"/> </picture> <figcaption class="body-img-caption">Autofill App in Android O. Credits: <a href="https://blog.lastpass.com/2017/04/what-lastpass-users-can-expect-in-android-o.html/">Lastpass</a>.</figcaption> </figure> </div>


 </div>


<p>上面对新的自动填充框架的解释只是对请求应用程序和自动填充服务端发生的事情的简要总结。对于你的理解来说，最重要的不是自动填充在Android O中如何工作的具体细节，而是这样一个事实，即<strong>密码管理器应用程序本身不再检测视图何时可以被自动填充</strong>。</p>

<hr/>

<p><strong>推荐阅读:</strong> <a href="https://www.xda-developers.com/agilebits-shows-off-what-android-os-autofill-framework-will-look-like/"> AgileBits展示Android O的自动填充框架会是什么样子</a></p>

<hr/>

<h3 id="autofill-before-android-o">安卓O前自动填充</h3>
<p>与Android O之前的自动填充相比，在密码管理器有任何官方方法来检测视图何时可以自动填充之前，每个应用程序都必须实现可访问性服务来扫描当前视图，以便找到自动填充字段。</p>



<p>然而，在某些情况下，使用辅助功能服务会导致相当大的延迟。然而，与典型的密码管理器的可访问性服务相关的滞后是如此明显，以至于流行的服务如LastPass甚至有关于这个问题的<a href="https://lastpass.com/support.php?cmd=showfaq&amp;id=8166">支持页面</a>。这些支持页面通常会告诉您，处理由辅助功能服务导致的过度延迟的唯一方法是禁用辅助功能服务或切换到使用他们自己的自定义输入法。无论哪种方式，您都会失去任何自动填充功能。</p>

<p>但是到底为什么LastPass的可访问性服务，或者任何其他密码管理器的可访问性服务，看起来会造成这么大的延迟？原因是这些密码管理器必须利用可访问性服务来检测输入字段。辅助功能服务的<a href="https://developer.android.com/reference/android/R.styleable.html#AccessibilityService">属性</a>是在APK内的<a href="https://developer.android.com/reference/android/accessibilityservice/AccessibilityService.html#SERVICE_META_DATA"> XML资源文件</a>中定义的，因此我们可以通过反编译APK文件来了解服务是如何工作的。</p>

<p>下面是反编译LastPass APK的资源文件:</p>

<pre> <code class="hljs javascript"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br/>&lt;accessibility-service android:description=<span class="hljs-string">"@string/accessibility_service_description"</span> <br/>android:accessibilityEventTypes=<span class="hljs-string">"typeViewFocused|typeWindowContentChanged"</span> <br/>android:accessibilityFeedbackType=<span class="hljs-string">"feedbackGeneric"</span> <br/>android:notificationTimeout=<span class="hljs-string">"200"</span> <br/>android:accessibilityFlags=<span class="hljs-string">"flagReportViewIds"</span> <br/>android:canRetrieveWindowContent=<span class="hljs-string">"true"</span> <br/>android:canRequestEnhancedWebAccessibility=<span class="hljs-string">"true"</span><br/>xmlns:andro /&gt;</code> </pre>
<p>由此，我们可以收集以下信息:LastPass的可访问性服务请求两种事件类型进行监控——TYPE _ VIEW _ FOCUSED和TYPE_WINDOW_CONTENT_CHANGED。它这样做是因为它需要知道应用程序/网页的内容何时改变或成为焦点，然后它检索当前窗口内容以寻找任何密码输入字段。但是由于服务经常在两个非常频繁的可访问性事件上这样做，所以会导致延迟。关于可访问性服务如何导致延迟的更深入的讨论，我可以参考我以前关于这个问题的文章。</p>

<hr/>

<p><strong>推荐阅读:</strong> <a href="https://www.xda-developers.com/working-as-intended-an-exploration-into-androids-accessibility-lag/">【按预期工作】——安卓无障碍滞后探究</a></p>

<hr/>

<h3 id="android-o-kills-two-birds-with-one-stone">安卓O一石二鸟</h3>
<p>在Android O之前，密码管理器的开发者并没有多少办法来缓解这种滞后。这是因为如果没有辅助功能服务的持续监控，密码管理员就无法知道自动填充的输入字段何时出现在屏幕上。但由于Android O中新的自动填充框架，这些密码管理器现在可以退休他们的可访问性服务了。相反，需要数据输入的应用程序将请求自动填充框架调用自动填充服务，然后自动填充服务将发送数据。有了这个新框架，不仅用户输入密码变得更加容易，因为他们不再需要依赖额外的输入方法，而且与启用密码管理器的可访问性服务相关的延迟也将成为过去。</p>

<p>我知道，对你们中的一些人来说，这个事实可能不是突破性的，但是我认为，由于围绕可访问性服务的讨论是如此沉默，这个话题可能值得重新点燃。只是这个周末的精神食粮！</p>

<hr/>

<p><strong>如何看待Android O新的自动填充框架？请在下面的评论中告诉我们！</strong></p>

 </div>


</div>    
</body>
</html>