<html>
<head>
<title>Biggest Bottlenecks When Building Android From Source</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>从源代码构建Android时的最大瓶颈</h1>
<blockquote>原文：<a href="https://www.xda-developers.com/biggest-bottlenecks-building-android-from-source/#0001-01-01">https://www.xda-developers.com/biggest-bottlenecks-building-android-from-source/#0001-01-01</a></blockquote><div><div class="content-block-regular">
<p/><p><strong>更新4/19 12 pm CT </strong>:澄清构建时间是ccache构建时间。<strong>CT时间4月20日上午9:17更新:</strong>建造3肯定不是RAID 1。纠正了那个错误。</p>

  
<p/><p>2012年，我开始构建内核——并依赖我可信赖的Core 2 Quad Q9550来构建它。如果这还不值得大惊小怪的话，那么我在Windows内部的虚拟机上做这件事的事实可能会确保对于大多数从源代码构建Android的人来说。</p>

<p>虚拟化的Ubuntu环境的性能不如本地环境，哦，当一个内核花了2个多小时来构建时，这是多么痛苦啊。当我想在第二年开始从源代码构建Android时，我知道我目前的硬件无法满足我的要求——于是开始了一个漫长而持续的旅程，寻找一种方法来缩短不断增长的构建时间。</p>

<p>从那以后的几年里，我有幸在多种外形和平台上进行测试。这一点很重要，因为Android的构建配置并不是一刀切的。应用程序开发人员可能不需要与游戏开发人员相同的配置。只构建内核的人可能不需要像需要在很短的时间内从源代码构建完整的Android ROM的人那样花费很多。那么操作系统选择呢——现在哪些可以(哪些不可以)使用？我也希望进一步探索这一点，特别是与Windows和Canonical合作，为Windows 10带来一个成熟的Bash。</p>

<p>为了让这个系列有个好的开始，我们必须从源代码中找到构建AOSP项目的最大潜在瓶颈在哪里。在不知道把钱投到哪里的情况下，我们不会经常去购买电脑或升级。因此，基于3年的研究和可量化的结果，我准备分享我的发现。现在，预期的免责声明:这些发现是基于个人经验，不可能在所有的组合因素。那些有自己构建配置的人，请告诉我们你的构建进展如何！时间也指启用并填充ccache的构建——当ccache还没有被填充时，时间通常是两倍。</p>

<p><strong/></p>



<p>磁盘I/O:我必须向Cyanogen的汤姆·马绍尔致敬——他也是康团队的<a href="http://aokp.co/team">成员——去年为我指出了这个方向。当他告诉我这将是CPU的瓶颈<em>时，我真的不相信他。但在过去的6个月里，我已经能够用可量化的数据来支持这一点。在高端CPU(如大多数台式机英特尔酷睿i7型号)中，这是您的系统将遇到的最大瓶颈。</em></a></p>

<p>让我们来看看我已经测试过的4种构建配置。我将在这里突出显示CPU，</p>

<ul> <li>Build 1是我的“未升级”电脑，是一台英特尔i7-4790K，32GB DDR 3-2400 RAM，一台三星840 Evo 250GB主驱动器和一台旧的Micron P400E 100GB。</li> <li>版本2，是版本1的升级版本。现在配备了超频到4.0 GHz的英特尔i7-5960X、32GB的DDR4-3200内存、三星SM951 512GB AHCI m.2固态硬盘以及之前的两个固态硬盘。PCPartPicker 上有完整的版本规格。</li> <li>Build 3是最近的用户版本，采用了超频到4.2 GHz的英特尔i7-5820K，16GB的DDR4-2400和2个RAID0(条带)配置的三星840 EVO 120GB。</li> <li>Build 4是最近的服务器版本，采用正常速度的英特尔至强E3-1270 v5、32 GB DDR4-2133、三星950 Pro 512GB NVMe m.2以及RAID5阵列中的4个SATA三星企业固态硬盘。</li> </ul>

<p>如果您只看这些，您认为哪一个实现了最短的构建时间？第二个呢？令我震惊的是，不是第二种配置花费了最少的构建时间，而是第三种配置，构建CyanogenMod 13.0仅用了不到14分钟。所以占主导地位的CPU肯定会屈居第二，对吗？又错了。我刚刚完成测试的Build 4用了25分钟多一点！只有这里是我当前构建的位置，比具有一半内核和线程但具有3个SSD的SSD阵列的系统慢2分钟，而我的SSD是独立的。众所周知，如果温度过高，SM951也会出现节流问题，这在这种情况下可能是一个非常现实的因素。第一次也是最慢的一次构建花了大约30分钟，这是我唯一一次构建CM 13.0我在27中听说过类似的建造配置。</p>

<p>固态硬盘过去也很难买到，所以这个话题很少有人讨论。然而，去年零售和二手市场的价格都大幅下降。现在120GB固态硬盘的价格不到50美元，不再是以前在系统中添加固态硬盘的障碍。传统硬盘也可以完成这项工作，但如果不使用固态硬盘，用户更有可能在其他人之前达到这一瓶颈。</p>

<p/><p><strong><img class="alignright wp-image-51955" src="../Images/c60bc677f7494740fe19e2ceeec3e933.png" alt="CPU Sleep" data-original-src="http://static1.xdaimages.com/wordpress/wp-content/uploads/2012/06/CPU-Sleep.jpg"/></strong>CPU:当我在上面提到最大的瓶颈是磁盘I/O时，它确实是在一个假设中，这个假设可能并不总是如此——我使用的每一个版本都采用了英特尔酷睿i7。但正如我在至强服务器上发现的那样，在最繁重的构建过程中，磁盘可以保持所有8个CPU线程的高利用率。尽我所能，如果没有我们在上面发现的RAID阵列，我发现我的Haswell-E在大部分构建过程中都没有得到充分利用。因此，如果您正在寻找性价比最高的产品，请考虑英特尔i7-5820K。</p>

<p/><p>没错，它是X99，所以主板可能比Z97主板更贵；但我们仍处于X99周期的第一年。Broadwell-E的价格预计在发布时也将与Haswell-E类似，这意味着您应该能够以与i7-4790K或i7-6700K几乎相同的价格购买发烧友产品。</p>

<p>在英特尔上，目前没有太多理由超越5820K，因为你可以用它获得令人印象深刻的构建时间。在大多数情况下，内核/线程数越高，处理器速度越快，构建时间就越短。去年，一台千兆字节白利糖度的i7-4770R平均花费了我42分钟。虽然不是最快的，但它确实符合我的需求，并允许我拥有一个专用的低功耗配置。你会发现AMD APUs也是如此——虽然它们目前的性能可能不如英特尔的同类产品，但它们可以轻松完成工作，而且价格通常低于购买英特尔的价格。这是一个我密切关注的情况，因为如果谣言是真的，那么基于Zen的APUs可能会大大缩小这个差距。</p>

<p>对于那些选择消除这些瓶颈的人来说，有一个结果，这个结果更适用于家庭用户而不是办公室用户。通过消除这些瓶颈，系统的总体性能将会提高。尤其是游戏玩家会发现，通过升级来解决这些瓶颈，几乎在所有情况下都会提高游戏性能。虽然它可能没有赢得最快的构建时间，但第二个构建给了一个意想不到的惊喜——<em>上30秒的加载时间仅仅导致了3 </em>,而许多其他人都在抱怨加载时间只有几分钟。最后，这些构建时间确实是高端的，对许多人来说可能是多余的...但至少现在，更多的内核意味着更快的构建速度的争论终于平息了。</p>

<p>由于这只是一个开始，我们希望读者能参与进来，分享他们在各种配置上的构建经验。作为读者，你想看到更多关于这类话题的讨论吗？请在下面的评论中发表意见！</p>

 </div>


</div>    
</body>
</html>