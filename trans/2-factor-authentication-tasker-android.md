# 使用 Tasker 加速 Android 上的双因素身份验证

> 原文：<https://www.xda-developers.com/2-factor-authentication-tasker-android/>

我们都知道在线安全非常重要，所以我们中的许多人已经开始使用各种双因素身份认证方法。

> “您的谷歌验证码是 431973”

但是每次我想登录的时候收到这条消息，我就想:哦，拜托！我想要安全，但是我要告诉你多少次:*‘是我谷歌！’*有了保障，通常就不能鱼与熊掌兼得了...还是可以？这就是 Tasker 认证助手的用武之地！虽然我知道谷歌的电话登录功能，这个项目超出了这一点，应该与任何类型的短信为基础的 2 因素认证。我们要做的是从文本消息中检索令牌，并使用 Join 将其发送到其他设备。

* * *

## Tasker 2 因素身份验证助手

我不得不承认，通常最简单的概要文件可以解决最烦人的问题。Tasker 身份验证助手非常简单，尽管我花了一段时间在正则表达式(regex)上惨败。我还没有找到一个单一的正则表达式公式在一个步骤中做到这一切，但该配置文件可以很好地与 2 正则过滤器一起工作。如果你是 regex 的专业人员，请随时将这两个公式结合在一起，并告诉我！

如果你真的关心你共享剪贴板的设备，你可以限制接收代码的设备为 Tasker 中的[活动 PC。](http://www.notenoughtech.com/tasker/tasker-active-pc/)

### 普通任务触发器

虽然就我个人而言，我更喜欢使用付费的自动通知任务插件来拦截短信通知，但你只需使用[任务插件](https://www.xda-developers.com/tasker-sale-1-dollar-right-now/)就可以完成整个设置，无需任何付费插件。vanilla 设置检查收到的每条消息(收到的文本消息事件)，尝试解析其内容。文本消息存储在系统变量 **%SMSRB 中。**

### 身份验证助手配置文件-普通任务器

```
Profile: Pin Code Vanilla 事件:收到的文本[类型:任何发件人:*内容:* ]回车:抓取一个代码 Txt
```

### 自动通知触发器

与普通的 Tasker 触发器不同，使用 AutoNotification intercept，我们可以仅在文本消息包含单词“pin”或“code”时运行任务。这样，Tasker 配置文件就不会在收到的每条短信上都运行。我正在使用自动通知拦截触发器来拦截消息。在上下文中设置一个简单的通知文本过滤器: **%antext (pin|code)** 将确保我不会无缘无故地开始分配任何值。如果没有必要，我们就不要运行该任务。

### 身份验证助手配置文件

```
Profile: Pin Code Txt 事件:自动通知拦截[配置:事件行为:真通知类型:仅创建的通知通知应用程序:信号通知文本:pin |代码(正则表达式)(大小写)包名:org.thoughtcrime.securesms ]回车:抓取一个代码
```

### 获取双因素身份验证代码

为了从文本消息中找出代码，我们将使用 2 个正则表达式过滤器。这应该可以防止分配不正确的值:

*   有数字的文本，但没有 pin 或代码字。
*   带有非 pin 或代码的数字的文本。
*   有多个数字的文本。捕捉代码/pin 后的第一个匹配。
*   包含多个数字的文本，其中代码/pin 字位于代码之后。

如果您使用普通的 Tasker 触发器，请用 **%SMSRB** 替换 **%antext** 。

### 抓住一个代码任务

```
Grab A Code A1:变量搜索替换[变量:%antext 搜索:(code|pin)。*?\d+忽略大小写:在多行上:仅在一个匹配项上:开将匹配项存储在:%code 替换匹配项:Off 替换为:]A2:变量搜索替换[变量:%antext Search:^(.*?)\d+忽略大小写:在多行上:仅在一个匹配项上:开将匹配项存储在:% code Replace Matches:Off Replace With:]If[% code 1！设置]A3:变量搜索替换[变量:%code1 搜索:\d+忽略大小写:在多行上:仅在一个匹配项上:开将匹配存储在:% auth Replace Matches:Off Replace With:]A4:设置剪贴板[ Text:%auth1 Add:Off ]
```

请测试邮件，以确保您的邮件得到相应的过滤。

#### Tasker 身份验证助手- regex

为了捕获实际的代码，我将使用 Regex。我的手机里储存了几个不同的版本，我将以它为例。我试图涵盖尽可能多的场景，但是如果您的验证文本超出了我的正则表达式过滤器的范围，您将不得不根据您的需要修改它。

让我们从捕捉单词 pin/code 后面的数字开始(不区分大小写)。我用 www.regex101.com 来帮助解决这个问题。

```
(code|pin).*?\d+
```

结果是好的，但是最后一个例子我失败了。我们的比赛是:

```
code is 431973

编码:895941

PIN 是 4044
```

使用搜索/替换动作，我将把匹配存储在数组 **%code** 中。我们的匹配将放在第一个元素: **%code1** 。如果验证文本遵循上一个示例，则不会设置 **%code1** 。如果是这种情况，我可以设置另一个正则表达式过滤器:

```
^(.*?)\d+
```

我将再次过滤结果，而不是构建一个非常复杂的正则表达式过滤器(主要是因为这个任务远远超出了我对正则表达式的理解)。在这两种情况下，第二个过滤器是相同的:

```
\d+
```

第二次过滤的结果作为第一个元素 **%auth1** 存储在 **%auth** 数组中。此变量用于设置剪贴板，并通过 Join 应用程序与其他设备共享。

* * *

## 结论

Tasker 认证助手项目工作迅速，有助于加快登录时间。我想我太老了，记不住那些短号码，或者我太老了，每次我想在不危及安全的情况下登录任何地方的时候都找不到我的手机。下面的项目文件包含两种设置(普通和自动通知)。请选择一个并禁用另一个配置文件。

[**下载 Tasker 2 因子认证助手项目**](https://www.androidfilehost.com/?fid=673368273298979231)

下载上面的 ZIP 文件，并将内容解压缩到您的 Android 设备的内部存储中。打开 Tasker，在首选项中禁用“初学者模式”。然后，回到 Tasker 的主页，长按左下角的 home 图标。您将看到一个“导入”项目的选项。点击该选项，然后找到您之前提取的. prj.xml 文件。导入后，您将会在 Tasker 的默认主页图标旁边的底部看到一个新标签。它包含这个助手项目的概要文件和任务。

跟随 [XDA 开发者教程](https://www.xda-developers.com/category/tutorials/)获取更多这样的帖子。此外，查看我们的 [Tasker Tips & Tricks](https://forum.xda-developers.com/u/tasker-tips-tricks) 论坛，了解我们社区中自动化爱好者的最新创造。