<html>
<head>
<title>Android Q+ may use the Vulkan Graphics API to render the UI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Android Q+可能会使用Vulkan图形API来呈现UI</h1>
<blockquote>原文：<a href="https://www.xda-developers.com/google-android-q-vulkan-graphics-render-ui/#0001-01-01">https://www.xda-developers.com/google-android-q-vulkan-graphics-render-ui/#0001-01-01</a></blockquote><div><div class="content-block-regular">
<p/><p>Android的下一个主要版本Android 9将于下个月面向多种设备发布。与Android Oreo不同，Android P提供了更多面向用户的功能，如改进的用户界面、导航手势和数字福利，同时还继续致力于Project Treble。但在幕后，谷歌已经改进了Android上图形渲染的工作方式。在Android Oreo中，谷歌开始测试Skia图形引擎的OpenGL硬件加速后端，该后端在Android P中完成。然而，谷歌并没有就此止步，因为该公司计划实施Skia图形引擎的<a href="https://skia.org/user/special/vulkan"> Vulkan后端</a>，该后端将在Android Q或更高版本中登陆。</p>

  
<p>证据来自于一位谷歌工程师提交的关于开源Chromium Gerrit的评论。该评论是指一份关于即将为Android上的谷歌Chrome浏览器实现Vulkan图形API的错误报告。该评论指出，在未来的某个时候，当“[Android]框架将开始为HWUI使用Vulkan”时，“将需要”为Android WebView提供Vulkan API支持。</p>



<hr/>


<h2 id="graphics-rendering-in-android">Android中的图形渲染</h2>
<p>作为背景知识，Skia是一个开源的2D图形引擎，用于Google Chrome、Chrome OS、Android、Flutter和其他主要项目。Skia是Android早期版本中使用的图形渲染引擎，用于渲染<a href="https://developer.android.com/reference/android/view/View">视图</a>和<a href="https://developer.android.com/reference/android/graphics/Canvas">画布</a>(这些类用于在大多数应用程序中构建和绘制UI。)Android 3.0 Honeycomb用HWUI部分取代了Skia，HWUI是一个将Canvas命令转换为硬件加速的OpenGL命令的库，尽管2D Skia图形库仍被用于路径光栅化等一些领域。与此同时，谷歌也为Skia创建了OpenGL后端。结果是，一些图形调用将被调用到Skia库，而其他的调用将被调用到OpenGL后端。为了清理图形架构，谷歌决定HWUI现在将与Skia对话，Skia本身与硬件加速的OpenGL后端对话，以进行UI渲染。结果是对UI框架的图形调用将遵循一条路径，而不是两条。</p>

<p>你们中的一些人可能记得在Android 8.0 Oreo的早期开发者预览版中有一个名为“设置GPU渲染器”的开发者选项。这个开发人员选项允许您强制HWUI使用Skia及其硬件加速的OpenGL后端作为UI框架的GPU渲染器。开发人员选项已被删除，因为此行为现在是默认行为。</p>
<div class="body-img landscape"><div class="responsive-img image-expandable img-article-item" data-img-url="https://static1.xdaimages.com/wordpress/wp-content/uploads/2018/07/Android-O-OpenGL-Skia-300x132.png" data-modal-id="single-image-modal" data-modal-container-id="single-image-modal-container" data-img-caption="&quot;\&quot;Set GPU Renderer\&quot; developer option in Android O Developer Previews&quot;">
 
<figure> <picture>  <source media="(min-width: 1024px)" sizes="1500px" data-srcset="https://static1.xdaimages.com/wordpress/wp-content/uploads/2018/07/Android-O-OpenGL-Skia-300x132.png?q=50&amp;fit=crop&amp;w=1500&amp;dpr=1.5"/> <source media="(min-width: 768px)" sizes="943px" data-srcset="https://static1.xdaimages.com/wordpress/wp-content/uploads/2018/07/Android-O-OpenGL-Skia-300x132.png?q=50&amp;fit=crop&amp;w=943&amp;dpr=1.5"/> <source media="(min-width: 481px)" sizes="767px" data-srcset="https://static1.xdaimages.com/wordpress/wp-content/uploads/2018/07/Android-O-OpenGL-Skia-300x132.png?q=50&amp;fit=crop&amp;w=767&amp;dpr=1.5"/> <source media="(min-width: 0px)" sizes="480px" data-srcset="https://static1.xdaimages.com/wordpress/wp-content/uploads/2018/07/Android-O-OpenGL-Skia-300x132.png?q=50&amp;fit=crop&amp;w=480&amp;dpr=1.5"/> <img class="lazyload" alt="Android Q Vulkan Graphics UI Rendering" data-img-url="https://static1.xdaimages.com/wordpress/wp-content/uploads/2018/07/Android-O-OpenGL-Skia-300x132.png" src="../Images/5a5a979ebac5d6fcf246160e25a095ff.png" data-original-src="https://static1.xdaimages.com/wordpress/wp-content/uploads/2018/07/Android-O-OpenGL-Skia-300x132.png"/> </picture> <figcaption class="body-img-caption">"Set GPU Renderer" developer option in Android O Developer Previews</figcaption> </figure> </div>


 </div>






<p>谷歌改善图形渲染的下一步是从OpenGL硬件加速后端切换到Vulkan硬件加速后端。这一举动一点也不出人意料，也是一个合乎逻辑的进展，但很高兴看到在Android上改进图形渲染的工作正在进行。虽然这一举措不会修复Android上的所有延迟来源，但它应该会通过减少CPU的处理来减少帧渲染时间。鉴于这是一项正在进行的工作(在Android P中尚未完成)，我们预计它将与Android Q或另一个未来的Android版本一起推出。</p>

<hr/>
<p class="ad-odd"> </p>


<h2 id="a-preview-of-using-the-vulkan-graphics-api-to-render-the-ui">使用Vulkan图形API呈现用户界面的预览</h2>
<p>现在已经可以在Android P上测试Skia的Vulkan后端了。您可以设置一个调试参数来强制Android使用Skia Vulkan管道。将下面一行添加到/system/build.prop后，只需重新启动即可:</p>

<pre> <code class="hljs ">debug.hwui.renderer=skiavk</code> </pre>




<p>在运行Android Oreo的设备上添加这行代码会导致崩溃，所以我们不建议这样做。虽然你的设备在Android P上启动时会有这个标志，但目前它还存在很多问题。谷歌Pixel Launcher大多无法呈现任何背景，设置中的动画视频无法加载，状态栏和通知也有一些图形故障。除此之外，大多数应用程序，甚至YouTube视频和像Doodle Jump这样的游戏，似乎都可以正常加载。</p>

<p>非常感谢XDA知名开发者<a href="https://forum.xda-developers.com/member.php?u=5778309"> luca020400 </a>帮助撰写本文，提供显示反汇编libhwui.so代码的截图，并提供调试标志来测试Vulkan后端。</p>

<hr/>

<p>来源1:talking ' Treble:Android工程师如何赢得碎片化战争[ <a href="https://arstechnica.com/gadgets/2018/06/talkin-treble-how-android-engineers-are-winning-the-war-on-fragmentation/3/"> ArsTechnica </a> ] </p>

<p><em>来源2: Android图形管道:从按钮到帧缓冲[ <a href="https://www.inovex.de/blog/android-graphics-pipeline-from-button-to-framebuffer-part-1/"> inovex博客</a> ] </em></p>

<p><em>来源3: Skia网页[ <a href="https://opensource.google.com/projects/skia">谷歌</a> ] </em></p>

<p><em>来源4:罗曼·盖伊的评论，Android Graphics &amp;科特林@谷歌[ <a href="https://www.reddit.com/r/androiddev/comments/4kn8sa/vulkan_support_in_android_n/d3gjfyo/"> Reddit </a> ] </em></p>

 </div>


</div>    
</body>
</html>