<html>
<head>
<title>How a graphics driver bug on the Samsung Galaxy S6 leaked Google Chrome tab data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>三星Galaxy S6的图形驱动程序漏洞如何泄露谷歌Chrome标签数据</h1>
<blockquote>原文：<a href="https://www.xda-developers.com/google-chrome-samsung-galaxy-s6-graphics-driver-bug/#0001-01-01">https://www.xda-developers.com/google-chrome-samsung-galaxy-s6-graphics-driver-bug/#0001-01-01</a></blockquote><div><div class="content-block-regular">
<p/><p>早在3月下旬，一家专门测试GPU可靠性的英国初创公司向我们提出了一个<a href="https://www.xda-developers.com/the-snapdragon-samsung-galaxy-s9-has-a-gpu-stability-bug-that-can-be-exploited-to-trigger-remote-reboots/"> GPU漏洞，他们发现</a>会导致<a href="https://www.xda-developers.com/tag/qualcomm-snapdragon-845/">高通骁龙845 </a> <a href="https://forum.xda-developers.com/galaxy-s9">三星Galaxy S9 </a> / <a href="https://forum.xda-developers.com/galaxy-s9-plus"> S9+ </a>在访问网页时重新启动。这家名为<em> <a href="https://www.graphicsfuzz.com/"> GraphicsFuzz </a> </em>的公司和我们一起向<a href="https://www.xda-developers.com/tag/qualcomm/">高通</a>和<a href="https://www.xda-developers.com/tag/samsung/">三星</a>报告了这个问题。我们的一些读者有兴趣了解像<em> GraphicsFuzz </em>这样的公司如何能够找到这些漏洞，所以我们与该公司合作，展示他们如何发现一个更老的GPU漏洞。这个已经打了补丁的漏洞允许攻击者远程“窥探”在<a href="https://forum.xda-developers.com/galaxy-s6">三星Galaxy S6 </a>上<a href="https://www.xda-developers.com/tag/google-chrome/">谷歌Chrome </a>浏览器标签的内容。</p>

  


<p/><p><em>该用户在访问恶意网页之前正在查看他们银行的网站。内容被捕获并上传到远程服务器。来源:<a href="http://www.graphicsfuzz.com/"> GraphicsFuzz </a>。</em></p>

 
<h2 id="how-graphicsfuzz-finds-gpu-bugs">GraphicsFuzz如何发现GPU bugs</h2>
<p>图形驱动程序通过获取着色器程序并将其发送到GPU来执行，从而渲染图像。在将着色器发送到GPU之前，图形驱动将其翻译成GPU可以理解的形式；错误的翻译会导致渲染失败、程序或设备崩溃、错误的图像，甚至安全问题。<em> GraphicsFuzz </em>有一个<a href="https://www.graphicsfuzz.com/howitworks.html">自动化测试套件</a>，允许他们根据一组参考着色器来找到这些bug。当用户<a href="http://www.graphicsfuzz.com/benchmark/android-v1.html">运行他们的测试</a>时，所有结果图像看起来都应该是一样的。任何看起来不同的图像意味着有一个错误。</p>



<p/><p><em>几款流行设备运行GraphicsFuzz测试套件的结果。三星Galaxy S6、三星Galaxy S7和三星Galaxy S8包含在这些图表中。来源:<a href="http://www.graphicsfuzz.com/"> GraphicsFuzz </a>。</em></p>

<p>对于三星Galaxy S6，<em> GraphicsFuzz </em>发现其中一行中的图像显示了本应在另一个表格中的图像。这意味着早期测试的图像会泄漏到后来的测试中。该团队随后在谷歌Chrome中重新运行测试套件，发现网页的部分内容出现在图像中。此外，他们发现打开另一个标签会导致图像显示其他标签的部分内容。本质上，这个bug允许一个谷歌Chrome标签泄露另一个Chrome标签的信息！<em> GraphicsFuzz </em>背后的团队并非有意寻找安全漏洞，但他们最终在测试中发现了一个漏洞。(应该指出的是，该团队在Galaxy S6和<a href="https://www.xda-developers.com/tag/firefox/"> Mozilla Firefox </a>上重现了三星浏览器的漏洞。)</p>
<p class="ad-odd"> </p>


<h2 id="how-the-bug-works">窃听器是如何工作的</h2>


<p/><p><em>用来触发三星Galaxy S6长期运行的bug的图片。来源:<a href="http://www.graphicsfuzz.com/"> GraphicsFuzz </a>。</em></p>

<p>由<em> GraphicsFuzz </em>创建的“恶意”网页使用WebGL试图在画布内绘制一个空间场景，如上图所示。每个像素的颜色由片段着色器(fragment shader)确定，片段着色器是网页提供的在GPU上执行的程序。<em> GraphicsFuzz </em>框架修改了片段着色器，这使得它运行了很长时间。当着色器运行时间过长时，浏览器或操作系统通常会中止渲染。然而，虽然GPU在绘制了几个像素后中止了渲染，但GPU驱动程序没有向谷歌Chrome报告这一点。(如果你看一看文章顶部显示垃圾视频内存的图像，你实际上可以在左上角看到太空场景的一部分。)这意味着中止之前渲染的像素保持不变，意味着最终渲染的图像大部分是垃圾视频内存。因为视频存储器被连续地用于呈现其他网页，所以“垃圾”数据实际上包含其他网页的先前呈现。因此，其他网页最终显示在“恶意”网页上。至关重要的是，WebGL允许网页捕捉正在呈现的任何内容；然后，该图像被上传到远程服务器。</p>



<p/><p><em>解释导致Chrome标签数据“泄露”的长期GPU错误的图表来源:<a href="http://www.graphicsfuzz.com/"> GraphicsFuzz </a>。</em></p>

<p>谷歌Chrome使用多个进程，因此不同的标签通常是隔离的，这使得这种利用从表面上看似乎是不可能的。然而，Chrome使用单个“GPU进程”与GPU进行交互，这意味着所有标签共享相同的GPU内存，从而允许这种利用发挥作用。上图更详细地展示了这一点。</p>

 
<p class="w-rich w-youtube" id="d3CNfMoP2t8">  </p>


<p/><p>在这段视频的前22秒中，我们演示了这个bug。还演示了GraphicsFuzz发现的其他安全问题。</p>
<p class="ad-even"> </p>


<h2 id="lessons-to-be-learned">要吸取的教训</h2>
<p>一个行为不端的GPU可以绕过谷歌Chrome和Android的所有安全措施，因为WebGL允许任何恶意网页向GPU发送代码以供执行。由于谷歌不控制硬件和驱动程序，它无法修复GPU的错误。在这种情况下，由GPU供应商(在这种情况下，ARM)来修复漏洞，其设备受到影响的OEM(在这种情况下，三星)来将修复集成到更新中。再加上运营商，很容易看到像这样的漏洞需要很长时间才能修复——大多数三星Galaxy S6用户至少花了<strong>5个月</strong>才收到补丁。</p>

<p><em> GraphicsFuzz </em>帮助GPU厂商发现难以检测的bug，比如导致错误代码在GPU上生成和执行的误编译bug。他们的自动化测试框架允许他们发现本文中展示的错误。由“恶意”网页引起的长时间循环也已被证明会在其他设备上引起问题，如<a href="https://medium.com/@afd_icl/hey-a-web-page-just-restarted-my-phone-c06d3db76542"> HTC One M7 </a>和最近的<a href="https://www.xda-developers.com/the-snapdragon-samsung-galaxy-s9-has-a-gpu-stability-bug-that-can-be-exploited-to-trigger-remote-reboots/">三星Galaxy S9 </a>。<em> GraphicsFuzz </em>测试旗舰智能手机并发布<a href="http://www.graphicsfuzz.com/#results">结果表</a>，根据这些设备在测试子集上的性能对其进行排名。<strong>在他们的测试中已经发现了数百个崩溃和渲染错误</strong>，但是大多数没有被调查，以查看它们是否构成安全威胁。然而，正如这个漏洞所示，行为不端的GPU是一个安全风险，有可能一个或多个关键的安全漏洞正在等待被发现。<em> GraphicsFuzz </em>希望GPU厂商未来优先提高驱动质量。</p>



<p/><p><em>显卡驱动程序的相对可靠性，按问题总数排序。来源:<a href="http://www.graphicsfuzz.com/#results"> GraphicsFuzz </a>。</em></p>
<p class="ad-odd"> </p>


<h2 id="disclosure-timeline">披露时间表</h2>
<ul> <li>2016年12月，<em> GraphicsFuzz </em>向<a href="https://bugs.chromium.org/p/chromium/issues/detail?id=675658#c39">谷歌Chromium bug追踪器</a>报告了这个bug，因为它符合Chrome奖励计划的条件。GraphicsFuzz将该bug提交给谷歌Chromium bug tracker后，该bug被谷歌接受，并转发给ARM和三星打补丁。</li> <li>谷歌<a href="https://bugs.chromium.org/p/chromium/issues/detail?id=675658#c7">将报告</a>转发给ARM和三星的联系人。</li> <li>三星默默地修补了这个漏洞，并在2017年3月至6月发布的Android 7.0牛轧糖更新中推出了修复程序。虽然没有三星、谷歌或ARM创建的CVE，三星和ARM也没有发布任何关于该补丁的信息，但请注意<em> GraphicsFuzz </em>没有通过<a href="https://security.samsungmobile.com/securityReporting.smsb">适当的流程</a>报告该错误。</li> <li>后来，<em> GraphicsFuzz </em>能够确认三星和ARM都看到了该报告，并且ARM能够根据该报告修复该问题。</li> <li>2017年8月，<em> GraphicsFuzz </em>因漏洞报告被谷歌奖励2000美元。</li> <li>2017年11月，<a href="https://bugs.chromium.org/p/chromium/issues/detail?id=675658#c39">bug报告公开</a>。</li> </ul>
</div>


</div>    
</body>
</html>