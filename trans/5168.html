<html>
<head>
<title>Android Pie adds feature to prevent killing RAM-heavy games if you accidentally exit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Android Pie增加了一个功能，可以防止意外退出时杀死大量内存的游戏</h1>
<blockquote>原文：<a href="https://www.xda-developers.com/android-pie-ram-heavy-games-exit/#0001-01-01">https://www.xda-developers.com/android-pie-ram-heavy-games-exit/#0001-01-01</a></blockquote><div><div class="content-block-regular">
<p/><p>今天早些时候，谷歌<a href="https://www.xda-developers.com/android-pie-google-pixel-google-pixel-2/">正式宣布了谷歌Pixel和谷歌Pixel 2的</a> Android Pie。紧接着，<a href="https://www.xda-developers.com/essential-phone-android-pie-android-9/"> Essential发布了</a>Essential手机的Android 9更新。<a href="https://www.xda-developers.com/android-p-beta-program-is-now-available/">其他参与了</a>Android P beta计划的设备应该很快就会收到更新，所以跳过开发者预览版的用户现在有很多事情要做。随着我们深入研究最新版本，包括AOSP 上的<a href="https://www.xda-developers.com/android-pie-source-code-aosp/">源代码和最新的兼容性定义文档(CDD)，我们将定期向您更新我们发现的任何新信息。我们在CDD中发现了一个有趣的现象，那就是有一个“重量级”(RAM-heavy)应用和游戏区，如果用户意外退出，Android Pie会优先将这些应用保存在RAM中。</a></p>

 
<h2 id="heavyweight-apps-and-games-in-android-pie">安卓派中的“重量级”应用和游戏</h2>
<p>在<a href="https://source.android.com/compatibility/cdd"> CDD </a>中增加了一个新的章节来概述这一特性。它是这样说的:</p>

<section class="emaki-custom-block emaki-custom-note"><div class="emaki-custom note" id="custom_block_3"><h3 id="3-17-heavyweight-apps">3.17.重量级应用</h3><p>如果设备实现声明了特征FEATURE_CANT_SAVE_STATE，那么它们:</p><ul> <li>[C-1-1]一次只能安装一个指定cantSaveState的应用程序在系统中运行。如果用户在没有明确退出的情况下离开这样的应用程序(例如，通过在离开系统的活动时按home，而不是在系统中没有剩余活动的情况下按back)，则设备实现必须在RAM中优先考虑该应用程序，就像它们为预期将保持运行的其他事情所做的那样，例如前台服务。虽然这样的应用程序在后台，但系统仍然可以对其应用电源管理功能，例如限制CPU和网络访问。</li> <li>[C-1-2]必须提供一个UI启示，以便在用户启动另一个声明了cantSaveState属性的应用时，选择不参与正常状态保存/恢复机制的应用。</li> <li>[C-1-3]不得将策略中的其他更改应用于指定cantSaveState的应用，如更改CPU性能或更改调度优先级。</li> </ul><p>如果设备实现没有声明特性<span>FEATURE _ CANT _ SAVE _ STATE</span><span>，那么它们:</span></p><ul> <li>[C-1-1]必须忽略apps设置的cantSaveState属性，并且不得基于该属性更改appbehavior。</li> </ul> </div></section>
<p>基本上，这意味着，如果一个设备支持<a href="https://developer.android.com/reference/android/content/pm/PackageManager#FEATURE_CANT_SAVE_STATE"> FEATURE_CANT_SAVE_STATE </a>功能，那么他们必须优先在RAM中保留指定<a href="https://developer.android.com/reference/android/R.attr#cantSaveState"> cantSaveState </a>属性的运行应用。如果用户通过按下home按钮退出应用程序或游戏，或者在没有明确退出的情况下离开应用程序或游戏(如按下back按钮或quit按钮),则RAM优先化开始。)此外，系统仍然可以通过限制这些应用程序的CPU和网络访问来节省电力，但除非必要，否则他们无法通过杀死它们来释放RAM。最后，请注意，只允许运行一个定义了cantSaveState属性的应用程序。如果你试图在另一个应用程序运行时启动另一个定义了该属性的应用程序，Android Pie会要求你选择你想要继续运行的游戏。</p>

 



<p>您可以通过ADB运行以下两个命令来检查您的设备是否支持FEATURE_CANT_SAVE_STATE:</p>

<pre> <code class="hljs java">adb shell<br/>dumpsys <span class="hljs-keyword">package</span> | grep <span class="hljs-string">"cant_save_state"</span></code> </pre>
<p>要检查应用程序是否指定了cantSaveState属性，需要反编译应用程序并查看其清单，或者在ADB shell中使用<code>dumpsys package package.name.here</code>命令。请记住，这个属性只是刚刚在API level 28 (Android 9 Pie)中添加的，所以还不太可能有很多应用程序或游戏会利用这一点。</p>

<p>这项功能对于内存容量小的设备和/或消耗大量内存的应用程序来说非常有用。例如，安卓系统上的堡垒之夜移动<a href="https://www.xda-developers.com/minimum-requirements-fortnite-mobile-on-android/">需要至少3gb的内存</a>，因为它消耗了大量的内存(甚至没有启动游戏，堡垒之夜移动就在我的谷歌Pixel 2 XL上保留了1.6GBs的内存。)如果堡垒之夜的目标是SDK level 28并使用该功能，那么这意味着如果你的设备空闲内存不足，意外退出游戏将有望防止它立即被杀死。不幸的是，堡垒之夜<a href="https://www.xda-developers.com/fortnite-mobile-on-android-samsung-galaxy-note-9-exclusive/">目前只针对SDK级</a>(Android 5.0 Lollipop)，所以它没有利用谷歌在Android Pie中提供的最新API，更不用说Android奥利奥、Android牛轧糖或Android棉花糖了。希望其他游戏也能利用这一特性。明年，谷歌<a href="https://www.xda-developers.com/developers-new-app-play-store-api-level-26/">将要求他们</a>更新，如果他们想继续在谷歌Play商店上提交更新的话。</p>

 </div>


</div>    
</body>
</html>