<html>
<head>
<title>How Substratum Brought More Choice to an Inflexible TouchWiz</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>底层如何给不灵活的TouchWiz带来更多选择</h1>
<blockquote>原文：<a href="https://www.xda-developers.com/sungstratum-samsung-substratum-touchwiz/#0001-01-01">https://www.xda-developers.com/sungstratum-samsung-substratum-touchwiz/#0001-01-01</a></blockquote><div><div class="content-block-regular">
<p/><p>Android主题化已经走过了漫长的道路，从粗糙的编辑到底层，再到现在的<strong> Sungstratum </strong>。几年前，Android讨论中的“主题”一词经常被“选择器”一词取代，这是对CyanogenMod中T-Mobile主题选择器的认可，它奠定了Android成为主题天堂的基础。修改操作系统外观的能力为用户提供了另一个定制维度，允许他们做出改变，使他们的设备更加个性化。</p>

  
<p>良好的工作继续在两个不同的方向。主题选择器演变成了CyanogenMod主题引擎，但是尽管在主题资源上投入了多年的努力，当其他选择出现时，CMTE变得过时了。</p>

<hr/>

<p><strong> RRO &amp;图层</strong></p>

<p>当索尼的代码贡献以称为<strong> <a href="https://developer.sonymobile.com/2014/04/22/sony-contributes-runtime-resource-overlay-framework-to-android-code-example/">运行时资源覆盖(RRO) </a> </strong>的新框架的形式被AOSP接受时，替代方案之一的基础就奠定了。这个框架提供了在运行时替换应用程序资源的能力(因此得名)。“覆盖层”本身早在Gingerbread(可能更早)就已经出现并在Android中得到支持，主要用于交换资源，使应用程序在特定设备上工作。索尼的RRO方法包括修改资产管理器以接受apk，apk使用映射到设备上其他相应资源的资源。来自apk的这些新资源仅在运行时覆盖在基础资源之上，允许系统继续工作，就好像这些新资源一直是它的一部分一样。</p>

<p>在Lollipop 5.0公开之前，RRO框架被合并到AOSP中，但是由于其他变化，5.0的最初几个版本的部分框架被破坏了。Android 6.0 Marshmallow的开发者预览版首次加入了一个功能虽然有限的RRO框架，打开了可定制性的大门。因此，除非原始设备制造商故意试图偏离现有的Android主题选项，否则在Android中如何实现“主题”的方法可以保持一定程度的一致性。</p>

<p>当AOSP在玩弄RRO并寻找整合这一切的最佳方式时，一个名为<strong> BitSyko </strong>的开发团队正在共同努力，名为“<strong>层</strong>”。层扩展了Android 5.1 Lollipop中的stock RRO功能，实现了更复杂的资源切换，并允许比stock RRO更多的主题元素控制。因为图层是建立在RRO之上的，ROM制作者需要添加额外的代码来启用他们的ROM中的图层功能，因为不是所有的图层主题都可以在棉花糖中的普通RRO上工作。</p>

<p>与此同时，索尼继续努力实现Android主题化。它开始致力于<strong> OMS(覆盖管理服务)</strong>，这是一个管理覆盖的客户端，允许提供商动态控制优先级，启用和禁用覆盖。<span> OMS正被并入AOSP，并将进入Android O </span>。XDA公认的开发者<a href="https://forum.xda-developers.com/member.php?u=3605033"> nicholaschum </a>能够通过他的消息来源证实Android O将会展示“动态覆盖”，这被认为是参考了OMS。</p>

<p>OMS引起了与层的冲突，因为传统上，这样的功能是在主题的控制之下。为了处理OMS提出的问题以及扩展层的功能，BitSyko再次合作(并将他们自己重新命名为<strong> [projekt。] </strong>)创建<strong>底层</strong>。<a href="https://www.xda-developers.com/layers-manager-is-being-deprecated-in-favor-of-substratum/"> Substratum是一个具有OMS功能的客户端</a>，它试图将图层功能与OMS相协调，并且还借用了其他过去主题化解决方案中的其他元素。覆盖图不再像现在一样相互重叠以主题化单个元素，所有需要的元素都被注入到一个单独的覆盖图中。像在设备上编译这样的特性允许应用主题而不需要在两次修改之间重启，这使得最终用户尝试主题变得更加容易。Substratum自问世以来一直在积极开发中，列出它的所有特性和增加的功能超出了本文的范围，所以我们将转移到本文的真正主题。</p>

<hr/>


<h2 id="substratum-into-sungstratum">底层进入太阳层</h2>
<p>如前一节所述，底层最初是作为扩展库存OMS功能和库存RRO功能的一种方式(通过层)。Substratum旨在与基于AOSP的rom一起使用，因为大多数其他原始设备制造商会做出相互冲突的更改，不允许Substratum与他们在编辑过的UX皮肤(如三星的皮肤)上的修改共存。</p>

 
<p class="w-rich w-youtube" id="ay1a6sofa0M">  </p>


<p>三星自己也在开发一个主题化解决方案，用于Nougat上自己的设备。与索尼不同的是，三星没有表现出将主题代码回馈给AOSP的兴趣。但是由于三星的解决方案相当简单，AOSP并没有损失太多。三星Touchwiz中的主题化解决方案在三星Galaxy S6上真正出现，但正如前面提到的，它在尝试实现什么方面受到了相当大的限制。在此之前，从Galaxy Alpha开始的试验是有限的，尽管大多数系统UI元素都超出了它的范围。例如，主题可以改变壁纸和图标，以及一些三星股票应用程序，如拨号器、联系人、信息和通知区域。</p>

<p>事实证明，三星的主题引擎<em>扩展了在AOSP发现的</em> RRO。三星在扩展RRO后也重新创建了他们自己的OMS内部版本，因此他们对RRO和OMS的实现都不同于AOSP。但令人惊讶的是，数量并不多——考虑到Touchwiz的独特性和复杂性，这是一种反常的行为。使用较新的三星旗舰的主题用户报告说，他们可以安装RRO覆盖，并让他们主题第三方应用程序。</p>

<p>这是团队[项目]的提示。]需要研究在底层上官方支持三星设备。该团队从他们的应用程序的RRO/Legacy部分转换了少量代码，但他们没有请求root并要求重新启动，而是激发了特定的意图，以便安装覆盖层。然后，该团队努力确保受主题影响的应用程序在后台被强制关闭，以确保在下一次发布时进行全面的资产刷新。</p>

<p>我们请XDA知名开发人员nicholaschum向我们介绍了该团队在对抗三星RRO-OMS的闭源实现时所面临的挑战:</p>

<p/><p>我们所面临的挑战是相当模糊的，许多不了解主题化系统的人都不知道，不管是开源的还是闭源的——每件事都有它自己的试错阶段。在这种情况下，与三星合作，我偶然发现了许多问题，但主要的一个问题是系统意图在安装完成后不会被触发覆盖-例如利用带有“Android . intent . action . package _ ADDED”的广播接收器-主题服务拒绝任何不属于特定三星主题服务权限的系统签名的内容，因此最困难的部分是我们必须找到一种解决方法。</p>

<p/><p>我们使用Substratum和三星主题引擎的方式是利用和他们一样的系统。他们使用索尼的资源运行时覆盖系统的高度修改版本，缩写为RRO或在Substratum用户中称为legacy。然而，不同的是，三星主题有一个额外的权限，从设置中隐藏这些覆盖，所以你不能手动卸载它们。我们使用相同的系统，但是我们利用AOSP/索尼的实现，这就是为什么三星主题可以完全主题化框架，而底层覆盖不能触及不存在的中介目标“fwk”-正如我们都知道框架只是“android”包名。</p>

<p>似乎很奇怪。]能够相对轻松地与三星的RRO实现一起工作。任何曾经在三星设备上工作过的人都可以证明三星制造产品有多困难。我们询问了该团队在停靠期间遇到的任何具体障碍:</p>

<p/><p>确实有某种安全机制影响了一些用户——覆盖在启动时恢复。这是由于三星启动设备的方式。由于我们大多都在7.0的TouchWiz/Samsung体验上，我们使用了一种新的“优化应用程序”的方法(当你更新你的手机时，你可以看到这一点，它会显示一个带有Android Nougat图标的通知，说它正在后台升级)，所以这种优化应用程序的方式也会卸载目标包，最终会中断启动时的idmapping过程(由于目标包不存在)，因此，一些人在重启后会遇到覆盖卸载。</p>

<p/><p>你也可以在三星的一些主题中看到这种情况，尤其是@envy~，他将默认的导航条颜色设置为黑色，而实际的默认颜色是白色。设置为黑色后，您可以打开键盘，导航条保持黑色。这将在重启时随机恢复，在许多设备上也是如此。</p>

<p>随着主题化重新得到重视，Substratum在像Sungstratum这样的分支上有什么计划？</p>

<p/><p>在未来的道路上，我们将为我们当前的用户合并一个小应用程序到我们的插件中，这样如果他们设备上安装的所有主题都是从XDA安装的，他们将能够停止三星主题服务。所以那些将使用三星主题格式的XDA主题的人，你将能够使用插件来阻止三星的服务在每次重启后将其恢复到股票主题(因为它不是从三星商店正式安装的)。它将需要一个免费的三星开发者密钥，可以从他们的网站上获得，但它将与sungstratum插件下载预先捆绑在一起。</p>





<hr/>

<p>随着AOSP和Android O最近和即将发生的变化，看起来谷歌曾经羽翼未丰的操作系统将有更多的个性化传递给用户。某些原始设备制造商甚至计划放弃他们的定制用户界面和UX插件，转而支持AOSP，而三星等其他公司也有自己的主题解决方案。我们设想在未来，主题将在更多人的用户体验中扮演重要角色——在这样的操作系统中，你可以真正控制你的设备的外观，你可以为自己量身定制用户界面美学。如果没有这个令人敬畏的社区的集体力量和Substratum这样的项目，我们就无法实现这样的未来。</p>

<hr/>

<p>在我们的底层论坛中查看三星牛轧糖的底层整合！<a href="https://github.com/substratum"><strong>GitHub上的底层</strong> </a></p>

 </div>


</div>    
</body>
</html>