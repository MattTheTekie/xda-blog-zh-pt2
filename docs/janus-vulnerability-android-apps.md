# 骏利漏洞利用让攻击者在不影响签名的情况下修改应用

> 原文：<https://www.xda-developers.com/janus-vulnerability-android-apps/>

Android 安装在数量庞大的设备上，这使得它成为恶意攻击者的目标。谷歌移动操作系统中的漏洞每个月都会被发现，但好消息是谷歌通常会在定期的安全补丁中努力修复这些漏洞，然后提供给原始设备制造商，原始设备制造商再将其发送到设备上。

最近，安全研究人员发现了一个漏洞[，它欺骗用户允许攻击者记录他们设备的屏幕](https://www.xda-developers.com/android-screen-recording-vulnerability/)。Android Oreo 修复了这个漏洞，但 *GuardSquare* 的分析师最近报告了另一个严重的漏洞，该漏洞会影响由旧签名方案签名的 Android 应用程序。

*GuardSquare* 的报告称，Android 中的**杰纳斯** **漏洞** (CVE-2017-13156)允许攻击者在不影响其签名的情况下修改应用程序中的代码。该报告接着说，漏洞的根源是一个文件可以同时是一个有效的 APK 文件和一个有效的 DEX 文件。

骏利利用了额外的字节在 APK 文件和 DEX 文件中不被注意的事实。GuardSquare 报告解释说，APK 文件是一个 ZIP 存档文件，它可以在 ZIP 条目的开始、之前和之间包含任意字节。JAR 签名方案只考虑 ZIP 条目，在计算或验证应用程序的签名时忽略任何额外的字节。

它继续解释说，另一方面，DEX 文件可以在末尾包含任意字节——在字符串、类、方法定义等常规部分之后。因此，一个文件可以同时是有效的 APK 文件和有效的 DEX 文件。

*GuardSquare* 还提到，该漏洞的一个关键要素是 Dalvik/ART 虚拟机的一个“无害”特性。该报告指出，理论上，Android 运行时加载 APK 文件，提取其 DEX 文件，然后运行其代码。然而，在实践中，虚拟机(VM)可以加载和执行 APK 文件和 DEX 文件。问题是当 VM 得到一个 APK 文件时，它仍然查看文件头中的神奇字节来决定它是哪种类型的文件:DEX 还是 APK。在找到一个 DEX 头时，它将文件作为一个 DEX 文件加载。如果找不到文件头，它会将文件作为一个 APK 文件加载，该文件包含一个带有 DEX 文件的 zip 条目。**因此，它可以曲解双 DEX/APK 文件。**

GuardSquare 表示，攻击者可以利用虚拟机的这种二元性特征，将恶意的 DEX 文件添加到正常的 APK 文件中，而不会影响其签名。Android 运行时将接受 APK 文件作为合法的早期应用版本的有效更新，但 Dalvik VM 将从 DEX 文件加载代码，该文件已被注入恶意代码。

通常，每当用户安装应用程序的更新版本时，Android 运行时都会验证应用程序的签名，以确保它与旧版本相匹配。当验证是肯定的时，更新的应用程序获得已经授予原始应用程序的权限。通过这种方式，攻击者可以利用 Janus 漏洞绕过签名验证过程，并在不知情的用户的设备上安装未经验证的代码。

更糟糕的是，这些未经验证的代码可能会获得强大的权限。这导致了一些严重的可能性。 *GuardSquare* 声明:

> #### “攻击者可以通过修改更新来替换具有高权限的可信应用程序(例如，系统应用程序)，从而滥用其权限。根据目标应用程序，这可能使黑客能够访问存储在设备上的敏感信息，甚至完全接管设备。或者，攻击者可以将敏感应用程序的修改过的克隆作为合法更新传递,[它]可以像原始应用程序一样外观和行为，但会注入恶意行为。”

该公司补充说，截至目前，他们还没有看到任何应用程序利用骏利在野外。另一个好消息是，该漏洞需要用户从谷歌 Play 商店以外的来源安装恶意更新。因此，限制应用程序安装到 Play Store 的用户受到保护。

Janus 漏洞会影响运行 Android 5.0+的设备。用 APK 签名方案 v1 签名的应用程序会受到影响。利用签名方案 v2 签名的 apk 被保护免受漏洞的影响。这要求 apk 在支持最新签名方案(Android 7.0 和更新版本)的设备上运行。方案 v2 受到保护，因为与方案 v1 不同，它考虑 APK 文件中的所有字节。

“旧设备上运行的旧版本应用程序和新应用程序仍然容易受到影响。开发人员至少应该始终应用签名方案 v2，" *GuardSquare* 声明。

*GuardSquare* 于 2017 年 7 月 31 日向谷歌报告了这一问题，并于当天收到了确认。该公司的报告称，谷歌于 11 月向其合作伙伴发布了一个补丁，并于 2017 年 12 月 4 日在 Android 安全公告中公布了该漏洞(CVE-2017-13156)。该漏洞已在 2017 年 12 月的安卓安全补丁中**修复。另外，来自官方资料库的 F-Droid 应用程序已经被确认是安全的。最后，已经确认漏洞已经在 [APKMirror](http://apkmirror.com) 上打了补丁。**

* * *

[**来源:警卫广场**](https://www.guardsquare.com/en/blog/new-android-vulnerability-allows-attackers-modify-apps-without-affecting-their-signatures)