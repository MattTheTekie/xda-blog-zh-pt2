# 谷歌的远程密钥供应将在 Android 13 中强制执行:这对你意味着什么

> 原文：<https://www.xda-developers.com/google-remote-key-provisioning/>

Android 的密钥认证是我们智能手机上许多可信服务的支柱，包括安全网、数字车钥匙和[身份凭证 API](https://www.xda-developers.com/android-13-hardware-drivers-licenses/) 。自 Android 8 Oreo 以来，它就被要求作为 Android 的一部分，并且依赖于工厂设备上安装的根密钥。这些密钥的提供需要制造商方面的极度保密，并且如果密钥被泄露，那么这将意味着该密钥将需要被撤销。这将导致消费者无法使用任何这些受信任的服务，如果存在可以暴露它的漏洞，这将是不幸的。远程密钥供应将在 [Android 13](https://www.xda-developers.com/android-13) 中强制实施，旨在解决这个问题。

## Android 上构成当前信任链的组件

在解释新系统如何工作之前，重要的是提供关于旧系统如何工作的背景。现在很多手机使用硬件支持的密钥认证，你可能很熟悉这种技术，它是任何安全网旁路的致命一击。对于密钥证明的当前状态，有几个重要的概念需要理解。

正是这些概念的结合确保了开发者能够相信设备没有被篡改，并且能够处理 TEE 中的敏感信息。

### 可信执行环境

可信执行环境(TEE)是 SoC 上用于处理关键数据的安全区域。TEE 在搭载 Android 8 Oreo 及更高版本的设备上是强制性的，这意味着任何最近的智能手机都有它。任何不在 TEE 内的内容都被认为是“不可信的”,只能看到加密的内容。例如，受 DRM 保护的内容是用密钥加密的，只有在 TEE 上运行的软件才能访问这些密钥。主处理器只能看到加密内容流，而内容可以由 TEE 解密，然后显示给用户。

### ARM 信任区

Trusty 是一个安全的操作系统，它在 Android 上提供了一个 TEE，在 ARM 系统上，它利用了 ARM 的 Trustzone。Trusty 与主操作系统在同一处理器上执行，可以使用设备的全部功能，但与手机的其他部分完全隔离。Trusty 由以下部分组成:

*   从[小内核](https://android.googlesource.com/trusty/lk/common/)衍生出来的一个小 OS 内核
*   在安全环境和 Android 之间传输数据的 Linux 内核驱动程序
*   一个 Android 用户空间库，通过内核驱动程序与可信应用程序(即安全任务/服务)进行通信

它相对于专有 TEE 系统的优势在于，这些 TEE 系统可能会很昂贵，并且还会在 Android 生态系统中造成不稳定。Trusty 由 Google 免费提供给合作伙伴 OEM，并且是开源的。Android 支持其他 TEE 系统，但 Trusty 是谷歌推得最多的一个。

### 保险箱

StrongBox 设备是完全独立的、专门构建的、经过认证的安全 CPU。这些可以包括嵌入式安全元件(ese)或片上安全处理单元(SPU)。谷歌表示，目前“强烈建议”搭载 [Android 12](https://xda-developers.com/android-12) 的设备配备 StrongBox(根据兼容性定义文件)，因为它很可能成为未来 Android 版本的一项要求。它本质上是硬件支持的密钥库的更严格的实现，可以与 TrustZone 一起实现。StrongBox 的一个实现示例是 Pixel 智能手机中的 Titan M 芯片。没有多少手机使用 StrongBox，大多数使用 ARM 的 Trustzone。

### 钥匙大师 TA

Keymaster 可信应用程序(TA)是管理和执行所有密钥库操作的安全密钥管理器。例如，它可以在 ARM 的 TrustZone 上运行。

## Android 12 和 Android 13 中的密钥认证有何变化

如果一个密钥暴露在 Android 智能手机上，谷歌需要撤销它。这对任何在工厂注入密钥的设备来说都是一个问题——任何泄露密钥的行为都意味着用户将无法访问某些受保护的内容。这甚至可能包括撤销许多人依赖的 Google Pay 等服务的访问权限。这对消费者来说是不幸的，因为如果没有制造商修理你的手机，你就没有办法自己修理。

进入远程密钥设置。从 Android 12 开始，谷歌正在用工厂内公钥提取和带有短期证书的无线证书供应的组合来取代工厂内私钥供应。Android 13 将需要这个方案，它有几个好处。首先，它防止 OEM 和 ODM 需要管理工厂中的密钥保密。其次，它允许设备在密钥泄露时被恢复，这意味着消费者不会永远失去对受保护服务的访问。现在，每次使用需要证明的服务时，谷歌都会请求一个临时证书，而不是使用由设备上的密钥计算的证书，该密钥可能会通过漏洞泄露。

至于它是如何工作的，很简单。每个设备都会生成一个唯一的静态密钥对，该密钥对的公共部分由 OEM 在他们的工厂中提取并提交给 Google 的服务器。在那里，它们将作为以后资源调配的信任基础。私钥永远不会离开生成它的安全环境。

当设备首次用于连接到互联网时，它将为自己生成的密钥生成证书签名请求，并使用与工厂中收集的公钥相对应的私钥对其进行签名。谷歌的后端服务器将验证请求的真实性，然后签署公钥，返回证书链。然后，设备上的密钥库将存储这些证书链，并在请求认证时将它们分配给应用程序。这可以是从 Google Pay 到 Pokemon Go 的任何东西。

这个确切的证书请求链将在证书过期或当前密钥耗尽时定期发生。每个应用程序接收不同的证明密钥，并且密钥本身定期轮换，这两者都确保了隐私。此外，谷歌的后端服务器是分段的，因此验证设备公钥的服务器看不到附加的证明密钥。这意味着谷歌不可能将证明密钥与请求它们的特定设备相关联。

根据谷歌的说法，最终用户不会注意到任何变化，尽管开发者需要注意以下几点。

*   证书链结构
    *   由于我们新的在线资源调配基础架构的性质，链的长度比以前更长，并且可能会发生变化。
*   信任的根源
    *   信任根最终将从当前的 RSA 密钥更新为 ECDSA 密钥。
*   RSA 证明反对
    *   所有由 KeyMint 生成和证明的密钥都将使用 ECDSA 密钥和相应的证书链进行签名。以前，非对称密钥由其相应的算法签名。
*   短期证书和证明密钥
    *   配置给设备的证书通常在过期和轮换前的两个月内有效。

我们联系了谷歌，询问这是否与 Widevine DRM 有关，以及一些 Pixel 用户如何报告他们的 DRM 级别因锁定的引导加载程序而降级。我们还询问这是否可以通过 Google Play 服务作为 OTA 升级分发给用户。如果我们收到回复，一定会更新这篇文章。目前还不清楚当前信任链的哪些部分会受到影响，或者以何种方式受到影响。

* * *

**来源:** [谷歌](https://android-developers.googleblog.com/2022/03/upgrading-android-attestation-remote.html)