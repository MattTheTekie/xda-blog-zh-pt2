<html>
<head>
<title>Google's Remote Key Provisioning will be mandated in Android 13: What that means for you</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>谷歌的远程密钥供应将在Android 13中强制执行:这对你意味着什么</h1>
<blockquote>原文：<a href="https://www.xda-developers.com/google-remote-key-provisioning/#0001-01-01">https://www.xda-developers.com/google-remote-key-provisioning/#0001-01-01</a></blockquote><div><div class="content-block-regular">
<p>Android的密钥认证是我们智能手机上许多可信服务的支柱，包括安全网、数字车钥匙和<a href="https://www.xda-developers.com/android-13-hardware-drivers-licenses/">身份凭证API </a>。自Android 8 Oreo以来，它就被要求作为Android的一部分，并且依赖于工厂设备上安装的根密钥。这些密钥的提供需要制造商方面的极度保密，并且如果密钥被泄露，那么这将意味着该密钥将需要被撤销。这将导致消费者无法使用任何这些受信任的服务，如果存在可以暴露它的漏洞，这将是不幸的。远程密钥供应将在<a href="https://www.xda-developers.com/android-13"> Android 13 </a>中强制实施，旨在解决这个问题。</p>

 
<h2 id="the-components-making-up-the-current-chain-of-trust-on-android">Android上构成当前信任链的组件</h2>
<p>在解释新系统如何工作之前，重要的是提供关于旧系统如何工作的背景。现在很多手机使用硬件支持的密钥认证，你可能很熟悉这种技术，它是任何安全网旁路的致命一击。对于密钥证明的当前状态，有几个重要的概念需要理解。</p>

<p>正是这些概念的结合确保了开发者能够相信设备没有被篡改，并且能够处理TEE中的敏感信息。</p>

<h3 id="trusted-execution-environment">可信执行环境</h3>
<p>可信执行环境(TEE)是SoC上用于处理关键数据的安全区域。TEE在搭载Android 8 Oreo及更高版本的设备上是强制性的，这意味着任何最近的智能手机都有它。任何不在TEE内的内容都被认为是“不可信的”,只能看到加密的内容。例如，受DRM保护的内容是用密钥加密的，只有在TEE上运行的软件才能访问这些密钥。主处理器只能看到加密内容流，而内容可以由TEE解密，然后显示给用户。</p>

<h3 id="arm-trustzone">ARM信任区</h3>


<p>Trusty是一个安全的操作系统，它在Android上提供了一个TEE，在ARM系统上，它利用了ARM的Trustzone。Trusty与主操作系统在同一处理器上执行，可以使用设备的全部功能，但与手机的其他部分完全隔离。Trusty由以下部分组成:</p>

<ul> <li>从<a href="https://android.googlesource.com/trusty/lk/common/">小内核</a>衍生出来的一个小OS内核</li> <li>在安全环境和Android之间传输数据的Linux内核驱动程序</li> <li>一个Android用户空间库，通过内核驱动程序与可信应用程序(即安全任务/服务)进行通信</li> </ul>

<p>它相对于专有TEE系统的优势在于，这些TEE系统可能会很昂贵，并且还会在Android生态系统中造成不稳定。Trusty由Google免费提供给合作伙伴OEM，并且是开源的。Android支持其他TEE系统，但Trusty是谷歌推得最多的一个。</p>

<h3 id="strongbox">保险箱</h3>
<p>StrongBox设备是完全独立的、专门构建的、经过认证的安全CPU。这些可以包括嵌入式安全元件(ese)或片上安全处理单元(SPU)。谷歌表示，目前“强烈建议”搭载<a href="https://xda-developers.com/android-12"> Android 12 </a>的设备配备StrongBox(根据兼容性定义文件)，因为它很可能成为未来Android版本的一项要求。它本质上是硬件支持的密钥库的更严格的实现，可以与TrustZone一起实现。StrongBox的一个实现示例是Pixel智能手机中的Titan M芯片。没有多少手机使用StrongBox，大多数使用ARM的Trustzone。</p>

<h3 id="keymaster-ta">钥匙大师TA</h3>
<p>Keymaster可信应用程序(TA)是管理和执行所有密钥库操作的安全密钥管理器。例如，它可以在ARM的TrustZone上运行。</p>
<p class="ad-odd"> </p>


<h2 id="how-key-attestation-is-changing-with-android-12-and-android-13">Android 12和Android 13中的密钥认证有何变化</h2>
<p>如果一个密钥暴露在Android智能手机上，谷歌需要撤销它。这对任何在工厂注入密钥的设备来说都是一个问题——任何泄露密钥的行为都意味着用户将无法访问某些受保护的内容。这甚至可能包括撤销许多人依赖的Google Pay等服务的访问权限。这对消费者来说是不幸的，因为如果没有制造商修理你的手机，你就没有办法自己修理。</p>

<p>进入远程密钥设置。从Android 12开始，谷歌正在用工厂内公钥提取和带有短期证书的无线证书供应的组合来取代工厂内私钥供应。Android 13将需要这个方案，它有几个好处。首先，它防止OEM和ODM需要管理工厂中的密钥保密。其次，它允许设备在密钥泄露时被恢复，这意味着消费者不会永远失去对受保护服务的访问。现在，每次使用需要证明的服务时，谷歌都会请求一个临时证书，而不是使用由设备上的密钥计算的证书，该密钥可能会通过漏洞泄露。</p>



<p>至于它是如何工作的，很简单。每个设备都会生成一个唯一的静态密钥对，该密钥对的公共部分由OEM在他们的工厂中提取并提交给Google的服务器。在那里，它们将作为以后资源调配的信任基础。私钥永远不会离开生成它的安全环境。</p>

<p>当设备首次用于连接到互联网时，它将为自己生成的密钥生成证书签名请求，并使用与工厂中收集的公钥相对应的私钥对其进行签名。谷歌的后端服务器将验证请求的真实性，然后签署公钥，返回证书链。然后，设备上的密钥库将存储这些证书链，并在请求认证时将它们分配给应用程序。这可以是从Google Pay到Pokemon Go的任何东西。</p>

<p>这个确切的证书请求链将在证书过期或当前密钥耗尽时定期发生。每个应用程序接收不同的证明密钥，并且密钥本身定期轮换，这两者都确保了隐私。此外，谷歌的后端服务器是分段的，因此验证设备公钥的服务器看不到附加的证明密钥。这意味着谷歌不可能将证明密钥与请求它们的特定设备相关联。</p>

<p>根据谷歌的说法，最终用户不会注意到任何变化，尽管开发者需要注意以下几点。</p>

<ul> <li>证书链结构<ul> <li>由于我们新的在线资源调配基础架构的性质，链的长度比以前更长，并且可能会发生变化。</li> </ul> </li> <li>信任的根源<ul> <li>信任根最终将从当前的RSA密钥更新为ECDSA密钥。</li> </ul> </li> <li>RSA证明反对<ul> <li>所有由KeyMint生成和证明的密钥都将使用ECDSA密钥和相应的证书链进行签名。以前，非对称密钥由其相应的算法签名。</li> </ul> </li> <li>短期证书和证明密钥<ul> <li>配置给设备的证书通常在过期和轮换前的两个月内有效。</li> </ul> </li> </ul>

<p>我们联系了谷歌，询问这是否与Widevine DRM有关，以及一些Pixel用户如何报告他们的DRM级别因锁定的引导加载程序而降级。我们还询问这是否可以通过Google Play服务作为OTA升级分发给用户。如果我们收到回复，一定会更新这篇文章。目前还不清楚当前信任链的哪些部分会受到影响，或者以何种方式受到影响。</p>

<hr/>

<p><strong>来源:</strong> <a href="https://android-developers.googleblog.com/2022/03/upgrading-android-attestation-remote.html">谷歌</a></p>

 </div>


</div>    
</body>
</html>