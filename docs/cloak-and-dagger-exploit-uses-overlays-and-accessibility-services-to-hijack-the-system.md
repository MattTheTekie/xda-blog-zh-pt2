# 斗篷和匕首利用覆盖和可访问性服务劫持系统

> 原文：<https://www.xda-developers.com/cloak-and-dagger-exploit-uses-overlays-and-accessibility-services-to-hijack-the-system/>

我们 XDA 曾经设想的安全漏洞概念验证现在已经被佐治亚理工学院的计算机科学家证实了。该团队详细介绍了他们所谓的“ [**斗篷和匕首**](http://cloak-and-dagger.org/) ”漏洞，这些漏洞可以接管大多数版本的 Android(包括 7.1.2)的 UI。鉴于它的性质，很难修复，也很难检测。

斗篷和匕首是一种利用两种权限来控制 UI 而不给用户注意恶意活动的机会的攻击。攻击使用了 Android 应用中非常常用的两种权限:**SYSTEM _ ALERT _ WINDOW**(“**draw on top**”)和**BIND _ ACCESSIBILITY _ SERVICE**(“**a11y**”)。

我们在过去的中已经对这个问题进行了概述[，但是让这个漏洞变得如此严重的是这样一个事实，即当通过谷歌 Play 商店安装时，请求 SYSTEM_ALERT_WINDOW 的应用程序会被自动授予这个权限。至于启用可访问性服务，恶意应用程序能够非常容易地通过社交工程让用户授予它。恶意应用程序甚至可以被设置为使用辅助功能服务来实现半合法的目的，例如监视某些应用程序何时打开以更改某些设置。](https://www.xda-developers.com/how-tapjacking-made-a-return-with-android-marshmallow-and-nobody-noticed/)

一旦授予这两种权限，可能发生的攻击数量将会非常多。窃取 pin、双因素身份验证令牌、密码，甚至拒绝服务攻击都是可能的。这是由于叠加的组合欺骗用户认为他们正在与一个合法的应用程序进行交互，并且辅助功能服务被用来拦截文本和触摸输入(或中继自己的输入)。

几个月前，我们提出了这样一个漏洞的理论，我们将创建一个概念验证应用程序，它使用 SYSTEM_ALERT_WINDOW 和 BIND_ACCESSIBILITY_SERVICE，以便在 XDA 实验室应用程序的密码输入屏幕上绘制一个覆盖图，并拦截用于刷密码的按键输入。我们设想的这个应用程序将是一个自动旋转管理应用程序，它将使用一个覆盖图在屏幕上绘制一个不可见的框来控制旋转(而不是请求 WRITE_SETTINGS，这将引发标志)和一个可访问性服务，以允许用户在每个应用程序的基础上控制自动旋转配置文件。理论上，这将是一个应用程序使用“斗篷和匕首”的例子然而，我们团队中没有人愿意冒险挑战谷歌的自动应用扫描系统，看看我们的概念验证漏洞是否会被允许在 Play Store 上使用。

无论如何，这些研究人员完成了工作并提交了测试应用程序，以证明这两种权限的使用确实可能是一个主要的安全问题:

如你所见，攻击对用户是不可见的，并允许完全控制设备。目前，从 Android 5.1.1 到 Android 7.1.2 的所有 Android 版本都容易受到此漏洞的攻击，因为它利用了两个原本用于完全合法目的的权限。

不要指望这个问题的真正解决方案会很快出现在你的设备上，尽管应该注意的是，Android O 中对 SYSTEM_ALERT_WINDOW 所做的[更改将通过禁止恶意应用程序完全覆盖整个屏幕来部分解决这个缺陷。此外，如果一个应用程序正在绘制一个覆盖图，Android O 现在会通过通知发出警告。有了这两个变化，如果用户注意的话，恶意程序就不太可能逃脱*的攻击。*](https://www.xda-developers.com/android-o-is-breaking-apps-that-overlay-on-top-of-the-status-bar/)

在 Android O 之前的版本上如何保护自己？像往常一样，只安装来源可信的应用程序。确保他们请求的权限符合您的预期。

至于数以亿计的普通用户，据谷歌发言人[称，Play Store Protect](https://www.xda-developers.com/google-play-protect-a-new-solution-to-keep-your-android-device-secure/) 也将提供必要的修复，以防止斗篷和匕首攻击。它将如何实现这一点还不清楚，但希望它涉及到一些检测这两种权限何时被恶意使用的方法。不过，我怀疑它是否能够检测到所有这样的情况，所以在任何情况下，你最好监视你安装的每个应用程序被授予了什么权限。