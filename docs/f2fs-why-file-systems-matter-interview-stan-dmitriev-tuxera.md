# F2FS 之旅和为什么文件系统很重要:采访来自 Tuxera 的斯坦·德米特列夫

> 原文：<https://www.xda-developers.com/f2fs-why-file-systems-matter-interview-stan-dmitriev-tuxera/>

文件系统在 XDA 或其他论坛上很少被讨论。该主题涉及许多底层开发，因此开发人员更喜欢关注应用程序、rom 或内核。然而，文件系统是每个存储的重要组成部分。这项技术概括了设备存储中的数据是如何存储和检索的。有许多不同种类的文件系统——每种都有各自的优缺点——选择一种文件系统会在稳定性和性能方面产生巨大的差异。那么原始设备制造商如何做出选择呢？我有幸与斯坦·季米特列夫交谈，他是一家为许多大型原始设备制造商提供文件系统解决方案的芬兰公司 [Tuxera](https://www.tuxera.com/) 的公关&公关部经理。

问:你能介绍一下你自己和 Tuxera 吗？

> #### 我是斯坦·德米特列夫。自从我有了我的第一部 Android 手机(HTC EVO 3D)，我就成了 XDA 社区的积极粉丝。这么说吧，我安装了一个定制的 ROM，并在第一天就取消了我的保修。德米特列夫是 XDA 论坛成员。几年前，我为 Feedly 共同创建了一个名为 Corgi 的创业项目，当时 XDA 社区在定义和开发应用程序方面给了我们很多帮助。
> 
> #### 目前，我是 Tuxera 公司的公关&沟通经理，Tuxera 是市场上领先的嵌入式存储软件，确切地说是文件系统公司。我们的软件支持超过 10 亿台设备，可以在最新的旗舰手机、汽车、路由器、无人机和相机中找到。该公司的故事始于 NTFS-3G，当时我们的总裁兼首席技术官 Szabolcs“Szaka”szakatics 让 NTFS 与 Linux 设备一起工作。目前，我们为外部和嵌入式存储开发了自己的文件系统和实现，并与大多数汽车公司以及许多智能手机公司合作。
> 
> #### 在 Tuxera，我们经常访问 XDA 论坛，尤其是在对一个砖砌设备进行故障诊断或寻找一个定制的 ROM /内核时。我的许多同事经常访问 XDA，阅读有关 Android 和 Linux 生态系统的最新深度技术新闻。

问:文件系统是我们设备中不可或缺的一部分，但是很少有人知道它们的作用、改进、优点和缺点。它有什么好处，为什么会有更多的人对保存数据的文件系统感兴趣？

> #### *答:文件系统是 Linux 内核的一个重要元素，负责设备及其存储之间的所有交互。每当您拍照、打开应用程序或观看视频时，文件系统都是操作系统访问和存储所有文件的核心。文件系统有一段时间不那么令人兴奋了，主要原因是性能瓶颈来自存储。*
> 
> #### *但是随着闪存速度变得非常快，特别是随着 UFS 的引入，现在需要更新软件以跟上闪存的性能。文件系统不仅会影响存储速度，而且在长期保持手机性能方面也起着重要作用。如果操作不当，存储将变得支离破碎，这是一种低效使用存储会降低设备性能的现象。将这种可能性降到最低是文件系统的一个重要特征。*

问:什么是 F2FS (primer ),为什么它开始向 Android 发展？哪些原始设备制造商在冲锋陷阵？

> #### 答:F2FS 是一个开源文件系统，主要宣传它是为闪存架构设计的。NAND 存储(闪存)通常作为 eMMC 或 UFS 解决方案用于所有当前的 Android 手机。该项目最初由三星开发，并已获得一些移动原始设备制造商的强烈兴趣。我们没有原始设备制造商开始这种转变的数据。但据我个人所知，摩托罗拉是第一个，其他许多原始设备制造商如一加和华为紧随其后。

问:它提供了哪些优势？OEM 列举了更快的存储操作和 UI 性能，但还有其他优势吗？

> #### *答:[推介](https://www.usenix.org/system/files/conference/fast15/fast15-paper-lee.pdf)非常简单，F2FS 为基于闪存的存储带来了更高的性能。您的系统将启动更快(更快的读取速度)，写入速度将更高，允许录制重度 4K、更高帧速率的慢动作和 360 度视频。此外，系统和存储之间的延迟将是超低的，这意味着动画和打开应用程序会感觉更快。*

问:具体来说，问题似乎集中在性能下降上。你能更深入地解释一下吗？原因是什么？

> #### *答:F2FS 的想法的确很棒，可以为闪存设备实现最快的性能。但关注长期表现也很重要。硬件开箱后总是很快，但持续保持这些速度是一个更大的挑战。对于一个 Android 用例来说，设备的存储大部分时间几乎都是满的，有时甚至在一秒钟内会发生数以千计的读写操作。许多流行的应用程序在后台运行服务，这意味着即使你不打开它，应用程序也在进行一些读/写操作。如果操作不当，写操作会极大地增加存储碎片，使下一次读/写操作更加缓慢。*
> 
> #### 我们认为存储碎片是 Android 设备性能下降的原因之一。现在必须确定的是，问题是由硬件兼容性和文件系统如何处理来自各种 OEM 的存储引起的，还是 F2FS 体系结构专注于初始速度，而这影响了长期性能。这些问题也可能是由 bug 引起的，因为文件系统仍在开发中。

问:还有其他不太为人所知的性能或可靠性问题吗？

> #### 答:我们发现一件有趣的事情是，F2FS 有一个意想不到的开销，至少有几百 MB 的存储空间用于缓存和存储维护。如果你有 64GB 或更多的存储空间，这肯定是有意义的，但在 8GB、16GB ROM 大小的经济型手机上，这可能是一个问题。
> 
> #### 主要的发现是，当你想获得更高的速度时，当前的 F2FS 实现对于只读环境是非常好的。F2FS 需要专注于在与小文件的高交互中提高其长期存储性能，因为这是 Android 环境中发生的事情。
> 
> #### 从某种意义上说，这是一场理论之战。你可以想象硬件性能如此之快，以至于降级不成问题。或者从相反的角度来看，硬件速度如此之快，以至于从长远来看可以保持稍慢的性能，这才是应该实现的目标。F2FS 选择了第一种方法，这里没有错误的选项，这是一个重要的实验，也是整个行业的学习曲线。也就是说，我们目前看到的是，长期表现应该是目前的主要焦点。

问:一些 OEM 厂商已经放弃使用 F2FS，而华为等其他厂商仍然在最近的设备上支持 F2FS。你认为这是一种趋势吗？(缓慢采用，或完全放弃)

> #### *答:OEM 会继续使用 F2FS 的原因有多种。*
> 
> *   OEM 可以有他们自己的 F2FS 实现，这带来了一些对已知问题的修复。
> *   #### *OEM 可以与闪存制造商建立非常良好的关系，因为访问 NAND 的 FTL 层并调整文件系统以与硬件良好配合可以带来显著的改进，包括闪存的碎片化。*
>     
>     
> *   OEM 可能更喜欢关注手机的初始性能，因为智能手机的平均生命周期约为 2 年，随着手机变得越来越慢，他们将会购买新的手机。
> *   OEM 也可以运行一些碎片整理服务，这可以部分解决 F2FS 的问题。
> 
> #### *这些是一些可能的情况，同时，我们看到一些原始设备制造商已经开始使用 Ext4，例如 OnePlus 3T 使用 F2FS，但所有较新的一加型号都使用 Ext4。*

问:F2FS 目前需要一些移动碎片整理解决方案，可以解决 F2FS 目前出现的问题。

> #### *答:碎片整理工具已经存在一段时间了，主要优点是可以重新分配/重写内存块，减少存储碎片。但这种方法的问题是，您需要重写闪存单元，这会缩短存储的寿命。最好的情况是首先智能地写数据。进行损害控制并不是最好的解决方案。*
> 
> #### 想象一下，把一大堆东西扔得到处都是，然后开始把它们放进抽屉，把房间弄得一团糟。为什么不马上做那件事？

**问:原始设备制造商已经设法采取反措施或解决阻碍 f2f 的一些问题了吗？例如，华为摒弃了不断下降的性能，并宣传随着时间的推移，UX 会越来越快，部分原因是他们的“人工智能”。**

> #### 答:如果人工智能可以分析存储行为，并重写文件系统以适用于特定的闪存设备，这可能会解决碎片问题。人工智能还可以分析这个人最常用的应用程序或功能，并相应地预加载/存储它们——让手机功能感觉更快，但这不会解决碎片化的问题。我的主要假设是，大多数优化都是与用户空间相关的，而不是一些高深的文件系统优化。

问:我们还应该了解哪些令人兴奋的文件系统开发？它们会对用户体验产生怎样的影响，即使是细微的或低层次的影响？

> #### 答:F2FS 和 Ext4 仍然非常重要，是开源的首选文件系统。Ext4 更加成熟和可靠，但可能会限制闪存性能；F2FS 更快，但也更具实验性。软件成为瓶颈的整个情况使文件系统再次令人兴奋。我们正在从每秒计算环境转变为每毫秒计算环境，文件系统将在这一性能提升中发挥重要作用。对于文件系统来说，最激动人心的发展是创建一个真正的闪存优化解决方案，能够保持闪存的性能。
> 
> #### *在 Tuxera，我们正在开发 Tuxera 闪存文件系统，我们在该系统中进行特定于硬件的软件优化，确保文件系统针对特定设备、使用案例和闪存进行优化。我们涉足汽车行业，主要关注闪存的长期性能和退化。这更像是史蒂夫·乔布斯曾经说过的硬件 x 软件类型的优化。我们认为，应用机器学习来创造这样的“驱动因素”对于整个存储行业来说是非常令人兴奋的事情。*

**问:我们的物理闪存存储也变得越来越快，您如何看待这一事实对最终用户体验和文件系统未来的影响？**

> #### *答:随着硬件变得更快，软件需要确保能够跟上这些高级硬件架构，这是文件系统当前要解决的主要挑战。你可以拥有令人难以置信的设备读写速度特性，但如果软件堆栈带来额外的延迟，用户体验就不会那么爽快了。对于文件系统开发来说，这是一个激动人心的时刻，因为显然需要一种更快、更快、更可靠的移动技术。*
> 
> #### *但是随着闪存变得越来越快，主要问题变成了，性能变得无关紧要的速度是多少？想象一下视网膜屏幕分辨率，更高的像素密度并不能真正使图像对人眼来说更清晰。*

问:谢谢你的时间。

> #### 谢谢！